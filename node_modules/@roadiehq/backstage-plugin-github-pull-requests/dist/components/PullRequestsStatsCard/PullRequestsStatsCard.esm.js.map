{"version":3,"file":"PullRequestsStatsCard.esm.js","sources":["../../../src/components/PullRequestsStatsCard/PullRequestsStatsCard.tsx"],"sourcesContent":["/*\n * Copyright 2025 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState } from 'react';\nimport {\n  ErrorPanel,\n  InfoCard,\n  InfoCardVariants,\n  MissingAnnotationEmptyState,\n  StructuredMetadataTable,\n} from '@backstage/core-components';\nimport {\n  GITHUB_PULL_REQUESTS_ANNOTATION,\n  isGithubSlugSet,\n} from '../../utils/isGithubSlugSet';\nimport { usePullRequestsStatistics } from '../usePullRequestsStatistics';\nimport {\n  Box,\n  CircularProgress,\n  FormControl,\n  FormHelperText,\n  makeStyles,\n  MenuItem,\n  Select,\n  Tooltip,\n} from '@material-ui/core';\nimport { Entity } from '@backstage/catalog-model';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { TooltipContent } from './components/TooltipContent';\nimport { getHostname } from '../../utils/githubUtils';\nimport { GitHubAuthorizationWrapper } from '@roadiehq/github-auth-utils-react';\n\nconst useStyles = makeStyles(theme => ({\n  infoCard: {\n    marginBottom: theme.spacing(3),\n    '& + .MuiAlert-root': {\n      marginTop: theme.spacing(3),\n    },\n    '& .MuiCardContent-root': {\n      padding: theme.spacing(2, 1, 2, 2),\n    },\n    '& td': {\n      whiteSpace: 'normal',\n    },\n  },\n}));\n\ntype Props = {\n  /** @deprecated The entity is now grabbed from context instead */\n  entity?: Entity;\n  variant?: InfoCardVariants;\n};\n\nconst StatsCardContent = () => {\n  const { entity } = useEntity();\n  const [pageSize, setPageSize] = useState<number>(20);\n  const projectName = isGithubSlugSet(entity);\n  const [owner, repo] = (projectName ?? '/').split('/');\n  const [{ statsData, loading, error }] = usePullRequestsStatistics({\n    owner,\n    repo,\n    pageSize,\n    state: 'closed',\n  });\n\n  const metadata = {\n    'average time of PR until merge': statsData?.avgTimeUntilMerge,\n    'merged to closed ratio': statsData?.mergedToClosedRatio,\n    'average size of PR': (\n      <Tooltip\n        title={\n          <TooltipContent\n            additions={statsData?.avgAdditions}\n            deletions={statsData?.avgDeletions}\n          />\n        }\n      >\n        <div>{statsData?.avgChangedLinesCount} lines</div>\n      </Tooltip>\n    ),\n    'average changed files of PR': `${statsData?.avgChangedFilesCount}`,\n    'average coding time of PR': `${statsData?.avgCodingTime}`,\n  };\n\n  if (loading) {\n    return <CircularProgress />;\n  }\n\n  if (error) {\n    return <ErrorPanel error={error} />;\n  }\n\n  return (\n    <Box position=\"relative\">\n      <StructuredMetadataTable metadata={metadata} />\n      <Box display=\"flex\" justifyContent=\"flex-end\">\n        <FormControl>\n          <Select\n            value={pageSize}\n            onChange={event => setPageSize(Number(event.target.value))}\n          >\n            <MenuItem value={10}>10</MenuItem>\n            <MenuItem value={20}>20</MenuItem>\n            <MenuItem value={50}>50</MenuItem>\n            <MenuItem value={100}>100</MenuItem>\n          </Select>\n          <FormHelperText>Number of PRs</FormHelperText>\n        </FormControl>\n      </Box>\n    </Box>\n  );\n};\n\nconst PullRequestsStatsCard = (props: Props) => {\n  const classes = useStyles();\n  const { entity } = useEntity();\n  const hostname = getHostname(entity);\n  const projectName = isGithubSlugSet(entity);\n  if (!projectName || projectName === '') {\n    return (\n      <MissingAnnotationEmptyState\n        annotation={GITHUB_PULL_REQUESTS_ANNOTATION}\n      />\n    );\n  }\n  return (\n    <GitHubAuthorizationWrapper\n      title=\"GitHub Pull Requests Statistics\"\n      hostname={hostname}\n    >\n      <InfoCard\n        title=\"GitHub Pull Requests Statistics\"\n        className={classes.infoCard}\n        variant={props.variant}\n      >\n        <StatsCardContent />\n      </InfoCard>\n    </GitHubAuthorizationWrapper>\n  );\n};\n\nexport default PullRequestsStatsCard;\n"],"names":[],"mappings":"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"}