{"version":3,"file":"ComplianceCard.esm.js","sources":["../../../../src/components/Widgets/ComplianceCard/ComplianceCard.tsx"],"sourcesContent":["/*\n * Copyright 2025 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Box, List, ListItem } from '@material-ui/core';\nimport Alert from '@material-ui/lab/Alert';\nimport {\n  InfoCard,\n  Progress,\n  StructuredMetadataTable,\n  MissingAnnotationEmptyState,\n} from '@backstage/core-components';\nimport {\n  useProtectedBranches,\n  useRepoLicence,\n  NO_LICENSE_MSG,\n} from '../../../hooks/useComplianceHooks';\nimport { useProjectEntity } from '../../../hooks/useProjectEntity';\nimport {\n  isGithubInsightsAvailable,\n  GITHUB_INSIGHTS_ANNOTATION,\n} from '../../utils/isGithubInsightsAvailable';\nimport WarningIcon from '@material-ui/icons/ErrorOutline';\nimport { styles as useStyles } from '../../utils/styles';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { getHostname } from '../../utils/githubUtils';\nimport { GitHubAuthorizationWrapper } from '@roadiehq/github-auth-utils-react';\n\nconst ComplianceCardContent = () => {\n  const { entity } = useEntity();\n  const { branches, loading, error } = useProtectedBranches(entity);\n  const {\n    license,\n    loading: licenseLoading,\n    error: licenseError,\n  } = useRepoLicence(entity);\n  const classes = useStyles();\n  const { owner, repo } = useProjectEntity(entity);\n  const projectAlert = isGithubInsightsAvailable(entity);\n  if (!projectAlert) {\n    return (\n      <MissingAnnotationEmptyState annotation={GITHUB_INSIGHTS_ANNOTATION} />\n    );\n  }\n\n  if (loading || licenseLoading) {\n    return <Progress />;\n  } else if (error || licenseError) {\n    return (\n      <Alert severity=\"error\">\n        Error occurred while fetching data for the compliance card:{' '}\n        {error?.message}\n      </Alert>\n    );\n  }\n\n  return (\n    <InfoCard title=\"Compliance report\" className={classes.infoCard}>\n      <StructuredMetadataTable\n        metadata={{\n          'Protected branches':\n            branches?.length && owner && repo ? (\n              <List className={classes.listStyle}>\n                {branches.map((branch: any) => (\n                  <ListItem key={branch.name}>{branch.name}</ListItem>\n                ))}\n              </List>\n            ) : (\n              <Box display=\"flex\" alignItems=\"center\">\n                <WarningIcon\n                  style={{\n                    color: 'orange',\n                    marginRight: '5px',\n                    flexShrink: 0,\n                  }}\n                />\n                <span>None</span>\n              </Box>\n            ),\n          License:\n            license === NO_LICENSE_MSG ? (\n              <Box display=\"flex\" alignItems=\"center\">\n                <WarningIcon\n                  style={{\n                    color: 'orange',\n                    marginRight: '5px',\n                    flexShrink: 0,\n                  }}\n                />\n                <span>None</span>\n              </Box>\n            ) : (\n              license\n            ),\n        }}\n      />\n    </InfoCard>\n  );\n};\n\nconst ComplianceCard = () => {\n  const { entity } = useEntity();\n  const hostname = getHostname(entity);\n\n  return (\n    <GitHubAuthorizationWrapper title=\"Compliance\" hostname={hostname}>\n      <ComplianceCardContent />\n    </GitHubAuthorizationWrapper>\n  );\n};\n\nexport default ComplianceCard;\n"],"names":["useStyles"],"mappings":"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"}