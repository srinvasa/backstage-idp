{"version":3,"file":"LanguagesCard.esm.js","sources":["../../../../src/components/Widgets/LanguagesCard/LanguagesCard.tsx"],"sourcesContent":["/*\n * Copyright 2025 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Chip, makeStyles, Tooltip } from '@material-ui/core';\nimport Alert from '@material-ui/lab/Alert';\nimport {\n  InfoCard,\n  MissingAnnotationEmptyState,\n  Progress,\n} from '@backstage/core-components';\nimport { useRequest } from '../../../hooks/useRequest';\nimport { colors } from './colors';\nimport { useProjectEntity } from '../../../hooks/useProjectEntity';\nimport {\n  GITHUB_INSIGHTS_ANNOTATION,\n  isGithubInsightsAvailable,\n} from '../../utils/isGithubInsightsAvailable';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { getHostname } from '../../utils/githubUtils';\nimport { GitHubAuthorizationWrapper } from '@roadiehq/github-auth-utils-react';\n\nconst useStyles = makeStyles(theme => ({\n  infoCard: {\n    marginBottom: '10px',\n    '& + .MuiAlert-root': {\n      marginTop: theme.spacing(3),\n    },\n  },\n  barContainer: {\n    height: theme.spacing(2),\n    marginBottom: theme.spacing(3),\n    borderRadius: '4px',\n    backgroundColor: 'transparent',\n    overflow: 'hidden',\n  },\n  bar: {\n    height: '100%',\n    position: 'relative',\n  },\n  languageDot: {\n    width: '10px',\n    height: '10px',\n    borderRadius: '50%',\n    marginRight: theme.spacing(1),\n    display: 'inline-block',\n  },\n  label: {\n    color: 'inherit',\n  },\n}));\n\ntype Language = {\n  [key: string]: number;\n};\n\nconst LanguagesCardContent = () => {\n  const { entity } = useEntity();\n  let barWidth = 0;\n  const classes = useStyles();\n  const { owner, repo } = useProjectEntity(entity);\n  const { value, loading, error } = useRequest(entity, 'languages', 0, 0);\n  const projectAlert = isGithubInsightsAvailable(entity);\n\n  if (!projectAlert) {\n    return (\n      <MissingAnnotationEmptyState annotation={GITHUB_INSIGHTS_ANNOTATION} />\n    );\n  }\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return (\n      <Alert severity=\"error\" className={classes.infoCard}>\n        {error.message}\n      </Alert>\n    );\n  }\n  return value && Object.keys(value).length && owner && repo ? (\n    <InfoCard title=\"Languages\" className={classes.infoCard}>\n      <div className={classes.barContainer}>\n        {Object.entries(value as Language).map((language, index: number) => {\n          barWidth =\n            barWidth +\n            (language[1] /\n              Object.values(value as Record<string, number>).reduce(\n                (a, b) => a + b,\n              )) *\n              100;\n          return (\n            <Tooltip\n              title={language[0]}\n              placement=\"bottom-end\"\n              key={language[0]}\n            >\n              <div\n                className={classes.bar}\n                key={language[0]}\n                style={{\n                  marginTop: index === 0 ? '0' : `-16px`,\n                  zIndex: Object.keys(value).length - index,\n                  backgroundColor: colors[language[0]]?.color || '#333',\n                  width: `${barWidth}%`,\n                }}\n              />\n            </Tooltip>\n          );\n        })}\n      </div>\n      {Object.entries(value as Language).map(language => (\n        <Chip\n          classes={{\n            label: classes.label,\n          }}\n          label={\n            <>\n              <span\n                className={classes.languageDot}\n                style={{\n                  backgroundColor: colors[language[0]]?.color || '#333',\n                }}\n              />\n              {language[0]} -{' '}\n              {(\n                (language[1] /\n                  Object.values(value as Record<string, number>).reduce(\n                    (a, b) => a + b,\n                  )) *\n                100\n              ).toFixed(2)}\n              %\n            </>\n          }\n          variant=\"outlined\"\n          key={language[0]}\n        />\n      ))}\n    </InfoCard>\n  ) : (\n    <></>\n  );\n};\n\nconst LanguagesCard = () => {\n  const { entity } = useEntity();\n  const hostname = getHostname(entity);\n\n  return (\n    <GitHubAuthorizationWrapper title=\"Languages\" hostname={hostname}>\n      <LanguagesCardContent />\n    </GitHubAuthorizationWrapper>\n  );\n};\n\nexport default LanguagesCard;\n"],"names":[],"mappings":"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"}