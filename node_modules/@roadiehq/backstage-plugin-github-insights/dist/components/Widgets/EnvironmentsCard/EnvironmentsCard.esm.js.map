{"version":3,"file":"EnvironmentsCard.esm.js","sources":["../../../../src/components/Widgets/EnvironmentsCard/EnvironmentsCard.tsx"],"sourcesContent":["/*\n * Copyright 2025 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Link, List, ListItem } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport {\n  InfoCard,\n  Progress,\n  MissingAnnotationEmptyState,\n} from '@backstage/core-components';\nimport { useRequest } from '../../../hooks/useRequest';\nimport { useEntityGithubScmIntegration } from '../../../hooks/useEntityGithubScmIntegration';\nimport { useProjectEntity } from '../../../hooks/useProjectEntity';\nimport {\n  isGithubInsightsAvailable,\n  GITHUB_INSIGHTS_ANNOTATION,\n} from '../../utils/isGithubInsightsAvailable';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { styles as useStyles } from '../../utils/styles';\nimport { getHostname } from '../../utils/githubUtils';\nimport { GitHubAuthorizationWrapper } from '@roadiehq/github-auth-utils-react';\n\ntype Environment = {\n  id: number;\n  html_url: string;\n  name: string;\n};\n\nconst EnvironmentsCardContent = () => {\n  const classes = useStyles();\n  const { entity } = useEntity();\n\n  const { owner, repo } = useProjectEntity(entity);\n  const { value, loading, error } = useRequest(entity, 'environments', 0, 0);\n  const { hostname } = useEntityGithubScmIntegration(entity);\n\n  const projectAlert = isGithubInsightsAvailable(entity);\n  if (!projectAlert) {\n    return (\n      <MissingAnnotationEmptyState annotation={GITHUB_INSIGHTS_ANNOTATION} />\n    );\n  }\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return (\n      <Alert severity=\"error\" className={classes.infoCard}>\n        {error.message}\n      </Alert>\n    );\n  }\n\n  return value?.environments?.length && owner && repo ? (\n    <InfoCard\n      title=\"Environments\"\n      deepLink={{\n        link: `https://${hostname}/${owner}/${repo}/deployments`,\n        title: 'Environments',\n        onClick: e => {\n          e.preventDefault();\n          window.open(`https://${hostname}/${owner}/${repo}/deployments`);\n        },\n      }}\n      className={classes.infoCard}\n    >\n      <List>\n        {value.environments.map((environment: Environment) => (\n          <ListItem className={classes.listItem} key={environment.id}>\n            <Link\n              href={environment.html_url}\n              color=\"inherit\"\n              target=\"_blank\"\n              rel=\"noopener noreferrer\"\n            >\n              <p className={classes.releaseTitle}>{environment.name}</p>\n            </Link>\n          </ListItem>\n        ))}\n      </List>\n    </InfoCard>\n  ) : (\n    <></>\n  );\n};\n\nconst EnvironmentsCard = () => {\n  const { entity } = useEntity();\n  const hostname = getHostname(entity);\n\n  return (\n    <GitHubAuthorizationWrapper title=\"Environments\" hostname={hostname}>\n      <EnvironmentsCardContent />\n    </GitHubAuthorizationWrapper>\n  );\n};\n\nexport default EnvironmentsCard;\n"],"names":["useStyles"],"mappings":";;;;;;;;;;;;;AAyCA,MAAM,0BAA0B,MAAM;AACpC,EAAA,MAAM,UAAUA,MAAU,EAAA;AAC1B,EAAM,MAAA,EAAE,MAAO,EAAA,GAAI,SAAU,EAAA;AAE7B,EAAA,MAAM,EAAE,KAAA,EAAO,IAAK,EAAA,GAAI,iBAAiB,MAAM,CAAA;AAC/C,EAAM,MAAA,EAAE,OAAO,OAAS,EAAA,KAAA,KAAU,UAAW,CAAA,MAAA,EAAQ,cAAgB,EAAA,CAAA,EAAG,CAAC,CAAA;AACzE,EAAA,MAAM,EAAE,QAAA,EAAa,GAAA,6BAAA,CAA8B,MAAM,CAAA;AAEzD,EAAM,MAAA,YAAA,GAAe,0BAA0B,MAAM,CAAA;AACrD,EAAA,IAAI,CAAC,YAAc,EAAA;AACjB,IACE,uBAAA,GAAA,CAAC,2BAA4B,EAAA,EAAA,UAAA,EAAY,0BAA4B,EAAA,CAAA;AAAA;AAIzE,EAAA,IAAI,OAAS,EAAA;AACX,IAAA,2BAAQ,QAAS,EAAA,EAAA,CAAA;AAAA,aACR,KAAO,EAAA;AAChB,IACE,uBAAA,GAAA,CAAC,SAAM,QAAS,EAAA,OAAA,EAAQ,WAAW,OAAQ,CAAA,QAAA,EACxC,gBAAM,OACT,EAAA,CAAA;AAAA;AAIJ,EAAA,OAAO,KAAO,EAAA,YAAA,EAAc,MAAU,IAAA,KAAA,IAAS,IAC7C,mBAAA,GAAA;AAAA,IAAC,QAAA;AAAA,IAAA;AAAA,MACC,KAAM,EAAA,cAAA;AAAA,MACN,QAAU,EAAA;AAAA,QACR,MAAM,CAAW,QAAA,EAAA,QAAQ,CAAI,CAAA,EAAA,KAAK,IAAI,IAAI,CAAA,YAAA,CAAA;AAAA,QAC1C,KAAO,EAAA,cAAA;AAAA,QACP,SAAS,CAAK,CAAA,KAAA;AACZ,UAAA,CAAA,CAAE,cAAe,EAAA;AACjB,UAAA,MAAA,CAAO,KAAK,CAAW,QAAA,EAAA,QAAQ,IAAI,KAAK,CAAA,CAAA,EAAI,IAAI,CAAc,YAAA,CAAA,CAAA;AAAA;AAChE,OACF;AAAA,MACA,WAAW,OAAQ,CAAA,QAAA;AAAA,MAEnB,QAAA,kBAAA,GAAA,CAAC,IACE,EAAA,EAAA,QAAA,EAAA,KAAA,CAAM,YAAa,CAAA,GAAA,CAAI,CAAC,WAAA,qBACtB,GAAA,CAAA,QAAA,EAAA,EAAS,SAAW,EAAA,OAAA,CAAQ,QAC3B,EAAA,QAAA,kBAAA,GAAA;AAAA,QAAC,IAAA;AAAA,QAAA;AAAA,UACC,MAAM,WAAY,CAAA,QAAA;AAAA,UAClB,KAAM,EAAA,SAAA;AAAA,UACN,MAAO,EAAA,QAAA;AAAA,UACP,GAAI,EAAA,qBAAA;AAAA,UAEJ,8BAAC,GAAE,EAAA,EAAA,SAAA,EAAW,OAAQ,CAAA,YAAA,EAAe,sBAAY,IAAK,EAAA;AAAA;AAAA,OAPd,EAAA,EAAA,WAAA,CAAY,EASxD,CACD,CACH,EAAA;AAAA;AAAA,sBAGA,GAAA,CAAA,QAAA,EAAA,EAAA,CAAA;AAEN,CAAA;AAEA,MAAM,mBAAmB,MAAM;AAC7B,EAAM,MAAA,EAAE,MAAO,EAAA,GAAI,SAAU,EAAA;AAC7B,EAAM,MAAA,QAAA,GAAW,YAAY,MAAM,CAAA;AAEnC,EAAA,2BACG,0BAA2B,EAAA,EAAA,KAAA,EAAM,gBAAe,QAC/C,EAAA,QAAA,kBAAA,GAAA,CAAC,2BAAwB,CAC3B,EAAA,CAAA;AAEJ;;;;"}