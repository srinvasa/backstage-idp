{"version":3,"file":"MarkdownContent.esm.js","sources":["../../../../src/components/Widgets/MarkdownContent/MarkdownContent.tsx"],"sourcesContent":["/*\n * Copyright 2025 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback } from 'react';\nimport { Alert } from '@material-ui/lab';\nimport {\n  MarkdownContent as RawMarkdownContent,\n  Progress,\n} from '@backstage/core-components';\nimport {\n  ApiHolder,\n  configApiRef,\n  useApiHolder,\n} from '@backstage/core-plugin-api';\nimport { MarkdownContentProps } from './types';\nimport useAsync from 'react-use/lib/useAsync';\nimport { GithubApi, githubApiRef, GithubClient } from '../../../apis';\nimport { scmAuthApiRef } from '@backstage/integration-react';\nimport { GitHubAuthorizationWrapper } from '@roadiehq/github-auth-utils-react';\n\nconst getGithubClient = (apiHolder: ApiHolder) => {\n  let githubClient: GithubApi | undefined = apiHolder.get(githubApiRef);\n  if (!githubClient) {\n    const configApi = apiHolder.get(configApiRef);\n    const scmAuthApi = apiHolder.get(scmAuthApiRef);\n    if (scmAuthApi && configApi) {\n      githubClient = new GithubClient({ configApi, scmAuthApi });\n    }\n  }\n  if (!githubClient) {\n    throw new Error(\n      'The MarkdownCard component Failed to get the SCM auth client or SCM configuration',\n    );\n  }\n  return githubClient;\n};\n\nconst GithubFileContent = (props: MarkdownContentProps) => {\n  const { preserveHtmlComments } = props;\n  const apiHolder = useApiHolder();\n\n  const { value, loading, error } = useAsync(async () => {\n    const githubClient = getGithubClient(apiHolder);\n    return githubClient.getContent({ ...props });\n  }, [apiHolder]);\n\n  const transformImageUri = useCallback(\n    (href: string) => {\n      return value?.media[href] || href;\n    },\n    [value?.media],\n  );\n\n  const transformLinkUri = useCallback(\n    (href: string) => {\n      return value?.links[href] || href;\n    },\n    [value?.links],\n  );\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  }\n\n  if (!value) {\n    return <Progress />;\n  }\n\n  let content = value.content;\n  if (!preserveHtmlComments) {\n    content = content.replace(/<!--(.|\\n)*?-->/g, '');\n  }\n\n  return (\n    <RawMarkdownContent\n      transformImageUri={transformImageUri}\n      transformLinkUri={transformLinkUri}\n      content={content}\n    />\n  );\n};\n\n/**\n * A component to render a markdown file from github\n *\n * @public\n */\nconst MarkdownContent = (props: MarkdownContentProps) => {\n  const { hostname } = props;\n  return (\n    <GitHubAuthorizationWrapper title=\"Markdown Card\" hostname={hostname}>\n      <GithubFileContent {...props} />\n    </GitHubAuthorizationWrapper>\n  );\n};\n\nexport default MarkdownContent;\n"],"names":["RawMarkdownContent"],"mappings":";;;;;;;;;;;AAiCA,MAAM,eAAA,GAAkB,CAAC,SAAyB,KAAA;AAChD,EAAI,IAAA,YAAA,GAAsC,SAAU,CAAA,GAAA,CAAI,YAAY,CAAA;AACpE,EAAA,IAAI,CAAC,YAAc,EAAA;AACjB,IAAM,MAAA,SAAA,GAAY,SAAU,CAAA,GAAA,CAAI,YAAY,CAAA;AAC5C,IAAM,MAAA,UAAA,GAAa,SAAU,CAAA,GAAA,CAAI,aAAa,CAAA;AAC9C,IAAA,IAAI,cAAc,SAAW,EAAA;AAC3B,MAAA,YAAA,GAAe,IAAI,YAAA,CAAa,EAAE,SAAA,EAAW,YAAY,CAAA;AAAA;AAC3D;AAEF,EAAA,IAAI,CAAC,YAAc,EAAA;AACjB,IAAA,MAAM,IAAI,KAAA;AAAA,MACR;AAAA,KACF;AAAA;AAEF,EAAO,OAAA,YAAA;AACT,CAAA;AAEA,MAAM,iBAAA,GAAoB,CAAC,KAAgC,KAAA;AACzD,EAAM,MAAA,EAAE,sBAAyB,GAAA,KAAA;AACjC,EAAA,MAAM,YAAY,YAAa,EAAA;AAE/B,EAAA,MAAM,EAAE,KAAO,EAAA,OAAA,EAAS,KAAM,EAAA,GAAI,SAAS,YAAY;AACrD,IAAM,MAAA,YAAA,GAAe,gBAAgB,SAAS,CAAA;AAC9C,IAAA,OAAO,YAAa,CAAA,UAAA,CAAW,EAAE,GAAG,OAAO,CAAA;AAAA,GAC7C,EAAG,CAAC,SAAS,CAAC,CAAA;AAEd,EAAA,MAAM,iBAAoB,GAAA,WAAA;AAAA,IACxB,CAAC,IAAiB,KAAA;AAChB,MAAO,OAAA,KAAA,EAAO,KAAM,CAAA,IAAI,CAAK,IAAA,IAAA;AAAA,KAC/B;AAAA,IACA,CAAC,OAAO,KAAK;AAAA,GACf;AAEA,EAAA,MAAM,gBAAmB,GAAA,WAAA;AAAA,IACvB,CAAC,IAAiB,KAAA;AAChB,MAAO,OAAA,KAAA,EAAO,KAAM,CAAA,IAAI,CAAK,IAAA,IAAA;AAAA,KAC/B;AAAA,IACA,CAAC,OAAO,KAAK;AAAA,GACf;AAEA,EAAA,IAAI,OAAS,EAAA;AACX,IAAA,2BAAQ,QAAS,EAAA,EAAA,CAAA;AAAA,aACR,KAAO,EAAA;AAChB,IAAA,uBAAQ,GAAA,CAAA,KAAA,EAAA,EAAM,QAAS,EAAA,OAAA,EAAS,gBAAM,OAAQ,EAAA,CAAA;AAAA;AAGhD,EAAA,IAAI,CAAC,KAAO,EAAA;AACV,IAAA,2BAAQ,QAAS,EAAA,EAAA,CAAA;AAAA;AAGnB,EAAA,IAAI,UAAU,KAAM,CAAA,OAAA;AACpB,EAAA,IAAI,CAAC,oBAAsB,EAAA;AACzB,IAAU,OAAA,GAAA,OAAA,CAAQ,OAAQ,CAAA,kBAAA,EAAoB,EAAE,CAAA;AAAA;AAGlD,EACE,uBAAA,GAAA;AAAA,IAACA,iBAAA;AAAA,IAAA;AAAA,MACC,iBAAA;AAAA,MACA,gBAAA;AAAA,MACA;AAAA;AAAA,GACF;AAEJ,CAAA;AAOM,MAAA,eAAA,GAAkB,CAAC,KAAgC,KAAA;AACvD,EAAM,MAAA,EAAE,UAAa,GAAA,KAAA;AACrB,EACE,uBAAA,GAAA,CAAC,8BAA2B,KAAM,EAAA,eAAA,EAAgB,UAChD,QAAC,kBAAA,GAAA,CAAA,iBAAA,EAAA,EAAmB,GAAG,KAAA,EAAO,CAChC,EAAA,CAAA;AAEJ;;;;"}