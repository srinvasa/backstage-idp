{"version":3,"file":"store.esm.js","sources":["../../src/components/store.ts"],"sourcesContent":["/*\n * Copyright 2021 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport create, { SetState, GetState, StoreApi } from 'zustand';\nimport produce from 'immer';\nimport {\n  GithubRequestState,\n  GithubInsightsState,\n  RequestStateStore,\n} from './types';\n\nclass DefaultDict<T> {\n  constructor(defaultVal: T) {\n    return new Proxy(\n      {},\n      {\n        get: (target: { [key: string]: {} }, name: string) =>\n          name in target ? target[name] : defaultVal,\n      },\n    );\n  }\n}\n\nconst initialState: GithubRequestState = { etag: '', data: [] };\n\nconst createLicenseSlice = (set: SetState<GithubInsightsState>) => ({\n  license: {\n    state: initialState,\n    setState: (next: GithubRequestState) =>\n      set(\n        produce(draft => {\n          draft.license.state = next;\n        }),\n      ),\n  },\n});\n\nconst createBranchesSlice = (set: SetState<GithubInsightsState>) => ({\n  branches: {\n    state: initialState,\n    setState: (next: GithubRequestState) =>\n      set(\n        produce(draft => {\n          draft.branches.state = next;\n        }),\n      ),\n  },\n});\n\nconst createContributorSlice = (set: SetState<GithubInsightsState>) => ({\n  contributor: {\n    state: new DefaultDict(initialState) as RequestStateStore,\n    setState: (key: string, value: GithubRequestState) =>\n      set(prev => {\n        prev.contributor.state[key] = value;\n        return produce(draft => {\n          draft.contributor.state = prev.contributor.state;\n        });\n      }),\n  },\n});\nconst createRequestSlice = (set: SetState<GithubInsightsState>) => ({\n  request: {\n    state: new DefaultDict(initialState) as RequestStateStore,\n    setState: (key: string, value: GithubRequestState) =>\n      set(prev => {\n        prev.request.state[key] = value;\n        return produce(draft => {\n          draft.requesst.state = prev.request.state;\n        });\n      }),\n  },\n});\n\nexport const useStore = create<\n  GithubInsightsState,\n  SetState<GithubInsightsState>,\n  GetState<GithubInsightsState>,\n  StoreApi<GithubInsightsState>\n>(set => ({\n  ...createLicenseSlice(set),\n  ...createContributorSlice(set),\n  ...createBranchesSlice(set),\n  ...createRequestSlice(set),\n}));\n"],"names":[],"mappings":";;;AAwBA,MAAM,WAAe,CAAA;AAAA,EACnB,YAAY,UAAe,EAAA;AACzB,IAAA,OAAO,IAAI,KAAA;AAAA,MACT,EAAC;AAAA,MACD;AAAA,QACE,GAAA,EAAK,CAAC,MAA+B,EAAA,IAAA,KACnC,QAAQ,MAAS,GAAA,MAAA,CAAO,IAAI,CAAI,GAAA;AAAA;AACpC,KACF;AAAA;AAEJ;AAEA,MAAM,eAAmC,EAAE,IAAA,EAAM,EAAI,EAAA,IAAA,EAAM,EAAG,EAAA;AAE9D,MAAM,kBAAA,GAAqB,CAAC,GAAwC,MAAA;AAAA,EAClE,OAAS,EAAA;AAAA,IACP,KAAO,EAAA,YAAA;AAAA,IACP,QAAA,EAAU,CAAC,IACT,KAAA,GAAA;AAAA,MACE,QAAQ,CAAS,KAAA,KAAA;AACf,QAAA,KAAA,CAAM,QAAQ,KAAQ,GAAA,IAAA;AAAA,OACvB;AAAA;AACH;AAEN,CAAA,CAAA;AAEA,MAAM,mBAAA,GAAsB,CAAC,GAAwC,MAAA;AAAA,EACnE,QAAU,EAAA;AAAA,IACR,KAAO,EAAA,YAAA;AAAA,IACP,QAAA,EAAU,CAAC,IACT,KAAA,GAAA;AAAA,MACE,QAAQ,CAAS,KAAA,KAAA;AACf,QAAA,KAAA,CAAM,SAAS,KAAQ,GAAA,IAAA;AAAA,OACxB;AAAA;AACH;AAEN,CAAA,CAAA;AAEA,MAAM,sBAAA,GAAyB,CAAC,GAAwC,MAAA;AAAA,EACtE,WAAa,EAAA;AAAA,IACX,KAAA,EAAO,IAAI,WAAA,CAAY,YAAY,CAAA;AAAA,IACnC,QAAU,EAAA,CAAC,GAAa,EAAA,KAAA,KACtB,IAAI,CAAQ,IAAA,KAAA;AACV,MAAK,IAAA,CAAA,WAAA,CAAY,KAAM,CAAA,GAAG,CAAI,GAAA,KAAA;AAC9B,MAAA,OAAO,QAAQ,CAAS,KAAA,KAAA;AACtB,QAAM,KAAA,CAAA,WAAA,CAAY,KAAQ,GAAA,IAAA,CAAK,WAAY,CAAA,KAAA;AAAA,OAC5C,CAAA;AAAA,KACF;AAAA;AAEP,CAAA,CAAA;AACA,MAAM,kBAAA,GAAqB,CAAC,GAAwC,MAAA;AAAA,EAClE,OAAS,EAAA;AAAA,IACP,KAAA,EAAO,IAAI,WAAA,CAAY,YAAY,CAAA;AAAA,IACnC,QAAU,EAAA,CAAC,GAAa,EAAA,KAAA,KACtB,IAAI,CAAQ,IAAA,KAAA;AACV,MAAK,IAAA,CAAA,OAAA,CAAQ,KAAM,CAAA,GAAG,CAAI,GAAA,KAAA;AAC1B,MAAA,OAAO,QAAQ,CAAS,KAAA,KAAA;AACtB,QAAM,KAAA,CAAA,QAAA,CAAS,KAAQ,GAAA,IAAA,CAAK,OAAQ,CAAA,KAAA;AAAA,OACrC,CAAA;AAAA,KACF;AAAA;AAEP,CAAA,CAAA;AAEa,MAAA,QAAA,GAAW,OAKtB,CAAQ,GAAA,MAAA;AAAA,EACR,GAAG,mBAAmB,GAAG,CAAA;AAAA,EACzB,GAAG,uBAAuB,GAAG,CAAA;AAAA,EAC7B,GAAG,oBAAoB,GAAG,CAAA;AAAA,EAC1B,GAAG,mBAAmB,GAAG;AAC3B,CAAE,CAAA;;;;"}