{"version":3,"file":"useContributor.esm.js","sources":["../../src/hooks/useContributor.ts"],"sourcesContent":["/*\n * Copyright 2025 Larder Software Limited\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useAsync } from 'react-use';\nimport { Octokit } from '@octokit/rest';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { useEntityGithubScmIntegration } from './useEntityGithubScmIntegration';\nimport { ContributorData, GithubRequestState } from '../components/types';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { useStore } from '../components/store';\nimport { scmAuthApiRef } from '@backstage/integration-react';\n\nexport const useContributor = (\n  username: string,\n): { contributor?: ContributorData; error?: Error; loading: boolean } => {\n  const auth = useApi(scmAuthApiRef);\n  const { entity } = useEntity();\n  const { hostname, baseUrl } = useEntityGithubScmIntegration(entity);\n\n  const { state: contributorData, setState: setContributorData } = useStore(\n    state => state.contributor,\n  );\n\n  const { value, loading, error } = useAsync(async (): Promise<\n    GithubRequestState | undefined\n  > => {\n    let result;\n    try {\n      const { token } = await auth.getCredentials({\n        url: `https://${hostname}/`,\n        additionalScope: {\n          customScopes: {\n            github: ['repo'],\n          },\n        },\n      });\n\n      const octokit = new Octokit({ auth: token });\n\n      const response = await octokit.request(`GET /users/${username}`, {\n        headers: { 'if-none-match': contributorData[username].etag },\n        baseUrl,\n      });\n\n      result = {\n        data: response.data as ContributorData,\n        etag: response.headers.etag ?? '',\n      };\n    } catch (e: any) {\n      if (e.status === 304) {\n        result = contributorData[username];\n      }\n    }\n    return result;\n  }, [username, baseUrl]);\n\n  if (value) {\n    setContributorData(username, value);\n  }\n\n  return {\n    contributor: value ? (value.data as ContributorData) : undefined,\n    loading,\n    error,\n  };\n};\n"],"names":[],"mappings":";;;;;;;;AAyBa,MAAA,cAAA,GAAiB,CAC5B,QACuE,KAAA;AACvE,EAAM,MAAA,IAAA,GAAO,OAAO,aAAa,CAAA;AACjC,EAAM,MAAA,EAAE,MAAO,EAAA,GAAI,SAAU,EAAA;AAC7B,EAAA,MAAM,EAAE,QAAA,EAAU,OAAQ,EAAA,GAAI,8BAA8B,MAAM,CAAA;AAElE,EAAA,MAAM,EAAE,KAAA,EAAO,eAAiB,EAAA,QAAA,EAAU,oBAAuB,GAAA,QAAA;AAAA,IAC/D,WAAS,KAAM,CAAA;AAAA,GACjB;AAEA,EAAA,MAAM,EAAE,KAAO,EAAA,OAAA,EAAS,KAAM,EAAA,GAAI,SAAS,YAEtC;AACH,IAAI,IAAA,MAAA;AACJ,IAAI,IAAA;AACF,MAAA,MAAM,EAAE,KAAA,EAAU,GAAA,MAAM,KAAK,cAAe,CAAA;AAAA,QAC1C,GAAA,EAAK,WAAW,QAAQ,CAAA,CAAA,CAAA;AAAA,QACxB,eAAiB,EAAA;AAAA,UACf,YAAc,EAAA;AAAA,YACZ,MAAA,EAAQ,CAAC,MAAM;AAAA;AACjB;AACF,OACD,CAAA;AAED,MAAA,MAAM,UAAU,IAAI,OAAA,CAAQ,EAAE,IAAA,EAAM,OAAO,CAAA;AAE3C,MAAA,MAAM,WAAW,MAAM,OAAA,CAAQ,OAAQ,CAAA,CAAA,WAAA,EAAc,QAAQ,CAAI,CAAA,EAAA;AAAA,QAC/D,SAAS,EAAE,eAAA,EAAiB,eAAgB,CAAA,QAAQ,EAAE,IAAK,EAAA;AAAA,QAC3D;AAAA,OACD,CAAA;AAED,MAAS,MAAA,GAAA;AAAA,QACP,MAAM,QAAS,CAAA,IAAA;AAAA,QACf,IAAA,EAAM,QAAS,CAAA,OAAA,CAAQ,IAAQ,IAAA;AAAA,OACjC;AAAA,aACO,CAAQ,EAAA;AACf,MAAI,IAAA,CAAA,CAAE,WAAW,GAAK,EAAA;AACpB,QAAA,MAAA,GAAS,gBAAgB,QAAQ,CAAA;AAAA;AACnC;AAEF,IAAO,OAAA,MAAA;AAAA,GACN,EAAA,CAAC,QAAU,EAAA,OAAO,CAAC,CAAA;AAEtB,EAAA,IAAI,KAAO,EAAA;AACT,IAAA,kBAAA,CAAmB,UAAU,KAAK,CAAA;AAAA;AAGpC,EAAO,OAAA;AAAA,IACL,WAAA,EAAa,KAAS,GAAA,KAAA,CAAM,IAA2B,GAAA,KAAA,CAAA;AAAA,IACvD,OAAA;AAAA,IACA;AAAA,GACF;AACF;;;;"}