{"version":3,"file":"ResultLinksMenu.esm.js","sources":["../../../src/components/ResultLinksMenu/ResultLinksMenu.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  useState,\n  PropsWithChildren,\n  useCallback,\n  useEffect,\n  useMemo,\n} from 'react';\nimport { useApi } from '@backstage/core-plugin-api';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport { techInsightsApiRef } from '../../api';\nimport { CheckResult } from '@backstage-community/plugin-tech-insights-common';\nimport { Entity, stringifyEntityRef } from '@backstage/catalog-model';\n\n/**\n * ResultLinksMenu setMenu receiver.\n *\n * This object contains an {@link ResultLinksMenuInfo.open | open} function,\n * which can be used to open the popup menu. It closes automatically on\n * click-away.\n *\n * @public\n */\nexport type ResultLinksMenuInfo = {\n  /**\n   * Call this function to open the popup menu. The element argument should be\n   * an element which is used as an anchor for the menu - where to display it.\n   */\n  open: (element: Element) => void;\n};\n\n/**\n * A component that renders a popup menu with links related to a check result.\n *\n * @public\n */\nexport const ResultLinksMenu = (\n  props: PropsWithChildren<{\n    result: CheckResult;\n    entity?: Entity;\n    setMenu(opener: ResultLinksMenuInfo | undefined): void;\n  }>,\n) => {\n  const { result, entity, setMenu } = props;\n  const api = useApi(techInsightsApiRef);\n\n  const links = useMemo(\n    () =>\n      entity\n        ? api.getLinksForEntity(result, entity, {\n            includeStaticLinks: true,\n          })\n        : result.check.links ?? [],\n    [api, result, entity],\n  );\n\n  const menuId = `menu-${result.check.id}-${\n    entity ? stringifyEntityRef(entity) : 'unknown'\n  }`;\n\n  const [anchorEl, setAnchorEl] = useState<Element | undefined>(undefined);\n\n  useEffect(() => {\n    if (links.length === 0) {\n      setMenu(undefined);\n      return;\n    }\n    setMenu({\n      open: (elem: Element) => {\n        setAnchorEl(elem);\n      },\n    });\n  }, [setMenu, links]);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(undefined);\n  }, [setAnchorEl]);\n\n  if (links.length === 0) {\n    return null;\n  }\n\n  return (\n    <Menu\n      id={menuId}\n      anchorEl={anchorEl ?? null}\n      keepMounted\n      open={Boolean(anchorEl)}\n      onClose={handleClose}\n    >\n      {links.map((link, i) => (\n        <MenuItem\n          key={`${i}-${link.url}`}\n          button\n          component=\"a\"\n          href={link.url}\n          target={link.url.startsWith('/') ? undefined : '_blank'}\n          onClick={handleClose}\n        >\n          {link.title}\n        </MenuItem>\n      ))}\n    </Menu>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAoDa,MAAA,eAAA,GAAkB,CAC7B,KAKG,KAAA;AACH,EAAA,MAAM,EAAE,MAAA,EAAQ,MAAQ,EAAA,OAAA,EAAY,GAAA,KAAA;AACpC,EAAM,MAAA,GAAA,GAAM,OAAO,kBAAkB,CAAA;AAErC,EAAA,MAAM,KAAQ,GAAA,OAAA;AAAA,IACZ,MACE,MAAA,GACI,GAAI,CAAA,iBAAA,CAAkB,QAAQ,MAAQ,EAAA;AAAA,MACpC,kBAAoB,EAAA;AAAA,KACrB,CAAA,GACD,MAAO,CAAA,KAAA,CAAM,SAAS,EAAC;AAAA,IAC7B,CAAC,GAAK,EAAA,MAAA,EAAQ,MAAM;AAAA,GACtB;AAEA,EAAM,MAAA,MAAA,GAAS,CAAQ,KAAA,EAAA,MAAA,CAAO,KAAM,CAAA,EAAE,IACpC,MAAS,GAAA,kBAAA,CAAmB,MAAM,CAAA,GAAI,SACxC,CAAA,CAAA;AAEA,EAAA,MAAM,CAAC,QAAA,EAAU,WAAW,CAAA,GAAI,SAA8B,KAAS,CAAA,CAAA;AAEvE,EAAA,SAAA,CAAU,MAAM;AACd,IAAI,IAAA,KAAA,CAAM,WAAW,CAAG,EAAA;AACtB,MAAA,OAAA,CAAQ,KAAS,CAAA,CAAA;AACjB,MAAA;AAAA;AAEF,IAAQ,OAAA,CAAA;AAAA,MACN,IAAA,EAAM,CAAC,IAAkB,KAAA;AACvB,QAAA,WAAA,CAAY,IAAI,CAAA;AAAA;AAClB,KACD,CAAA;AAAA,GACA,EAAA,CAAC,OAAS,EAAA,KAAK,CAAC,CAAA;AAEnB,EAAM,MAAA,WAAA,GAAc,YAAY,MAAM;AACpC,IAAA,WAAA,CAAY,KAAS,CAAA,CAAA;AAAA,GACvB,EAAG,CAAC,WAAW,CAAC,CAAA;AAEhB,EAAI,IAAA,KAAA,CAAM,WAAW,CAAG,EAAA;AACtB,IAAO,OAAA,IAAA;AAAA;AAGT,EACE,uBAAA,GAAA;AAAA,IAAC,IAAA;AAAA,IAAA;AAAA,MACC,EAAI,EAAA,MAAA;AAAA,MACJ,UAAU,QAAY,IAAA,IAAA;AAAA,MACtB,WAAW,EAAA,IAAA;AAAA,MACX,IAAA,EAAM,QAAQ,QAAQ,CAAA;AAAA,MACtB,OAAS,EAAA,WAAA;AAAA,MAER,QAAM,EAAA,KAAA,CAAA,GAAA,CAAI,CAAC,IAAA,EAAM,CAChB,qBAAA,GAAA;AAAA,QAAC,QAAA;AAAA,QAAA;AAAA,UAEC,MAAM,EAAA,IAAA;AAAA,UACN,SAAU,EAAA,GAAA;AAAA,UACV,MAAM,IAAK,CAAA,GAAA;AAAA,UACX,QAAQ,IAAK,CAAA,GAAA,CAAI,UAAW,CAAA,GAAG,IAAI,KAAY,CAAA,GAAA,QAAA;AAAA,UAC/C,OAAS,EAAA,WAAA;AAAA,UAER,QAAK,EAAA,IAAA,CAAA;AAAA,SAAA;AAAA,QAPD,CAAG,EAAA,CAAC,CAAI,CAAA,EAAA,IAAA,CAAK,GAAG,CAAA;AAAA,OASxB;AAAA;AAAA,GACH;AAEJ;;;;"}