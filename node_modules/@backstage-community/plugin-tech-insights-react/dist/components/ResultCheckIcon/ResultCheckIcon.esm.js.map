{"version":3,"file":"ResultCheckIcon.esm.js","sources":["../../../src/components/ResultCheckIcon/ResultCheckIcon.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport type { ReactElement } from 'react';\n\nimport {\n  ElementType,\n  MouseEventHandler,\n  PropsWithChildren,\n  ReactNode,\n  useState,\n} from 'react';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { CheckResult } from '@backstage-community/plugin-tech-insights-common';\nimport { Entity } from '@backstage/catalog-model';\nimport IconButton from '@material-ui/core/IconButton';\nimport Alert from '@material-ui/lab/Alert';\nimport { techInsightsApiRef } from '../../api';\nimport { ResultLinksMenu, ResultLinksMenuInfo } from '../ResultLinksMenu';\nimport { CheckResultRenderer } from '../CheckResultRenderer';\n\n/** @public */\nexport type ResultCheckIconBaseComponentProps = PropsWithChildren<{\n  onClick?: MouseEventHandler;\n}>;\n\n/**\n * ResultCheckIcon props\n *\n * The only necessary prop is {@link ResultCheckIconProps.result}, but if\n * {@link ResultCheckIconProps.entity} is provided, the popup menu with links\n * will also include links specifically for this entity.\n *\n * @public\n */\nexport interface ResultCheckIconProps<\n  P extends ResultCheckIconBaseComponentProps,\n> {\n  /**\n   * The CheckResult object to create an icon for\n   */\n  result: CheckResult;\n  /**\n   * The entity for which this check result is created. This is optional, but if\n   * provided, entity-specific links will be added to the popup menu, if any.\n   */\n  entity?: Entity;\n  /**\n   * This can optionally be provided, with a small performance improvement, if\n   * it is already cashed upstream.\n   */\n  checkResultRenderer?: CheckResultRenderer;\n  /**\n   * Will disable the popup menu\n   */\n  disableLinksMenu?: boolean;\n  /**\n   * The icon is rendered with an `IconButton` which handles the onClick.\n   * To wrap this in another component, handling the onClick, pass a component,\n   * such as `ListItemSecondaryAction` which handles the `onClick` to open the\n   * popup menu.\n   *\n   * The {@link ResultCheckIconProps.componentProps} prop can be specified to\n   * add props to the wrapping component.\n   */\n  component?: ElementType<P>;\n  /**\n   * Props to provide to the wrapping component\n   * {@link ResultCheckIconProps.component}.\n   */\n  componentProps?: Omit<P, 'onClick' | 'children'>;\n  /**\n   * Override the component used to display instead of a result icon, when no\n   * renderer was found for this check type.\n   */\n  missingRendererComponent?: ReactNode;\n}\n\n/**\n * A component that renders an icon representing a check result, optionally with a popup menu\n * containing links related to the check.\n *\n * @public\n */\nexport const ResultCheckIcon = <P extends ResultCheckIconBaseComponentProps>(\n  props: ResultCheckIconProps<P>,\n) => {\n  const {\n    result,\n    entity,\n    disableLinksMenu,\n    component,\n    componentProps,\n    missingRendererComponent = <Alert severity=\"error\">Unknown type.</Alert>,\n  } = props;\n\n  const api = useApi(techInsightsApiRef);\n\n  const checkResultRenderer =\n    props.checkResultRenderer ??\n    api.getCheckResultRenderers([result.check.type])[0];\n\n  const [menu, setMenu] = useState<ResultLinksMenuInfo | undefined>();\n\n  const iconComponent = checkResultRenderer?.component(result);\n\n  const onClick: MouseEventHandler = event => {\n    menu?.open(event.currentTarget);\n  };\n\n  const wrapActions = (inner: ReactElement): ReactNode => {\n    if (!menu) {\n      if (component) {\n        const Component =\n          component as ElementType<ResultCheckIconBaseComponentProps>;\n        return <Component {...componentProps}>{inner}</Component>;\n      }\n      return inner;\n    }\n\n    if (component) {\n      const Component =\n        component as ElementType<ResultCheckIconBaseComponentProps>;\n      return (\n        <Component {...componentProps} onClick={onClick}>\n          <IconButton edge=\"end\" aria-label=\"icon\">\n            {inner}\n          </IconButton>\n        </Component>\n      );\n    }\n    return (\n      <IconButton edge=\"end\" aria-label=\"icon\" onClick={onClick}>\n        {inner}\n      </IconButton>\n    );\n  };\n\n  return (\n    <>\n      {!disableLinksMenu && (\n        <ResultLinksMenu result={result} entity={entity} setMenu={setMenu} />\n      )}\n      {wrapActions(iconComponent ?? missingRendererComponent)}\n    </>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAgGa,MAAA,eAAA,GAAkB,CAC7B,KACG,KAAA;AACH,EAAM,MAAA;AAAA,IACJ,MAAA;AAAA,IACA,MAAA;AAAA,IACA,gBAAA;AAAA,IACA,SAAA;AAAA,IACA,cAAA;AAAA,IACA,wBAA2B,mBAAA,GAAA,CAAC,KAAM,EAAA,EAAA,QAAA,EAAS,SAAQ,QAAa,EAAA,eAAA,EAAA;AAAA,GAC9D,GAAA,KAAA;AAEJ,EAAM,MAAA,GAAA,GAAM,OAAO,kBAAkB,CAAA;AAErC,EAAM,MAAA,mBAAA,GACJ,KAAM,CAAA,mBAAA,IACN,GAAI,CAAA,uBAAA,CAAwB,CAAC,MAAA,CAAO,KAAM,CAAA,IAAI,CAAC,CAAA,CAAE,CAAC,CAAA;AAEpD,EAAA,MAAM,CAAC,IAAA,EAAM,OAAO,CAAA,GAAI,QAA0C,EAAA;AAElE,EAAM,MAAA,aAAA,GAAgB,mBAAqB,EAAA,SAAA,CAAU,MAAM,CAAA;AAE3D,EAAA,MAAM,UAA6B,CAAS,KAAA,KAAA;AAC1C,IAAM,IAAA,EAAA,IAAA,CAAK,MAAM,aAAa,CAAA;AAAA,GAChC;AAEA,EAAM,MAAA,WAAA,GAAc,CAAC,KAAmC,KAAA;AACtD,IAAA,IAAI,CAAC,IAAM,EAAA;AACT,MAAA,IAAI,SAAW,EAAA;AACb,QAAA,MAAM,SACJ,GAAA,SAAA;AACF,QAAA,uBAAQ,GAAA,CAAA,SAAA,EAAA,EAAW,GAAG,cAAA,EAAiB,QAAM,EAAA,KAAA,EAAA,CAAA;AAAA;AAE/C,MAAO,OAAA,KAAA;AAAA;AAGT,IAAA,IAAI,SAAW,EAAA;AACb,MAAA,MAAM,SACJ,GAAA,SAAA;AACF,MAAA,uBACG,GAAA,CAAA,SAAA,EAAA,EAAW,GAAG,cAAA,EAAgB,OAC7B,EAAA,QAAA,kBAAA,GAAA,CAAC,UAAW,EAAA,EAAA,IAAA,EAAK,KAAM,EAAA,YAAA,EAAW,MAC/B,EAAA,QAAA,EAAA,KAAA,EACH,CACF,EAAA,CAAA;AAAA;AAGJ,IAAA,2BACG,UAAW,EAAA,EAAA,IAAA,EAAK,OAAM,YAAW,EAAA,MAAA,EAAO,SACtC,QACH,EAAA,KAAA,EAAA,CAAA;AAAA,GAEJ;AAEA,EAAA,uBAEK,IAAA,CAAA,QAAA,EAAA,EAAA,QAAA,EAAA;AAAA,IAAA,CAAC,gBACA,oBAAA,GAAA,CAAC,eAAgB,EAAA,EAAA,MAAA,EAAgB,QAAgB,OAAkB,EAAA,CAAA;AAAA,IAEpE,WAAA,CAAY,iBAAiB,wBAAwB;AAAA,GACxD,EAAA,CAAA;AAEJ;;;;"}