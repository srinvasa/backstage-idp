{"version":3,"file":"TechInsightsClient.esm.js","sources":["../../src/api/TechInsightsClient.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { TechInsightsApi } from './TechInsightsApi';\nimport { DiscoveryApi, IdentityApi } from '@backstage/core-plugin-api';\nimport { TechInsightsClient as TechInsightsClientBase } from '@backstage-community/plugin-tech-insights-common/client';\nimport {\n  CheckLink,\n  CheckResult,\n} from '@backstage-community/plugin-tech-insights-common';\nimport {\n  CheckResultRenderer,\n  jsonRulesEngineCheckResultRenderer,\n} from '../components/CheckResultRenderer';\nimport { Entity } from '@backstage/catalog-model';\n\n/**\n * Implementation of the {@link TechInsightsApi} interface.\n *\n * @public\n */\nexport class TechInsightsClient\n  extends TechInsightsClientBase\n  implements TechInsightsApi\n{\n  private readonly renderers?: CheckResultRenderer[];\n  private readonly customGetEntityLinks: (\n    result: CheckResult,\n    entity: Entity,\n  ) => CheckLink[];\n\n  constructor(options: {\n    discoveryApi: DiscoveryApi;\n    identityApi: IdentityApi;\n    renderers?: CheckResultRenderer[];\n    getEntityLinks?: (result: CheckResult, entity: Entity) => CheckLink[];\n  }) {\n    super(options);\n    this.renderers = options.renderers;\n    this.customGetEntityLinks = options.getEntityLinks ?? (() => []);\n  }\n\n  /**\n   * Get the check result renderers for the given check types.\n   *\n   * @param types - The types of checks to get renderers for\n   * @returns An array of check result renderers\n   *\n   * @public\n   */\n  getCheckResultRenderers(types: string[]): CheckResultRenderer[] {\n    const renderers = this.renderers ?? [jsonRulesEngineCheckResultRenderer];\n    return renderers.filter(d => types.includes(d.type));\n  }\n\n  /**\n   * Determine if a check result represents a failure.\n   *\n   * @param check - The check result to evaluate\n   * @returns true if the check result represents a failure, false otherwise\n   *\n   * @public\n   */\n  isCheckResultFailed(check: CheckResult) {\n    const checkResultRenderers = this.getCheckResultRenderers([\n      check.check.type,\n    ]);\n    if (checkResultRenderers[0] && checkResultRenderers[0].isFailed) {\n      return checkResultRenderers[0].isFailed(check);\n    }\n    return true;\n  }\n\n  /**\n   * Get the links for a given check result and entity.\n   *\n   * @param result - The check result to get links for\n   * @param entity - The entity to get links for\n   * @param options - Optional options for the links\n   * @returns An array of check links\n   *\n   * @public\n   */\n  getLinksForEntity(\n    result: CheckResult,\n    entity: Entity,\n    options: { includeStaticLinks?: boolean } = {},\n  ): CheckLink[] {\n    const links = this.customGetEntityLinks(result, entity);\n    if (options.includeStaticLinks) {\n      links.push(...(result.check.links ?? []));\n    }\n    return links;\n  }\n}\n"],"names":["TechInsightsClientBase"],"mappings":";;;AAkCO,MAAM,2BACHA,oBAEV,CAAA;AAAA,EACmB,SAAA;AAAA,EACA,oBAAA;AAAA,EAKjB,YAAY,OAKT,EAAA;AACD,IAAA,KAAA,CAAM,OAAO,CAAA;AACb,IAAA,IAAA,CAAK,YAAY,OAAQ,CAAA,SAAA;AACzB,IAAA,IAAA,CAAK,oBAAuB,GAAA,OAAA,CAAQ,cAAmB,KAAA,MAAM,EAAC,CAAA;AAAA;AAChE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,wBAAwB,KAAwC,EAAA;AAC9D,IAAA,MAAM,SAAY,GAAA,IAAA,CAAK,SAAa,IAAA,CAAC,kCAAkC,CAAA;AACvE,IAAA,OAAO,UAAU,MAAO,CAAA,CAAA,CAAA,KAAK,MAAM,QAAS,CAAA,CAAA,CAAE,IAAI,CAAC,CAAA;AAAA;AACrD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUA,oBAAoB,KAAoB,EAAA;AACtC,IAAM,MAAA,oBAAA,GAAuB,KAAK,uBAAwB,CAAA;AAAA,MACxD,MAAM,KAAM,CAAA;AAAA,KACb,CAAA;AACD,IAAA,IAAI,qBAAqB,CAAC,CAAA,IAAK,oBAAqB,CAAA,CAAC,EAAE,QAAU,EAAA;AAC/D,MAAA,OAAO,oBAAqB,CAAA,CAAC,CAAE,CAAA,QAAA,CAAS,KAAK,CAAA;AAAA;AAE/C,IAAO,OAAA,IAAA;AAAA;AACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,iBACE,CAAA,MAAA,EACA,MACA,EAAA,OAAA,GAA4C,EAC/B,EAAA;AACb,IAAA,MAAM,KAAQ,GAAA,IAAA,CAAK,oBAAqB,CAAA,MAAA,EAAQ,MAAM,CAAA;AACtD,IAAA,IAAI,QAAQ,kBAAoB,EAAA;AAC9B,MAAA,KAAA,CAAM,KAAK,GAAI,MAAA,CAAO,KAAM,CAAA,KAAA,IAAS,EAAG,CAAA;AAAA;AAE1C,IAAO,OAAA,KAAA;AAAA;AAEX;;;;"}