{"version":3,"file":"JfrogArtifactoryRepository.esm.js","sources":["../../../src/components/JfrogArtifactoryRepository/JfrogArtifactoryRepository.tsx"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useState } from 'react';\nimport { useAsync } from 'react-use';\n\nimport { Link, Progress, Table } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\n\nimport { Box, Chip, makeStyles } from '@material-ui/core';\n\nimport { jfrogArtifactoryApiRef } from '../../api';\nimport { Edge } from '../../types';\nimport { columns, useStyles } from './tableHeading';\nimport { formatByteSize, formatDate } from '../../utils';\n\nconst useLocalStyles = makeStyles({\n  chip: {\n    margin: 0,\n    marginRight: '.2em',\n    height: '1.5em',\n    '& > span': {\n      padding: '.3em',\n    },\n  },\n});\n\nexport function JfrogArtifactoryRepository({ image, target }: RepositoryProps) {\n  const jfrogArtifactoryClient = useApi(jfrogArtifactoryApiRef);\n  const classes = useStyles();\n  const localClasses = useLocalStyles();\n  const [edges, setEdges] = useState<Edge[]>([]);\n  const titleprop = `Jfrog Artifactory repository: ${image}`;\n\n  const { loading } = useAsync(async () => {\n    const tagsResponse = await jfrogArtifactoryClient.getTags(image, target);\n\n    setEdges(tagsResponse.data.versions.edges);\n\n    return tagsResponse;\n  });\n\n  if (loading) {\n    return <Progress />;\n  }\n\n  const data = edges?.map((edge: Edge) => {\n    const shortHash = edge.node.files\n      .find(manifest => manifest.name === 'manifest.json')\n      ?.sha256.substring(0, 12);\n    return {\n      name: edge.node.name,\n      last_modified: formatDate(edge.node.modified),\n      size: formatByteSize(Number(edge.node.size)),\n      manifest_digest: (\n        <Box sx={{ display: 'flex', alignItems: 'center' }}>\n          <Chip label=\"sha256\" className={localClasses.chip} />\n          {shortHash}\n        </Box>\n      ),\n      repositories:\n        `${edge.node.repos.length}` +\n        ' | ' +\n        `${edge.node.repos.map(repo => repo.name).join('| ')}`,\n    };\n  });\n\n  return (\n    <div style={{ border: '1px solid #ddd' }}>\n      <Table\n        title={titleprop}\n        options={{ paging: true, padding: 'dense' }}\n        data={data}\n        columns={columns}\n        emptyContent={\n          <div className={classes.empty}>\n            No data was added yet,&nbsp;\n            <Link to=\"https://backstage.io/\">learn how to add data</Link>.\n          </div>\n        }\n      />\n    </div>\n  );\n}\n\ninterface RepositoryProps {\n  image: string;\n  target?: string;\n}\n"],"names":[],"mappings":"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"}