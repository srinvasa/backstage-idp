{"version":3,"file":"ScorecardsPage.esm.js","sources":["../../../src/components/ScorecardsPage/ScorecardsPage.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState } from 'react';\nimport {\n  Content,\n  ErrorPanel,\n  Header,\n  HeaderLabel,\n  Page,\n  TableColumn,\n  Table,\n  TableOptions,\n} from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport {\n  Check,\n  BulkCheckResponse,\n} from '@backstage-community/plugin-tech-insights-common';\nimport useAsync from 'react-use/lib/useAsync';\nimport { EntityRefLink } from '@backstage/plugin-catalog-react';\nimport { ScorecardsList } from '../ScorecardsList';\nimport Grid from '@material-ui/core/Grid';\nimport { Filters } from './Filters';\nimport { ExportCsv as exportCsv } from '@material-table/exporters';\nimport { techInsightsApiRef } from '@backstage-community/plugin-tech-insights-react';\nimport { ScorecardsBadge } from '../ScorecardsBadge';\n\nexport const ScorecardsPage = (props: { badge?: boolean; dense?: boolean }) => {\n  const api = useApi(techInsightsApiRef);\n  const [filterSelectedChecks, setFilterSelectedChecks] = useState<Check[]>([]);\n  const [filterWithResults, setFilterWithResults] = useState<boolean>(true);\n  const tableOptions: TableOptions = {\n    exportAllData: true,\n    exportMenu: [\n      {\n        label: 'Export CSV',\n        exportFunc: (cols, datas) => exportCsv(cols, datas, 'tech-insights'),\n      },\n    ],\n    pageSize: props.badge ? 15 : 5,\n    pageSizeOptions: props.badge ? [15, 30, 100] : [5, 10, 20],\n    padding: `${props.dense ? 'dense' : 'default'}`,\n  };\n\n  const { value, loading, error } = useAsync(async () => {\n    const checks = await api.getAllChecks();\n    const result = await api.runBulkChecks([], filterSelectedChecks);\n\n    return {\n      checks,\n      result: filterWithResults\n        ? result.filter(response => response.results.length > 0)\n        : result.filter(\n            response =>\n              (response.results?.length ?? 0) === 0 ||\n              response.results.every(r => r.result === false),\n          ),\n    };\n  }, [api, filterSelectedChecks, filterWithResults]);\n\n  const tableColumns = useMemo(() => {\n    const columns: TableColumn<BulkCheckResponse[0]>[] = [\n      {\n        field: 'entity',\n        title: 'Entity',\n        render: row => <EntityRefLink entityRef={row.entity} />,\n      },\n      {\n        field: 'results',\n        title: 'Results',\n        render: row =>\n          props.badge ? (\n            <ScorecardsBadge checkResults={row.results} />\n          ) : (\n            <ScorecardsList checkResults={row.results} dense={props.dense} />\n          ),\n        export: false,\n      },\n    ];\n\n    (filterSelectedChecks.length === 0\n      ? value?.checks || []\n      : filterSelectedChecks\n    ).forEach(check => {\n      columns.push({\n        field: check.id,\n        title: check.name,\n        customExport: row =>\n          `${\n            row.results.filter(\n              result => result && result.check && result.check.id === check.id,\n            )[0]?.result\n          }`,\n        hidden: true,\n        export: true,\n      });\n    });\n\n    return columns;\n  }, [props, value, filterSelectedChecks]);\n\n  if (error) {\n    return <ErrorPanel error={error} />;\n  }\n\n  return (\n    <Page themeId=\"tool\">\n      <Header title=\"Tech insights\">\n        <HeaderLabel label=\"Entities\" value={value?.result.length ?? 0} />\n        <HeaderLabel label=\"Checks\" value={value?.checks.length ?? 0} />\n      </Header>\n      <Content>\n        <Grid container>\n          <Grid item style={{ width: '300px' }}>\n            <Filters\n              checksChanged={checks => setFilterSelectedChecks(checks)}\n              withResultsChanged={withResults =>\n                setFilterWithResults(withResults)\n              }\n            />\n          </Grid>\n          <Grid item xs>\n            <Table\n              columns={tableColumns}\n              data={value?.result ?? []}\n              isLoading={loading}\n              options={tableOptions}\n            />\n          </Grid>\n        </Grid>\n      </Content>\n    </Page>\n  );\n};\n"],"names":["exportCsv"],"mappings":"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"}