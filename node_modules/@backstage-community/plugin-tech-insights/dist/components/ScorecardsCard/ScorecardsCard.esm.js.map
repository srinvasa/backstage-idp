{"version":3,"file":"ScorecardsCard.esm.js","sources":["../../../src/components/ScorecardsCard/ScorecardsCard.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo } from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport { ErrorPanel, Progress } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { ScorecardInfo } from '../ScorecardsInfo';\nimport { techInsightsApiRef } from '@backstage-community/plugin-tech-insights-react';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { getCompoundEntityRef } from '@backstage/catalog-model';\nimport { Check } from '@backstage-community/plugin-tech-insights-common';\nimport { ScorecardsGauge } from '../ScorecardsGauge';\n\nexport const ScorecardsCard = (props: {\n  title: string;\n  description?: string;\n  checksId?: string[];\n  filter?: (check: Check) => boolean;\n  onlyFailed?: boolean;\n  expanded?: boolean;\n  gauge?: boolean;\n  dense?: boolean;\n}) => {\n  const {\n    title,\n    description,\n    checksId,\n    filter,\n    onlyFailed,\n    gauge,\n    expanded = !gauge,\n    dense = true,\n  } = props;\n  const api = useApi(techInsightsApiRef);\n  const { entity } = useEntity();\n  const { value, loading, error } = useAsync(\n    async () => await api.runChecks(getCompoundEntityRef(entity), checksId),\n    [api, entity, JSON.stringify(checksId)],\n  );\n\n  const filteredValues =\n    !filter || !value ? value : value.filter(val => filter(val.check));\n\n  const checkResultRenderers = useMemo(() => {\n    if (!onlyFailed || !filteredValues) return {};\n\n    const types = [...new Set(filteredValues.map(({ check }) => check.type))];\n    const renderers = api.getCheckResultRenderers(types);\n    return Object.fromEntries(\n      renderers.map(renderer => [renderer.type, renderer]),\n    );\n  }, [api, filteredValues, onlyFailed]);\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <ErrorPanel error={error} />;\n  }\n\n  const filteredValue = !onlyFailed\n    ? filteredValues || []\n    : (filteredValues || []).filter(val =>\n        checkResultRenderers[val.check.type]?.isFailed?.(val),\n      );\n\n  return gauge ? (\n    <ScorecardsGauge\n      title={title}\n      description={description}\n      entity={entity}\n      checkResults={filteredValue}\n      noWarning={onlyFailed}\n      expanded={expanded}\n      dense={dense}\n    />\n  ) : (\n    <ScorecardInfo\n      title={title}\n      description={description}\n      entity={entity}\n      checkResults={filteredValue}\n      noWarning={onlyFailed}\n      expanded={expanded}\n      dense={dense}\n    />\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;AA2Ba,MAAA,cAAA,GAAiB,CAAC,KASzB,KAAA;AACJ,EAAM,MAAA;AAAA,IACJ,KAAA;AAAA,IACA,WAAA;AAAA,IACA,QAAA;AAAA,IACA,MAAA;AAAA,IACA,UAAA;AAAA,IACA,KAAA;AAAA,IACA,WAAW,CAAC,KAAA;AAAA,IACZ,KAAQ,GAAA;AAAA,GACN,GAAA,KAAA;AACJ,EAAM,MAAA,GAAA,GAAM,OAAO,kBAAkB,CAAA;AACrC,EAAM,MAAA,EAAE,MAAO,EAAA,GAAI,SAAU,EAAA;AAC7B,EAAA,MAAM,EAAE,KAAA,EAAO,OAAS,EAAA,KAAA,EAAU,GAAA,QAAA;AAAA,IAChC,YAAY,MAAM,GAAA,CAAI,UAAU,oBAAqB,CAAA,MAAM,GAAG,QAAQ,CAAA;AAAA,IACtE,CAAC,GAAK,EAAA,MAAA,EAAQ,IAAK,CAAA,SAAA,CAAU,QAAQ,CAAC;AAAA,GACxC;AAEA,EAAA,MAAM,cACJ,GAAA,CAAC,MAAU,IAAA,CAAC,KAAQ,GAAA,KAAA,GAAQ,KAAM,CAAA,MAAA,CAAO,CAAO,GAAA,KAAA,MAAA,CAAO,GAAI,CAAA,KAAK,CAAC,CAAA;AAEnE,EAAM,MAAA,oBAAA,GAAuB,QAAQ,MAAM;AACzC,IAAA,IAAI,CAAC,UAAA,IAAc,CAAC,cAAA,SAAuB,EAAC;AAE5C,IAAA,MAAM,KAAQ,GAAA,CAAC,GAAG,IAAI,IAAI,cAAe,CAAA,GAAA,CAAI,CAAC,EAAE,KAAM,EAAA,KAAM,KAAM,CAAA,IAAI,CAAC,CAAC,CAAA;AACxE,IAAM,MAAA,SAAA,GAAY,GAAI,CAAA,uBAAA,CAAwB,KAAK,CAAA;AACnD,IAAA,OAAO,MAAO,CAAA,WAAA;AAAA,MACZ,UAAU,GAAI,CAAA,CAAA,QAAA,KAAY,CAAC,QAAS,CAAA,IAAA,EAAM,QAAQ,CAAC;AAAA,KACrD;AAAA,GACC,EAAA,CAAC,GAAK,EAAA,cAAA,EAAgB,UAAU,CAAC,CAAA;AAEpC,EAAA,IAAI,OAAS,EAAA;AACX,IAAA,2BAAQ,QAAS,EAAA,EAAA,CAAA;AAAA,aACR,KAAO,EAAA;AAChB,IAAO,uBAAA,GAAA,CAAC,cAAW,KAAc,EAAA,CAAA;AAAA;AAGnC,EAAM,MAAA,aAAA,GAAgB,CAAC,UACnB,GAAA,cAAA,IAAkB,EACjB,GAAA,CAAA,cAAA,IAAkB,EAAI,EAAA,MAAA;AAAA,IAAO,SAC5B,oBAAqB,CAAA,GAAA,CAAI,MAAM,IAAI,CAAA,EAAG,WAAW,GAAG;AAAA,GACtD;AAEJ,EAAA,OAAO,KACL,mBAAA,GAAA;AAAA,IAAC,eAAA;AAAA,IAAA;AAAA,MACC,KAAA;AAAA,MACA,WAAA;AAAA,MACA,MAAA;AAAA,MACA,YAAc,EAAA,aAAA;AAAA,MACd,SAAW,EAAA,UAAA;AAAA,MACX,QAAA;AAAA,MACA;AAAA;AAAA,GAGF,mBAAA,GAAA;AAAA,IAAC,aAAA;AAAA,IAAA;AAAA,MACC,KAAA;AAAA,MACA,WAAA;AAAA,MACA,MAAA;AAAA,MACA,YAAc,EAAA,aAAA;AAAA,MACd,SAAW,EAAA,UAAA;AAAA,MACX,QAAA;AAAA,MACA;AAAA;AAAA,GACF;AAEJ;;;;"}