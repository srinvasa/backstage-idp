{"version":3,"file":"config.cjs.js","sources":["../../src/plugin/config.ts"],"sourcesContent":["/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Config, readDurationFromConfig } from '@backstage/config';\nimport {\n  FactLifecycle,\n  FactRetriever,\n  FactRetrieverRegistration,\n} from '@backstage-community/plugin-tech-insights-node';\nimport {\n  createFactRetrieverRegistration,\n  FactRetrieverRegistrationOptions,\n} from '../service';\n\ntype FactRetrieverConfig = Omit<\n  FactRetrieverRegistrationOptions,\n  'factRetriever'\n>;\n\nfunction readLifecycleConfig(\n  config: Config | undefined,\n): FactLifecycle | undefined {\n  if (!config) {\n    return undefined;\n  }\n\n  if (config.has('maxItems')) {\n    return {\n      maxItems: config.getNumber('maxItems'),\n    };\n  }\n\n  return {\n    timeToLive: readDurationFromConfig(config.getConfig('timeToLive')),\n  };\n}\n\nfunction readFactRetrieverConfig(\n  config: Config,\n  name: string,\n): FactRetrieverConfig | undefined {\n  const factRetrieverConfig = config.getOptionalConfig(\n    `techInsights.factRetrievers.${name}`,\n  );\n  if (!factRetrieverConfig) {\n    return undefined;\n  }\n\n  const cadence = factRetrieverConfig.getString('cadence');\n  const initialDelay = factRetrieverConfig.has('initialDelay')\n    ? readDurationFromConfig(factRetrieverConfig.getConfig('initialDelay'))\n    : undefined;\n  const lifecycle = readLifecycleConfig(\n    factRetrieverConfig.getOptionalConfig('lifecycle'),\n  );\n  const timeout = factRetrieverConfig.has('timeout')\n    ? readDurationFromConfig(factRetrieverConfig.getConfig('timeout'))\n    : undefined;\n\n  return {\n    cadence,\n    initialDelay,\n    lifecycle,\n    timeout,\n  };\n}\n\nexport function createFactRetrieverRegistrationFromConfig(\n  config: Config,\n  name: string,\n  factRetriever: FactRetriever,\n): FactRetrieverRegistration | undefined {\n  const factRetrieverConfig = readFactRetrieverConfig(config, name);\n\n  return factRetrieverConfig\n    ? createFactRetrieverRegistration({\n        ...factRetrieverConfig,\n        factRetriever,\n      })\n    : undefined;\n}\n"],"names":["config","readDurationFromConfig","createFactRetrieverRegistration"],"mappings":";;;;;;;;;;;;;;;;;;AAgCA,SAAS,oBACPA,QAC2B,EAAA;AAC3B,EAAA,IAAI,CAACA,QAAQ,EAAA;AACX,IAAO,OAAA,KAAA,CAAA;AAAA;AAGT,EAAI,IAAAA,QAAA,CAAO,GAAI,CAAA,UAAU,CAAG,EAAA;AAC1B,IAAO,OAAA;AAAA,MACL,QAAA,EAAUA,QAAO,CAAA,SAAA,CAAU,UAAU;AAAA,KACvC;AAAA;AAGF,EAAO,OAAA;AAAA,IACL,UAAY,EAAAC,6BAAA,CAAuBD,QAAO,CAAA,SAAA,CAAU,YAAY,CAAC;AAAA,GACnE;AACF;AAEA,SAAS,uBAAA,CACPA,UACA,IACiC,EAAA;AACjC,EAAA,MAAM,sBAAsBA,QAAO,CAAA,iBAAA;AAAA,IACjC,+BAA+B,IAAI,CAAA;AAAA,GACrC;AACA,EAAA,IAAI,CAAC,mBAAqB,EAAA;AACxB,IAAO,OAAA,KAAA,CAAA;AAAA;AAGT,EAAM,MAAA,OAAA,GAAU,mBAAoB,CAAA,SAAA,CAAU,SAAS,CAAA;AACvD,EAAM,MAAA,YAAA,GAAe,mBAAoB,CAAA,GAAA,CAAI,cAAc,CAAA,GACvDC,8BAAuB,mBAAoB,CAAA,SAAA,CAAU,cAAc,CAAC,CACpE,GAAA,KAAA,CAAA;AACJ,EAAA,MAAM,SAAY,GAAA,mBAAA;AAAA,IAChB,mBAAA,CAAoB,kBAAkB,WAAW;AAAA,GACnD;AACA,EAAM,MAAA,OAAA,GAAU,mBAAoB,CAAA,GAAA,CAAI,SAAS,CAAA,GAC7CA,8BAAuB,mBAAoB,CAAA,SAAA,CAAU,SAAS,CAAC,CAC/D,GAAA,KAAA,CAAA;AAEJ,EAAO,OAAA;AAAA,IACL,OAAA;AAAA,IACA,YAAA;AAAA,IACA,SAAA;AAAA,IACA;AAAA,GACF;AACF;AAEgB,SAAA,yCAAA,CACd,MACA,EAAA,IAAA,EACA,aACuC,EAAA;AACvC,EAAM,MAAA,mBAAA,GAAsB,uBAAwB,CAAA,MAAA,EAAQ,IAAI,CAAA;AAEhE,EAAA,OAAO,sBACHC,mDAAgC,CAAA;AAAA,IAC9B,GAAG,mBAAA;AAAA,IACH;AAAA,GACD,CACD,GAAA,KAAA,CAAA;AACN;;;;"}