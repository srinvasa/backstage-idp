{"version":3,"file":"FactRetrieverRegistry.cjs.js","sources":["../../../src/service/fact/FactRetrieverRegistry.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FactRetriever,\n  FactRetrieverRegistration,\n  FactRetrieverRegistry,\n} from '@backstage-community/plugin-tech-insights-node';\nimport { FactSchema } from '@backstage-community/plugin-tech-insights-common';\nimport { ConflictError, NotFoundError } from '@backstage/errors';\n\n/**\n * A basic in memory fact retriever registry.\n *\n * You can replace this with a persistence based version using the FactRetrieverRegistry interface.\n *\n */\nexport class DefaultFactRetrieverRegistry implements FactRetrieverRegistry {\n  private readonly retrievers = new Map<string, FactRetrieverRegistration>();\n\n  constructor(retrievers: FactRetrieverRegistration[]) {\n    retrievers.forEach(r => {\n      this.registerSync(r);\n    });\n  }\n\n  registerSync(registration: FactRetrieverRegistration) {\n    if (this.retrievers.has(registration.factRetriever.id)) {\n      throw new ConflictError(\n        `Tech insight fact retriever with identifier '${registration.factRetriever.id}' has already been registered`,\n      );\n    }\n    this.retrievers.set(registration.factRetriever.id, registration);\n  }\n\n  async register(registration: FactRetrieverRegistration) {\n    this.registerSync(registration);\n  }\n\n  async get(retrieverReference: string): Promise<FactRetrieverRegistration> {\n    const registration = this.retrievers.get(retrieverReference);\n    if (!registration) {\n      throw new NotFoundError(\n        `Tech insight fact retriever with identifier '${retrieverReference}' is not registered.`,\n      );\n    }\n    return registration;\n  }\n\n  async listRetrievers(): Promise<FactRetriever[]> {\n    return [...this.retrievers.values()].map(it => it.factRetriever);\n  }\n\n  async listRegistrations(): Promise<FactRetrieverRegistration[]> {\n    return [...this.retrievers.values()];\n  }\n\n  async getSchemas(): Promise<FactSchema[]> {\n    const retrievers = await this.listRetrievers();\n    return retrievers.map(it => it.schema);\n  }\n}\n"],"names":["ConflictError","NotFoundError"],"mappings":";;;;AA8BO,MAAM,4BAA8D,CAAA;AAAA,EACxD,UAAA,uBAAiB,GAAuC,EAAA;AAAA,EAEzE,YAAY,UAAyC,EAAA;AACnD,IAAA,UAAA,CAAW,QAAQ,CAAK,CAAA,KAAA;AACtB,MAAA,IAAA,CAAK,aAAa,CAAC,CAAA;AAAA,KACpB,CAAA;AAAA;AACH,EAEA,aAAa,YAAyC,EAAA;AACpD,IAAA,IAAI,KAAK,UAAW,CAAA,GAAA,CAAI,YAAa,CAAA,aAAA,CAAc,EAAE,CAAG,EAAA;AACtD,MAAA,MAAM,IAAIA,oBAAA;AAAA,QACR,CAAA,6CAAA,EAAgD,YAAa,CAAA,aAAA,CAAc,EAAE,CAAA,6BAAA;AAAA,OAC/E;AAAA;AAEF,IAAA,IAAA,CAAK,UAAW,CAAA,GAAA,CAAI,YAAa,CAAA,aAAA,CAAc,IAAI,YAAY,CAAA;AAAA;AACjE,EAEA,MAAM,SAAS,YAAyC,EAAA;AACtD,IAAA,IAAA,CAAK,aAAa,YAAY,CAAA;AAAA;AAChC,EAEA,MAAM,IAAI,kBAAgE,EAAA;AACxE,IAAA,MAAM,YAAe,GAAA,IAAA,CAAK,UAAW,CAAA,GAAA,CAAI,kBAAkB,CAAA;AAC3D,IAAA,IAAI,CAAC,YAAc,EAAA;AACjB,MAAA,MAAM,IAAIC,oBAAA;AAAA,QACR,gDAAgD,kBAAkB,CAAA,oBAAA;AAAA,OACpE;AAAA;AAEF,IAAO,OAAA,YAAA;AAAA;AACT,EAEA,MAAM,cAA2C,GAAA;AAC/C,IAAO,OAAA,CAAC,GAAG,IAAA,CAAK,UAAW,CAAA,MAAA,EAAQ,CAAE,CAAA,GAAA,CAAI,CAAM,EAAA,KAAA,EAAA,CAAG,aAAa,CAAA;AAAA;AACjE,EAEA,MAAM,iBAA0D,GAAA;AAC9D,IAAA,OAAO,CAAC,GAAG,IAAK,CAAA,UAAA,CAAW,QAAQ,CAAA;AAAA;AACrC,EAEA,MAAM,UAAoC,GAAA;AACxC,IAAM,MAAA,UAAA,GAAa,MAAM,IAAA,CAAK,cAAe,EAAA;AAC7C,IAAA,OAAO,UAAW,CAAA,GAAA,CAAI,CAAM,EAAA,KAAA,EAAA,CAAG,MAAM,CAAA;AAAA;AAEzC;;;;"}