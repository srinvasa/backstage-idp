{"version":3,"file":"createFactRetriever.cjs.js","sources":["../../../src/service/fact/createFactRetriever.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HumanDuration } from '@backstage/types';\nimport {\n  FactLifecycle,\n  FactRetriever,\n  FactRetrieverRegistration,\n} from '@backstage-community/plugin-tech-insights-node';\nimport { Duration } from 'luxon';\n\n/**\n * @public\n *\n * @param cadence - cron expression to indicate when the fact retriever should be triggered\n * @param factRetriever - Implementation of fact retriever consisting of at least id, version, schema and handler\n * @param lifecycle - Optional lifecycle definition indicating the cleanup logic of facts when this retriever is run\n * @param timeout - Optional duration to determine how long the fact retriever should be allowed to run, defaults to 5 minutes\n *\n */\nexport type FactRetrieverRegistrationOptions = {\n  cadence: string;\n  factRetriever: FactRetriever;\n  lifecycle?: FactLifecycle;\n  timeout?: Duration | HumanDuration;\n  initialDelay?: Duration | HumanDuration;\n};\n\n/**\n * @public\n *\n * A helper function to construct fact retriever registrations.\n * @param cadence - Cron expression to indicate when the fact retriever should be triggered\n * @param factRetriever - Implementation of fact retriever consisting of at least id, version, schema and handler\n * @param lifecycle - Optional lifecycle definition indicating the cleanup logic of facts when this retriever is run\n * @param timeout - Optional duration to determine how long the fact retriever should be allowed to run, defaults to 5 minutes\n * @param initialDelay - Optional initial delay to determine how long the fact retriever should wait before the initial run, defaults to 5 seconds\n *\n *\n * @remarks\n *\n * Cron expressions help:\n * ┌────────────── second (optional)\n # │ ┌──────────── minute\n # │ │ ┌────────── hour\n # │ │ │ ┌──────── day of month\n # │ │ │ │ ┌────── month\n # │ │ │ │ │ ┌──── day of week\n # │ │ │ │ │ │\n # │ │ │ │ │ │\n # * * * * * *\n *\n * Valid lifecycle values:\n * \\{ ttl: \\{ weeks: 2 \\} \\} -- This fact retriever will remove items that are older than 2 weeks when it is run\n * \\{ maxItems: 7 \\} -- This fact retriever will leave 7 newest items in the database when it is run\n *\n */\nexport function createFactRetrieverRegistration(\n  options: FactRetrieverRegistrationOptions,\n): FactRetrieverRegistration {\n  const { cadence, factRetriever, lifecycle, timeout, initialDelay } = options;\n  return {\n    cadence,\n    factRetriever,\n    lifecycle,\n    timeout,\n    initialDelay,\n  };\n}\n"],"names":[],"mappings":";;AAsEO,SAAS,gCACd,OAC2B,EAAA;AAC3B,EAAA,MAAM,EAAE,OAAS,EAAA,aAAA,EAAe,SAAW,EAAA,OAAA,EAAS,cAAiB,GAAA,OAAA;AACrE,EAAO,OAAA;AAAA,IACL,OAAA;AAAA,IACA,aAAA;AAAA,IACA,SAAA;AAAA,IACA,OAAA;AAAA,IACA;AAAA,GACF;AACF;;;;"}