{"version":3,"file":"useProjectInfo.esm.js","sources":["../../src/hooks/useProjectInfo.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { SONARQUBE_PROJECT_KEY_ANNOTATION } from '../components';\n\nexport const SONARQUBE_PROJECT_INSTANCE_SEPARATOR = '/';\n\n/**\n *\n * Try to parse sonarqube information from an entity.\n *\n * If part or all info are not found, they will default to undefined\n *\n * @public\n * @param entity - entity to find the sonarqube information from.\n * @returns a ProjectInfo properly populated.\n */\nexport const useProjectInfo = (\n  entity: Entity,\n): {\n  projectInstance: string | undefined;\n  projectKey: string | undefined;\n} => {\n  let projectInstance = undefined;\n  let projectKey = undefined;\n  const annotation =\n    entity?.metadata.annotations?.[SONARQUBE_PROJECT_KEY_ANNOTATION];\n  if (annotation) {\n    const instanceSeparatorIndex = annotation.indexOf(\n      SONARQUBE_PROJECT_INSTANCE_SEPARATOR,\n    );\n    if (instanceSeparatorIndex > -1) {\n      // Examples:\n      //   instanceA/projectA  -> projectInstance = \"instanceA\" & projectKey = \"projectA\"\n      //   instanceA/tenantA:projectA -> projectInstance = \"instanceA\" & projectKey = \"tenantA:projectA\"\n      //   instanceA/tenantA/projectA -> projectInstance = \"instanceA\" & projectKey = \"tenantA/projectA\"\n      projectInstance = annotation.substring(0, instanceSeparatorIndex);\n      projectKey = annotation.substring(instanceSeparatorIndex + 1);\n    } else {\n      projectKey = annotation;\n    }\n  }\n  return { projectInstance, projectKey };\n};\n"],"names":[],"mappings":";;AAmBO,MAAM,oCAAuC,GAAA,IAAA;AAYvC,MAAA,cAAA,GAAiB,CAC5B,MAIG,KAAA;AACH,EAAA,IAAI,eAAkB,GAAA,KAAA,CAAA,CAAA;AACtB,EAAA,IAAI,UAAa,GAAA,KAAA,CAAA,CAAA;AACjB,EAAA,MAAM,UACJ,GAAA,MAAA,EAAQ,QAAS,CAAA,WAAA,GAAc,gCAAgC,CAAA,CAAA;AACjE,EAAA,IAAI,UAAY,EAAA;AACd,IAAA,MAAM,yBAAyB,UAAW,CAAA,OAAA;AAAA,MACxC,oCAAA;AAAA,KACF,CAAA;AACA,IAAA,IAAI,yBAAyB,CAAI,CAAA,EAAA;AAK/B,MAAkB,eAAA,GAAA,UAAA,CAAW,SAAU,CAAA,CAAA,EAAG,sBAAsB,CAAA,CAAA;AAChE,MAAa,UAAA,GAAA,UAAA,CAAW,SAAU,CAAA,sBAAA,GAAyB,CAAC,CAAA,CAAA;AAAA,KACvD,MAAA;AACL,MAAa,UAAA,GAAA,UAAA,CAAA;AAAA,KACf;AAAA,GACF;AACA,EAAO,OAAA,EAAE,iBAAiB,UAAW,EAAA,CAAA;AACvC;;;;"}