import { useBreakpoint, breakpoints } from './useBreakpoint.esm.js';
import { utilityClassMap } from '../utils/utilityClassMap.esm.js';

function resolveResponsiveValue(value, breakpoint) {
  if (typeof value === "string") {
    return value;
  }
  if (typeof value === "object" && value !== null) {
    const index = breakpoints.findIndex((b) => b.id === breakpoint);
    for (let i = index; i >= 0; i--) {
      if (value[breakpoints[i].id]) {
        return value[breakpoints[i].id];
      }
    }
    for (let i = 0; i < breakpoints.length; i++) {
      if (value[breakpoints[i].id]) {
        return value[breakpoints[i].id];
      }
    }
  }
  return void 0;
}
function useStyles(componentDefinition, props = {}) {
  const { breakpoint } = useBreakpoint();
  const classNames = componentDefinition.classNames;
  const utilityPropNames = ("utilityProps" in componentDefinition ? componentDefinition.utilityProps : []) || [];
  const dataAttributeNames = "dataAttributes" in componentDefinition ? Object.keys(componentDefinition.dataAttributes || {}) : [];
  const incomingStyle = props.style || {};
  const dataAttributes = {};
  for (const key of dataAttributeNames) {
    const value = props[key];
    if (value !== void 0 && value !== null) {
      if (typeof value === "boolean" || typeof value === "number") {
        dataAttributes[`data-${key}`] = String(value);
      } else {
        const resolvedValue = resolveResponsiveValue(value, breakpoint);
        if (resolvedValue !== void 0) {
          dataAttributes[`data-${key}`] = resolvedValue;
        }
      }
    }
  }
  const utilityClassList = [];
  const generatedStyle = {};
  const handleUtilityValue = (key, val, prefix = "") => {
    const utilityConfig = utilityClassMap[key];
    if (!utilityConfig) {
      return;
    }
    if (utilityConfig.values.length > 0 && utilityConfig.values.includes(val)) {
      const className = prefix ? `${prefix}${utilityConfig.class}-${val}` : `${utilityConfig.class}-${val}`;
      utilityClassList.push(className);
    } else if (utilityConfig.cssVar) {
      const cssVarKey = prefix ? `${utilityConfig.cssVar}-${prefix.slice(0, -1)}` : utilityConfig.cssVar;
      generatedStyle[cssVarKey] = val;
      const className = prefix ? `${prefix}${utilityConfig.class}` : utilityConfig.class;
      utilityClassList.push(className);
    }
  };
  for (const key of utilityPropNames) {
    const value = props[key];
    if (value === void 0 || value === null) {
      continue;
    }
    if (typeof value === "object" && value !== null) {
      const breakpointValues = value;
      for (const bp in breakpointValues) {
        const prefix = bp === "initial" ? "" : `${bp}:`;
        handleUtilityValue(key, breakpointValues[bp], prefix);
      }
    } else {
      handleUtilityValue(key, value);
    }
  }
  const utilityPropsSet = new Set(utilityPropNames);
  const cleanedPropsBase = Object.keys(props).reduce((acc, key) => {
    if (!utilityPropsSet.has(key)) {
      acc[key] = props[key];
    }
    return acc;
  }, {});
  const mergedStyle = {
    ...generatedStyle,
    ...incomingStyle
  };
  const cleanedProps = {
    ...cleanedPropsBase,
    style: mergedStyle
  };
  return {
    classNames,
    dataAttributes,
    utilityClasses: utilityClassList.join(" "),
    style: mergedStyle,
    cleanedProps
  };
}

export { useStyles };
//# sourceMappingURL=useStyles.esm.js.map
