{"version":3,"file":"useTable.esm.js","sources":["../../../../src/components/Table/hooks/useTable.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useMemo, useCallback } from 'react';\nimport type { TablePaginationProps } from '../../TablePagination/types';\nimport type {\n  UseTableConfig,\n  UseTableResult,\n  UseTablePagination,\n} from './types';\n\n/**\n * Hook for managing table state including pagination and future features like sorting.\n * Supports both controlled and uncontrolled modes using offset/pageSize pattern (Backstage style).\n *\n * @public\n */\nexport function useTable<T = any>(\n  config: UseTableConfig<T> = {},\n): UseTableResult<T> {\n  const { data, pagination: paginationConfig = {} } = config;\n\n  const {\n    rowCount: providedRowCount,\n    offset: controlledOffset,\n    pageSize: controlledPageSize,\n    onOffsetChange,\n    onPageSizeChange,\n    defaultPageSize = 10,\n    defaultOffset = 0,\n    onNextPage,\n    onPreviousPage,\n    showPageSizeOptions = true,\n  } = paginationConfig;\n\n  // Determine if we're in controlled mode\n  const isControlled =\n    controlledOffset !== undefined || controlledPageSize !== undefined;\n\n  // Calculate row count from data or use provided value\n  const rowCount = data?.length ?? providedRowCount ?? 0;\n\n  // Internal state for uncontrolled mode\n  const [internalOffset, setInternalOffset] = useState(defaultOffset);\n  const [internalPageSize, setInternalPageSize] = useState(defaultPageSize);\n\n  // Calculate current values\n  const currentOffset = controlledOffset ?? internalOffset;\n  const currentPageSize = controlledPageSize ?? internalPageSize;\n\n  // Calculate sliced data if data array is provided\n  const currentData = useMemo(() => {\n    if (!data) return undefined;\n    return data.slice(currentOffset, currentOffset + currentPageSize);\n  }, [data, currentOffset, currentPageSize]);\n\n  // Update functions\n  const setOffset = useCallback(\n    (newOffset: number) => {\n      if (isControlled) {\n        onOffsetChange?.(newOffset);\n      } else {\n        setInternalOffset(newOffset);\n      }\n    },\n    [isControlled, onOffsetChange],\n  );\n\n  const setPageSize = useCallback(\n    (newPageSize: number) => {\n      // When changing page size, reset to first page to avoid showing empty results\n      const newOffset = 0;\n\n      if (isControlled) {\n        onPageSizeChange?.(newPageSize);\n        onOffsetChange?.(newOffset);\n      } else {\n        setInternalPageSize(newPageSize);\n        setInternalOffset(newOffset);\n      }\n    },\n    [isControlled, onPageSizeChange, onOffsetChange],\n  );\n\n  const nextPage = useCallback(() => {\n    const nextOffset = currentOffset + currentPageSize;\n    if (nextOffset < rowCount) {\n      onNextPage?.();\n      setOffset(nextOffset);\n    }\n  }, [currentOffset, currentPageSize, rowCount, onNextPage, setOffset]);\n\n  const previousPage = useCallback(() => {\n    if (currentOffset > 0) {\n      onPreviousPage?.();\n      const prevOffset = Math.max(0, currentOffset - currentPageSize);\n      setOffset(prevOffset);\n    }\n  }, [currentOffset, currentPageSize, onPreviousPage, setOffset]);\n\n  // Pagination props for TablePagination component\n  const paginationProps: TablePaginationProps = useMemo(\n    () => ({\n      offset: currentOffset,\n      pageSize: currentPageSize,\n      rowCount,\n      setOffset,\n      setPageSize,\n      onNextPage,\n      onPreviousPage,\n      showPageSizeOptions,\n    }),\n    [\n      currentOffset,\n      currentPageSize,\n      rowCount,\n      setOffset,\n      setPageSize,\n      onNextPage,\n      onPreviousPage,\n      showPageSizeOptions,\n    ],\n  );\n\n  const pagination: UseTablePagination<T> = useMemo(\n    () => ({\n      paginationProps,\n      offset: currentOffset,\n      pageSize: currentPageSize,\n      data: currentData,\n      nextPage,\n      previousPage,\n      setOffset,\n      setPageSize,\n    }),\n    [\n      paginationProps,\n      currentOffset,\n      currentPageSize,\n      currentData,\n      nextPage,\n      previousPage,\n      setOffset,\n      setPageSize,\n    ],\n  );\n\n  return {\n    data: currentData,\n    paginationProps,\n    pagination,\n  };\n}\n"],"names":[],"mappings":";;AA8BO,SAAS,QAAA,CACd,MAAA,GAA4B,EAAC,EACV;AACnB,EAAA,MAAM,EAAE,IAAA,EAAM,UAAA,EAAY,gBAAA,GAAmB,IAAG,GAAI,MAAA;AAEpD,EAAA,MAAM;AAAA,IACJ,QAAA,EAAU,gBAAA;AAAA,IACV,MAAA,EAAQ,gBAAA;AAAA,IACR,QAAA,EAAU,kBAAA;AAAA,IACV,cAAA;AAAA,IACA,gBAAA;AAAA,IACA,eAAA,GAAkB,EAAA;AAAA,IAClB,aAAA,GAAgB,CAAA;AAAA,IAChB,UAAA;AAAA,IACA,cAAA;AAAA,IACA,mBAAA,GAAsB;AAAA,GACxB,GAAI,gBAAA;AAGJ,EAAA,MAAM,YAAA,GACJ,gBAAA,KAAqB,MAAA,IAAa,kBAAA,KAAuB,MAAA;AAG3D,EAAA,MAAM,QAAA,GAAW,IAAA,EAAM,MAAA,IAAU,gBAAA,IAAoB,CAAA;AAGrD,EAAA,MAAM,CAAC,cAAA,EAAgB,iBAAiB,CAAA,GAAI,SAAS,aAAa,CAAA;AAClE,EAAA,MAAM,CAAC,gBAAA,EAAkB,mBAAmB,CAAA,GAAI,SAAS,eAAe,CAAA;AAGxE,EAAA,MAAM,gBAAgB,gBAAA,IAAoB,cAAA;AAC1C,EAAA,MAAM,kBAAkB,kBAAA,IAAsB,gBAAA;AAG9C,EAAA,MAAM,WAAA,GAAc,QAAQ,MAAM;AAChC,IAAA,IAAI,CAAC,MAAM,OAAO,MAAA;AAClB,IAAA,OAAO,IAAA,CAAK,KAAA,CAAM,aAAA,EAAe,aAAA,GAAgB,eAAe,CAAA;AAAA,EAClE,CAAA,EAAG,CAAC,IAAA,EAAM,aAAA,EAAe,eAAe,CAAC,CAAA;AAGzC,EAAA,MAAM,SAAA,GAAY,WAAA;AAAA,IAChB,CAAC,SAAA,KAAsB;AACrB,MAAA,IAAI,YAAA,EAAc;AAChB,QAAA,cAAA,GAAiB,SAAS,CAAA;AAAA,MAC5B,CAAA,MAAO;AACL,QAAA,iBAAA,CAAkB,SAAS,CAAA;AAAA,MAC7B;AAAA,IACF,CAAA;AAAA,IACA,CAAC,cAAc,cAAc;AAAA,GAC/B;AAEA,EAAA,MAAM,WAAA,GAAc,WAAA;AAAA,IAClB,CAAC,WAAA,KAAwB;AAEvB,MAAA,MAAM,SAAA,GAAY,CAAA;AAElB,MAAA,IAAI,YAAA,EAAc;AAChB,QAAA,gBAAA,GAAmB,WAAW,CAAA;AAC9B,QAAA,cAAA,GAAiB,SAAS,CAAA;AAAA,MAC5B,CAAA,MAAO;AACL,QAAA,mBAAA,CAAoB,WAAW,CAAA;AAC/B,QAAA,iBAAA,CAAkB,SAAS,CAAA;AAAA,MAC7B;AAAA,IACF,CAAA;AAAA,IACA,CAAC,YAAA,EAAc,gBAAA,EAAkB,cAAc;AAAA,GACjD;AAEA,EAAA,MAAM,QAAA,GAAW,YAAY,MAAM;AACjC,IAAA,MAAM,aAAa,aAAA,GAAgB,eAAA;AACnC,IAAA,IAAI,aAAa,QAAA,EAAU;AACzB,MAAA,UAAA,IAAa;AACb,MAAA,SAAA,CAAU,UAAU,CAAA;AAAA,IACtB;AAAA,EACF,GAAG,CAAC,aAAA,EAAe,iBAAiB,QAAA,EAAU,UAAA,EAAY,SAAS,CAAC,CAAA;AAEpE,EAAA,MAAM,YAAA,GAAe,YAAY,MAAM;AACrC,IAAA,IAAI,gBAAgB,CAAA,EAAG;AACrB,MAAA,cAAA,IAAiB;AACjB,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,GAAA,CAAI,CAAA,EAAG,gBAAgB,eAAe,CAAA;AAC9D,MAAA,SAAA,CAAU,UAAU,CAAA;AAAA,IACtB;AAAA,EACF,GAAG,CAAC,aAAA,EAAe,eAAA,EAAiB,cAAA,EAAgB,SAAS,CAAC,CAAA;AAG9D,EAAA,MAAM,eAAA,GAAwC,OAAA;AAAA,IAC5C,OAAO;AAAA,MACL,MAAA,EAAQ,aAAA;AAAA,MACR,QAAA,EAAU,eAAA;AAAA,MACV,QAAA;AAAA,MACA,SAAA;AAAA,MACA,WAAA;AAAA,MACA,UAAA;AAAA,MACA,cAAA;AAAA,MACA;AAAA,KACF,CAAA;AAAA,IACA;AAAA,MACE,aAAA;AAAA,MACA,eAAA;AAAA,MACA,QAAA;AAAA,MACA,SAAA;AAAA,MACA,WAAA;AAAA,MACA,UAAA;AAAA,MACA,cAAA;AAAA,MACA;AAAA;AACF,GACF;AAEA,EAAA,MAAM,UAAA,GAAoC,OAAA;AAAA,IACxC,OAAO;AAAA,MACL,eAAA;AAAA,MACA,MAAA,EAAQ,aAAA;AAAA,MACR,QAAA,EAAU,eAAA;AAAA,MACV,IAAA,EAAM,WAAA;AAAA,MACN,QAAA;AAAA,MACA,YAAA;AAAA,MACA,SAAA;AAAA,MACA;AAAA,KACF,CAAA;AAAA,IACA;AAAA,MACE,eAAA;AAAA,MACA,aAAA;AAAA,MACA,eAAA;AAAA,MACA,WAAA;AAAA,MACA,QAAA;AAAA,MACA,YAAA;AAAA,MACA,SAAA;AAAA,MACA;AAAA;AACF,GACF;AAEA,EAAA,OAAO;AAAA,IACL,IAAA,EAAM,WAAA;AAAA,IACN,eAAA;AAAA,IACA;AAAA,GACF;AACF;;;;"}