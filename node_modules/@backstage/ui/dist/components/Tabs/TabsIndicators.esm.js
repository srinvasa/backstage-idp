import { jsxs, Fragment, jsx } from 'react/jsx-runtime';
import { TabListStateContext } from 'react-aria-components';
import { useStyles } from '../../hooks/useStyles.esm.js';
import { TabsDefinition } from './definition.esm.js';
import { useContext, useRef, useCallback, useEffect } from 'react';
import styles from './Tabs.module.css.esm.js';
import clsx from 'clsx';

const TabsIndicators = (props) => {
  const { tabRefs, tabsRef, hoveredKey, prevHoveredKey } = props;
  const { classNames } = useStyles(TabsDefinition);
  const state = useContext(TabListStateContext);
  const prevSelectedKey = useRef(null);
  const updateCSSVariables = useCallback(() => {
    if (!tabsRef.current) return;
    const tabsRect = tabsRef.current.getBoundingClientRect();
    if (state?.selectedKey) {
      const activeTab = tabRefs.current.get(state.selectedKey.toString());
      if (activeTab) {
        const activeRect = activeTab.getBoundingClientRect();
        const relativeLeft = activeRect.left - tabsRect.left;
        const relativeTop = activeRect.top - tabsRect.top;
        const isFirstActiveTab = prevSelectedKey.current === null;
        if (isFirstActiveTab) {
          tabsRef.current.style.setProperty(
            "--active-transition-duration",
            "0s"
          );
          requestAnimationFrame(() => {
            if (tabsRef.current) {
              tabsRef.current.style.setProperty(
                "--active-transition-duration",
                "0.25s"
              );
            }
          });
        } else {
          tabsRef.current.style.setProperty(
            "--active-transition-duration",
            "0.25s"
          );
        }
        prevSelectedKey.current = state.selectedKey.toString();
        tabsRef.current.style.setProperty(
          "--active-tab-left",
          `${relativeLeft}px`
        );
        tabsRef.current.style.setProperty(
          "--active-tab-right",
          `${relativeLeft + activeRect.width}px`
        );
        tabsRef.current.style.setProperty(
          "--active-tab-top",
          `${relativeTop}px`
        );
        tabsRef.current.style.setProperty(
          "--active-tab-bottom",
          `${relativeTop + activeRect.height}px`
        );
        tabsRef.current.style.setProperty(
          "--active-tab-width",
          `${activeRect.width}px`
        );
        tabsRef.current.style.setProperty(
          "--active-tab-height",
          `${activeRect.height}px`
        );
      }
    }
    if (hoveredKey) {
      const hoveredTab = tabRefs.current.get(hoveredKey);
      if (hoveredTab) {
        const hoveredRect = hoveredTab.getBoundingClientRect();
        const relativeLeft = hoveredRect.left - tabsRect.left;
        const relativeTop = hoveredRect.top - tabsRect.top;
        tabsRef.current.style.setProperty(
          "--hovered-tab-left",
          `${relativeLeft}px`
        );
        tabsRef.current.style.setProperty(
          "--hovered-tab-right",
          `${relativeLeft + hoveredRect.width}px`
        );
        tabsRef.current.style.setProperty(
          "--hovered-tab-top",
          `${relativeTop}px`
        );
        tabsRef.current.style.setProperty(
          "--hovered-tab-bottom",
          `${relativeTop + hoveredRect.height}px`
        );
        tabsRef.current.style.setProperty(
          "--hovered-tab-width",
          `${hoveredRect.width}px`
        );
        tabsRef.current.style.setProperty(
          "--hovered-tab-height",
          `${hoveredRect.height}px`
        );
        const isNewHoverSession = prevHoveredKey.current === null;
        if (isNewHoverSession) {
          tabsRef.current.style.setProperty(
            "--hovered-transition-duration",
            "0s"
          );
          requestAnimationFrame(() => {
            if (tabsRef.current) {
              tabsRef.current.style.setProperty(
                "--hovered-transition-duration",
                "0.2s"
              );
            }
          });
        } else {
          tabsRef.current.style.setProperty(
            "--hovered-transition-duration",
            "0.2s"
          );
        }
        prevHoveredKey.current = hoveredKey;
        tabsRef.current.style.setProperty("--hovered-tab-opacity", "1");
      }
    } else {
      tabsRef.current.style.setProperty("--hovered-tab-opacity", "0");
      prevHoveredKey.current = null;
    }
  }, [state?.selectedKey, hoveredKey, tabRefs.current]);
  useEffect(() => {
    updateCSSVariables();
  }, [updateCSSVariables, tabRefs.current.size]);
  useEffect(() => {
    const handleResize = () => updateCSSVariables();
    window.addEventListener("resize", handleResize);
    return () => window.removeEventListener("resize", handleResize);
  }, [updateCSSVariables]);
  return /* @__PURE__ */ jsxs(Fragment, { children: [
    /* @__PURE__ */ jsx(
      "div",
      {
        className: clsx(classNames.tabActive, styles[classNames.tabActive])
      }
    ),
    /* @__PURE__ */ jsx(
      "div",
      {
        className: clsx(classNames.tabHovered, styles[classNames.tabHovered])
      }
    )
  ] });
};

export { TabsIndicators };
//# sourceMappingURL=TabsIndicators.esm.js.map
