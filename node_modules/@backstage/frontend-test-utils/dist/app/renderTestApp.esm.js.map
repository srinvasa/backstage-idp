{"version":3,"file":"renderTestApp.esm.js","sources":["../../src/app/renderTestApp.tsx"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createSpecializedApp } from '@backstage/frontend-app-api';\nimport {\n  coreExtensionData,\n  createFrontendPlugin,\n  ExtensionDefinition,\n  FrontendFeature,\n  RouterBlueprint,\n} from '@backstage/frontend-plugin-api';\nimport { render } from '@testing-library/react';\nimport appPlugin from '@backstage/plugin-app';\nimport { JsonObject } from '@backstage/types';\nimport { ConfigReader } from '@backstage/config';\nimport { MemoryRouter } from 'react-router-dom';\n\nconst DEFAULT_MOCK_CONFIG = {\n  app: { baseUrl: 'http://localhost:3000' },\n  backend: { baseUrl: 'http://localhost:7007' },\n};\n\n/**\n * Options for `renderTestApp`.\n *\n * @public\n */\nexport type RenderTestAppOptions = {\n  /**\n   * Additional configuration passed to the app when rendering elements inside it.\n   */\n  config?: JsonObject;\n  /**\n   * Additional extensions to add to the test app.\n   */\n  extensions?: ExtensionDefinition<any>[];\n\n  /**\n   * Additional features to add to the test app.\n   */\n  features?: FrontendFeature[];\n\n  /**\n   * Initial route entries to use for the router.\n   */\n  initialRouteEntries?: string[];\n};\n\nconst appPluginOverride = appPlugin.withOverrides({\n  extensions: [\n    appPlugin.getExtension('sign-in-page:app').override({\n      disabled: true,\n    }),\n  ],\n});\n\n/**\n * Renders the provided extensions inside a Backstage app, returning the same\n * utilities as `@testing-library/react` `render` function.\n *\n * @public\n */\nexport function renderTestApp(options: RenderTestAppOptions) {\n  const extensions = [\n    RouterBlueprint.make({\n      params: {\n        component: ({ children }) => (\n          <MemoryRouter initialEntries={options.initialRouteEntries}>\n            {children}\n          </MemoryRouter>\n        ),\n      },\n    }),\n    ...(options.extensions ?? []),\n  ];\n\n  const features: FrontendFeature[] = [\n    createFrontendPlugin({\n      pluginId: 'test',\n      extensions,\n    }),\n    appPluginOverride,\n  ];\n\n  if (options.features) {\n    features.push(...options.features);\n  }\n\n  const app = createSpecializedApp({\n    features,\n    config: ConfigReader.fromConfigs([\n      {\n        context: 'render-config',\n        data: options?.config ?? DEFAULT_MOCK_CONFIG,\n      },\n    ]),\n  });\n\n  return render(\n    app.tree.root.instance!.getData(coreExtensionData.reactElement),\n  );\n}\n"],"names":[],"mappings":";;;;;;;;AA8BA,MAAM,mBAAA,GAAsB;AAAA,EAC1B,GAAA,EAAK,EAAE,OAAA,EAAS,uBAAA,EAAwB;AAAA,EACxC,OAAA,EAAS,EAAE,OAAA,EAAS,uBAAA;AACtB,CAAA;AA4BA,MAAM,iBAAA,GAAoB,UAAU,aAAA,CAAc;AAAA,EAChD,UAAA,EAAY;AAAA,IACV,SAAA,CAAU,YAAA,CAAa,kBAAkB,CAAA,CAAE,QAAA,CAAS;AAAA,MAClD,QAAA,EAAU;AAAA,KACX;AAAA;AAEL,CAAC,CAAA;AAQM,SAAS,cAAc,OAAA,EAA+B;AAC3D,EAAA,MAAM,UAAA,GAAa;AAAA,IACjB,gBAAgB,IAAA,CAAK;AAAA,MACnB,MAAA,EAAQ;AAAA,QACN,SAAA,EAAW,CAAC,EAAE,QAAA,EAAS,yBACpB,YAAA,EAAA,EAAa,cAAA,EAAgB,OAAA,CAAQ,mBAAA,EACnC,QAAA,EACH;AAAA;AAEJ,KACD,CAAA;AAAA,IACD,GAAI,OAAA,CAAQ,UAAA,IAAc;AAAC,GAC7B;AAEA,EAAA,MAAM,QAAA,GAA8B;AAAA,IAClC,oBAAA,CAAqB;AAAA,MACnB,QAAA,EAAU,MAAA;AAAA,MACV;AAAA,KACD,CAAA;AAAA,IACD;AAAA,GACF;AAEA,EAAA,IAAI,QAAQ,QAAA,EAAU;AACpB,IAAA,QAAA,CAAS,IAAA,CAAK,GAAG,OAAA,CAAQ,QAAQ,CAAA;AAAA,EACnC;AAEA,EAAA,MAAM,MAAM,oBAAA,CAAqB;AAAA,IAC/B,QAAA;AAAA,IACA,MAAA,EAAQ,aAAa,WAAA,CAAY;AAAA,MAC/B;AAAA,QACE,OAAA,EAAS,eAAA;AAAA,QACT,IAAA,EAAM,SAAS,MAAA,IAAU;AAAA;AAC3B,KACD;AAAA,GACF,CAAA;AAED,EAAA,OAAO,MAAA;AAAA,IACL,IAAI,IAAA,CAAK,IAAA,CAAK,QAAA,CAAU,OAAA,CAAQ,kBAAkB,YAAY;AAAA,GAChE;AACF;;;;"}