{"version":3,"file":"auth.esm.js","sources":["../../src/hooks/auth.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { KubernetesRequestBody } from '@backstage/plugin-kubernetes-common';\nimport { KubernetesAuthProvidersApi } from '../kubernetes-auth-provider';\nimport { KubernetesApi } from '../api/types';\n\nexport const generateAuth = async (\n  entity: Entity,\n  kubernetesApi: KubernetesApi,\n  kubernetesAuthProvidersApi: KubernetesAuthProvidersApi,\n) => {\n  const clusters = await kubernetesApi.getClusters();\n\n  const authProviders: string[] = [\n    ...new Set(\n      clusters.map(\n        c =>\n          `${c.authProvider}${\n            c.oidcTokenProvider ? `.${c.oidcTokenProvider}` : ''\n          }`,\n      ),\n    ),\n  ];\n\n  let requestBody: KubernetesRequestBody = {\n    entity,\n  };\n  for (const authProviderStr of authProviders) {\n    requestBody = await kubernetesAuthProvidersApi.decorateRequestBodyForAuth(\n      authProviderStr,\n      requestBody,\n    );\n  }\n  return requestBody.auth ?? {};\n};\n"],"names":[],"mappings":"AAqBO,MAAM,YAAA,GAAe,OAC1B,MAAA,EACA,aAAA,EACA,0BAAA,KACG;AACH,EAAA,MAAM,QAAA,GAAW,MAAM,aAAA,CAAc,WAAA,EAAY;AAEjD,EAAA,MAAM,aAAA,GAA0B;AAAA,IAC9B,GAAG,IAAI,GAAA;AAAA,MACL,QAAA,CAAS,GAAA;AAAA,QACP,CAAA,CAAA,KACE,CAAA,EAAG,CAAA,CAAE,YAAY,CAAA,EACf,CAAA,CAAE,iBAAA,GAAoB,CAAA,CAAA,EAAI,CAAA,CAAE,iBAAiB,CAAA,CAAA,GAAK,EACpD,CAAA;AAAA;AACJ;AACF,GACF;AAEA,EAAA,IAAI,WAAA,GAAqC;AAAA,IACvC;AAAA,GACF;AACA,EAAA,KAAA,MAAW,mBAAmB,aAAA,EAAe;AAC3C,IAAA,WAAA,GAAc,MAAM,0BAAA,CAA2B,0BAAA;AAAA,MAC7C,eAAA;AAAA,MACA;AAAA,KACF;AAAA,EACF;AACA,EAAA,OAAO,WAAA,CAAY,QAAQ,EAAC;AAC9B;;;;"}