{"version":3,"file":"useCustomResources.esm.js","sources":["../../src/hooks/useCustomResources.ts"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { useCallback } from 'react';\nimport useInterval from 'react-use/esm/useInterval';\nimport {\n  CustomResourceMatcher,\n  ObjectsByEntityResponse,\n} from '@backstage/plugin-kubernetes-common';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { KubernetesObjects } from './useKubernetesObjects';\nimport { generateAuth } from './auth';\nimport useAsyncRetry from 'react-use/esm/useAsyncRetry';\nimport { kubernetesAuthProvidersApiRef } from '../kubernetes-auth-provider';\nimport { kubernetesApiRef } from '../api/types';\n\n/**\n * Retrieves the provided custom resources related to the provided entity, refreshes at an interval.\n *\n * @public\n */\nexport const useCustomResources = (\n  entity: Entity,\n  customResourceMatchers: CustomResourceMatcher[],\n  intervalMs: number = 10000,\n): KubernetesObjects => {\n  const kubernetesApi = useApi(kubernetesApiRef);\n  const kubernetesAuthProvidersApi = useApi(kubernetesAuthProvidersApiRef);\n  const matchersString = JSON.stringify(customResourceMatchers);\n  const getCustomObjects = useCallback(\n    async (): Promise<ObjectsByEntityResponse> => {\n      const auth = await generateAuth(\n        entity,\n        kubernetesApi,\n        kubernetesAuthProvidersApi,\n      );\n      return await kubernetesApi.getCustomObjectsByEntity({\n        auth,\n        customResources: customResourceMatchers,\n        entity,\n      });\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [kubernetesApi, entity, kubernetesAuthProvidersApi, matchersString],\n  );\n\n  const { value, loading, error, retry } = useAsyncRetry(\n    () => getCustomObjects(),\n    [getCustomObjects],\n  );\n\n  useInterval(() => retry(), intervalMs);\n\n  return {\n    kubernetesObjects: value,\n    loading,\n    error: error?.message,\n  };\n};\n"],"names":[],"mappings":";;;;;;;;AAmCO,MAAM,kBAAA,GAAqB,CAChC,MAAA,EACA,sBAAA,EACA,aAAqB,GAAA,KACC;AACtB,EAAA,MAAM,aAAA,GAAgB,OAAO,gBAAgB,CAAA;AAC7C,EAAA,MAAM,0BAAA,GAA6B,OAAO,6BAA6B,CAAA;AACvE,EAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,SAAA,CAAU,sBAAsB,CAAA;AAC5D,EAAA,MAAM,gBAAA,GAAmB,WAAA;AAAA,IACvB,YAA8C;AAC5C,MAAA,MAAM,OAAO,MAAM,YAAA;AAAA,QACjB,MAAA;AAAA,QACA,aAAA;AAAA,QACA;AAAA,OACF;AACA,MAAA,OAAO,MAAM,cAAc,wBAAA,CAAyB;AAAA,QAClD,IAAA;AAAA,QACA,eAAA,EAAiB,sBAAA;AAAA,QACjB;AAAA,OACD,CAAA;AAAA,IACH,CAAA;AAAA;AAAA,IAEA,CAAC,aAAA,EAAe,MAAA,EAAQ,0BAAA,EAA4B,cAAc;AAAA,GACpE;AAEA,EAAA,MAAM,EAAE,KAAA,EAAO,OAAA,EAAS,KAAA,EAAO,OAAM,GAAI,aAAA;AAAA,IACvC,MAAM,gBAAA,EAAiB;AAAA,IACvB,CAAC,gBAAgB;AAAA,GACnB;AAEA,EAAA,WAAA,CAAY,MAAM,KAAA,EAAM,EAAG,UAAU,CAAA;AAErC,EAAA,OAAO;AAAA,IACL,iBAAA,EAAmB,KAAA;AAAA,IACnB,OAAA;AAAA,IACA,OAAO,KAAA,EAAO;AAAA,GAChB;AACF;;;;"}