{"version":3,"file":"StepsProgress.esm.js","sources":["../../../../src/components/CustomResources/ArgoRollouts/StepsProgress.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode } from 'react';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport Stepper from '@material-ui/core/Stepper';\nimport Typography from '@material-ui/core/Typography';\nimport {\n  ArgoRolloutCanaryStep,\n  SetWeightStep,\n  PauseStep,\n  AnalysisStep,\n} from './types';\n\ninterface StepsProgressProps {\n  currentStepIndex: number;\n  aborted: boolean;\n  steps: ArgoRolloutCanaryStep[];\n  children?: ReactNode;\n}\n\nconst isSetWeightStep = (step: ArgoRolloutCanaryStep): step is SetWeightStep =>\n  step.hasOwnProperty('setWeight');\n\nconst isPauseStep = (step: ArgoRolloutCanaryStep): step is PauseStep =>\n  step.hasOwnProperty('pause');\n\nconst isAnalysisStep = (step: ArgoRolloutCanaryStep): step is AnalysisStep =>\n  step.hasOwnProperty('analysis');\n\nconst createLabelForStep = (step: ArgoRolloutCanaryStep): ReactNode => {\n  if (isSetWeightStep(step)) {\n    return `setWeight ${step.setWeight}%`;\n  } else if (isPauseStep(step)) {\n    return step.pause.duration === undefined\n      ? 'infinite pause'\n      : `pause for ${step.pause.duration}`;\n  } else if (isAnalysisStep(step)) {\n    return (\n      <div>\n        <Typography paragraph>analysis templates:</Typography>\n        {step.analysis.templates.map((t, i) => (\n          <Typography paragraph key={i}>{`${t.templateName}${\n            t.clusterScope ? ' (cluster scoped)' : ''\n          }`}</Typography>\n        ))}\n      </div>\n    );\n  }\n  return 'unknown step';\n};\n\nexport const StepsProgress = ({\n  currentStepIndex,\n  aborted,\n  steps,\n}: StepsProgressProps) => {\n  // If the activeStep is greater/equal to the number of steps\n  // Then the canary is being promoted\n  // Increase the step index to mark the 'canary promoted' step as done also\n  const activeStepIndex =\n    currentStepIndex >= steps.length ? currentStepIndex + 1 : currentStepIndex;\n\n  /*\n   *  When the Rollout is aborted set the active step to -1\n   *  otherwise it appears to always be on the first step\n   */\n  return (\n    <Stepper activeStep={aborted ? -1 : activeStepIndex} alternativeLabel>\n      {steps\n        .map((step, i) => (\n          <Step key={i}>\n            <StepLabel data-testid={`step-${i}`}>\n              {createLabelForStep(step)}\n            </StepLabel>\n          </Step>\n        ))\n        .concat(\n          <Step key=\"-1\">\n            <StepLabel data-testid=\"step--1\">Canary promoted</StepLabel>\n          </Step>,\n        )}\n    </Stepper>\n  );\n};\n"],"names":[],"mappings":";;;;;;AAmCA,MAAM,eAAA,GAAkB,CAAC,IAAA,KACvB,IAAA,CAAK,eAAe,WAAW,CAAA;AAEjC,MAAM,WAAA,GAAc,CAAC,IAAA,KACnB,IAAA,CAAK,eAAe,OAAO,CAAA;AAE7B,MAAM,cAAA,GAAiB,CAAC,IAAA,KACtB,IAAA,CAAK,eAAe,UAAU,CAAA;AAEhC,MAAM,kBAAA,GAAqB,CAAC,IAAA,KAA2C;AACrE,EAAA,IAAI,eAAA,CAAgB,IAAI,CAAA,EAAG;AACzB,IAAA,OAAO,CAAA,UAAA,EAAa,KAAK,SAAS,CAAA,CAAA,CAAA;AAAA,EACpC,CAAA,MAAA,IAAW,WAAA,CAAY,IAAI,CAAA,EAAG;AAC5B,IAAA,OAAO,IAAA,CAAK,MAAM,QAAA,KAAa,MAAA,GAC3B,mBACA,CAAA,UAAA,EAAa,IAAA,CAAK,MAAM,QAAQ,CAAA,CAAA;AAAA,EACtC,CAAA,MAAA,IAAW,cAAA,CAAe,IAAI,CAAA,EAAG;AAC/B,IAAA,4BACG,KAAA,EAAA,EACC,QAAA,EAAA;AAAA,sBAAA,GAAA,CAAC,UAAA,EAAA,EAAW,SAAA,EAAS,IAAA,EAAC,QAAA,EAAA,qBAAA,EAAmB,CAAA;AAAA,MACxC,IAAA,CAAK,SAAS,SAAA,CAAU,GAAA,CAAI,CAAC,CAAA,EAAG,CAAA,yBAC9B,UAAA,EAAA,EAAW,SAAA,EAAS,MAAU,QAAA,EAAA,CAAA,EAAG,CAAA,CAAE,YAAY,CAAA,EAC9C,CAAA,CAAE,eAAe,mBAAA,GAAsB,EACzC,CAAA,CAAA,EAAA,EAF2B,CAExB,CACJ;AAAA,KAAA,EACH,CAAA;AAAA,EAEJ;AACA,EAAA,OAAO,cAAA;AACT,CAAA;AAEO,MAAM,gBAAgB,CAAC;AAAA,EAC5B,gBAAA;AAAA,EACA,OAAA;AAAA,EACA;AACF,CAAA,KAA0B;AAIxB,EAAA,MAAM,eAAA,GACJ,gBAAA,IAAoB,KAAA,CAAM,MAAA,GAAS,mBAAmB,CAAA,GAAI,gBAAA;AAM5D,EAAA,uBACE,GAAA,CAAC,OAAA,EAAA,EAAQ,UAAA,EAAY,OAAA,GAAU,EAAA,GAAK,eAAA,EAAiB,gBAAA,EAAgB,IAAA,EAClE,QAAA,EAAA,KAAA,CACE,GAAA,CAAI,CAAC,IAAA,EAAM,CAAA,qBACV,GAAA,CAAC,IAAA,EAAA,EACC,QAAA,kBAAA,GAAA,CAAC,SAAA,EAAA,EAAU,aAAA,EAAa,CAAA,KAAA,EAAQ,CAAC,CAAA,CAAA,EAC9B,QAAA,EAAA,kBAAA,CAAmB,IAAI,CAAA,EAC1B,CAAA,EAAA,EAHS,CAIX,CACD,CAAA,CACA,MAAA;AAAA,oBACC,GAAA,CAAC,QACC,QAAA,kBAAA,GAAA,CAAC,SAAA,EAAA,EAAU,eAAY,SAAA,EAAU,QAAA,EAAA,iBAAA,EAAe,KADxC,IAEV;AAAA,GACF,EACJ,CAAA;AAEJ;;;;"}