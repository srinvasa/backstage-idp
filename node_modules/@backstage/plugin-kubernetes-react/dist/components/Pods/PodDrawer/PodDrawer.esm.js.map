{"version":3,"file":"PodDrawer.esm.js","sources":["../../../../src/components/Pods/PodDrawer/PodDrawer.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ItemCardGrid } from '@backstage/core-components';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\n\nimport { Pod } from 'kubernetes-models/v1';\n\nimport { ContainerCard } from './ContainerCard';\n\nimport { PodAndErrors } from '../types';\nimport { KubernetesDrawer } from '../../KubernetesDrawer';\nimport { PodDeleteButton } from '../PodDelete/PodDeleteButton';\nimport { PendingPodContent } from './PendingPodContent';\nimport { ErrorList } from '../ErrorList';\nimport { usePodMetrics } from '../../../hooks/usePodMetrics';\nimport { ResourceUtilization } from '../../ResourceUtilization';\nimport { bytesToMiB, formatMillicores } from '../../../utils/resources';\nimport { useIsPodDeleteEnabled } from '../../../hooks';\n\nconst useDrawerContentStyles = makeStyles((_theme: Theme) =>\n  createStyles({\n    header: {\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'space-between',\n    },\n    content: {\n      height: '80%',\n    },\n    icon: {\n      fontSize: 20,\n    },\n    podoklist: {\n      width: '100%',\n      maxWidth: 360,\n      maxHeight: 360,\n    },\n  }),\n);\n\nfunction getContainerSpecByName(pod: Pod, containerName: string) {\n  return pod.spec?.containers.find(c => c.name === containerName);\n}\n\n/**\n * Props for PodDrawer\n *\n * @public\n */\nexport interface PodDrawerProps {\n  open?: boolean;\n  podAndErrors: PodAndErrors;\n}\n\n/**\n * A Drawer for Kubernetes Pods\n *\n * @public\n */\nexport const PodDrawer = ({ podAndErrors, open }: PodDrawerProps) => {\n  const classes = useDrawerContentStyles();\n  const podMetrics = usePodMetrics(podAndErrors.cluster.name, podAndErrors.pod);\n  const isPodDeleteEnabled = useIsPodDeleteEnabled();\n\n  return (\n    <KubernetesDrawer\n      open={open}\n      drawerContentsHeader={\n        <Typography variant=\"subtitle1\">\n          Pod{' '}\n          {podAndErrors.pod.status?.podIP &&\n            `(${podAndErrors.pod.status?.podIP})`}\n        </Typography>\n      }\n      kubernetesObject={podAndErrors.pod}\n      label={\n        <Typography variant=\"subtitle1\">\n          {podAndErrors.pod.metadata?.name ?? 'unknown'}\n        </Typography>\n      }\n    >\n      <div className={classes.content}>\n        {isPodDeleteEnabled && (\n          <PodDeleteButton\n            podScope={{\n              podName: podAndErrors.pod.metadata?.name ?? 'unknown',\n              podNamespace: podAndErrors.pod.metadata?.namespace ?? 'default',\n              cluster: podAndErrors.cluster,\n            }}\n          />\n        )}\n        {podMetrics && (\n          <Grid container item xs={12}>\n            <Grid item xs={12}>\n              <Typography variant=\"h5\">Resource utilization</Typography>\n            </Grid>\n            <Grid item xs={6}>\n              <ResourceUtilization\n                title=\"CPU requests\"\n                usage={podMetrics.cpu.currentUsage}\n                total={podMetrics.cpu.requestTotal}\n                totalFormatted={formatMillicores(podMetrics.cpu.requestTotal)}\n              />\n              <ResourceUtilization\n                title=\"CPU limits\"\n                usage={podMetrics.cpu.currentUsage}\n                total={podMetrics.cpu.limitTotal}\n                totalFormatted={formatMillicores(podMetrics.cpu.limitTotal)}\n              />\n            </Grid>\n            <Grid item xs={6}>\n              <ResourceUtilization\n                title=\"Memory requests\"\n                usage={podMetrics.memory.currentUsage}\n                total={podMetrics.memory.requestTotal}\n                totalFormatted={bytesToMiB(podMetrics.memory.requestTotal)}\n              />\n              <ResourceUtilization\n                title=\"Memory limits\"\n                usage={podMetrics.memory.currentUsage}\n                total={podMetrics.memory.limitTotal}\n                totalFormatted={bytesToMiB(podMetrics.memory.limitTotal)}\n              />\n            </Grid>\n          </Grid>\n        )}\n        {podAndErrors.pod.status?.phase === 'Pending' && (\n          <PendingPodContent pod={podAndErrors.pod} />\n        )}\n        {podAndErrors.pod.status?.containerStatuses?.length && (\n          <Grid container spacing={2}>\n            <Grid item xs={12}>\n              <Typography variant=\"h5\">Containers</Typography>\n            </Grid>\n            <Grid item xs={12}>\n              <ItemCardGrid>\n                {podAndErrors.pod.status?.containerStatuses?.map(\n                  (containerStatus, i) => {\n                    const containerSpec = getContainerSpecByName(\n                      podAndErrors.pod,\n                      containerStatus.name,\n                    );\n                    const containerMetrics = (\n                      podMetrics?.containers ?? []\n                    ).find(c => c.container === containerStatus.name);\n                    return (\n                      <ContainerCard\n                        key={`container-card-${podAndErrors.pod.metadata?.name}-${i}`}\n                        containerMetrics={containerMetrics}\n                        podScope={{\n                          podName: podAndErrors.pod.metadata?.name ?? 'unknown',\n                          podNamespace:\n                            podAndErrors.pod.metadata?.namespace ?? 'unknown',\n                          cluster: podAndErrors.cluster,\n                        }}\n                        containerSpec={containerSpec}\n                        containerStatus={containerStatus}\n                      />\n                    );\n                  },\n                )}\n              </ItemCardGrid>\n            </Grid>\n            {podAndErrors.errors.length > 0 && (\n              <Grid item xs={12}>\n                <Typography variant=\"h5\">Errors</Typography>\n              </Grid>\n            )}\n            {podAndErrors.errors.length > 0 && (\n              <Grid item xs={12}>\n                <ErrorList podAndErrors={[podAndErrors]} />\n              </Grid>\n            )}\n          </Grid>\n        )}\n      </div>\n    </KubernetesDrawer>\n  );\n};\n"],"names":[],"mappings":"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"}