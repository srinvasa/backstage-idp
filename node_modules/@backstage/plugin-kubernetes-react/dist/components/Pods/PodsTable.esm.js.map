{"version":3,"file":"PodsTable.esm.js","sources":["../../../src/components/Pods/PodsTable.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, useContext } from 'react';\nimport { PodDrawer } from './PodDrawer';\nimport {\n  containersReady,\n  containerStatuses,\n  podStatusToCpuUtil,\n  podStatusToMemoryUtil,\n  totalRestarts,\n} from '../../utils/pod';\nimport { Table, TableColumn } from '@backstage/core-components';\nimport { ClusterContext } from '../../hooks/Cluster';\nimport { useMatchingErrors } from '../../hooks/useMatchingErrors';\nimport { Pod } from 'kubernetes-models/v1/Pod';\nimport type { V1Pod } from '@kubernetes/client-node';\nimport { usePodMetrics } from '../../hooks/usePodMetrics';\nimport Typography from '@material-ui/core/Typography';\n\n/**\n *\n *\n * @public\n */\nexport const READY_COLUMNS: PodColumns = 'READY';\n\n/**\n *\n *\n * @public\n */\nexport const RESOURCE_COLUMNS: PodColumns = 'RESOURCE';\n\n/**\n *\n *\n * @public\n */\nexport type PodColumns = 'READY' | 'RESOURCE';\n\n/**\n *\n *\n * @public\n */\nexport type PodsTablesProps = {\n  pods: Pod | V1Pod[];\n  extraColumns?: PodColumns[];\n  children?: ReactNode;\n};\n\nconst READY: TableColumn<Pod>[] = [\n  {\n    title: 'containers ready',\n    align: 'center',\n    render: containersReady,\n    width: 'auto',\n  },\n  {\n    title: 'total restarts',\n    align: 'center',\n    render: totalRestarts,\n    type: 'numeric',\n    width: 'auto',\n  },\n];\n\nconst PodDrawerTrigger = ({ pod }: { pod: Pod }) => {\n  const errors = useMatchingErrors({\n    kind: 'Pod',\n    apiVersion: 'v1',\n    metadata: pod.metadata,\n  });\n  return (\n    <PodDrawer\n      podAndErrors={{\n        pod: pod as any,\n        cluster: useContext(ClusterContext),\n        errors: errors,\n      }}\n    />\n  );\n};\n\nconst Cpu = ({ clusterName, pod }: { clusterName: string; pod: Pod }) => {\n  const metrics = usePodMetrics(clusterName, pod);\n\n  if (!metrics) {\n    return <Typography>unknown</Typography>;\n  }\n\n  return <>{podStatusToCpuUtil(metrics)}</>;\n};\n\nconst Memory = ({ clusterName, pod }: { clusterName: string; pod: Pod }) => {\n  const metrics = usePodMetrics(clusterName, pod);\n\n  if (!metrics) {\n    return <Typography>unknown</Typography>;\n  }\n\n  return <>{podStatusToMemoryUtil(metrics)}</>;\n};\n\n/**\n *\n *\n * @public\n */\nexport const PodsTable = ({ pods, extraColumns = [] }: PodsTablesProps) => {\n  const cluster = useContext(ClusterContext);\n  const defaultColumns: TableColumn<Pod>[] = [\n    {\n      title: 'ID',\n      field: 'metadata.uid',\n      hidden: true,\n    },\n    {\n      title: 'name',\n      highlight: true,\n      render: (pod: Pod) => {\n        return <PodDrawerTrigger pod={pod} />;\n      },\n    },\n    {\n      title: 'phase',\n      render: (pod: Pod) => pod.status?.phase ?? 'unknown',\n      width: 'auto',\n    },\n    {\n      title: 'status',\n      render: containerStatuses,\n    },\n  ];\n  const columns: TableColumn<Pod>[] = [...defaultColumns];\n\n  if (extraColumns.includes(READY_COLUMNS)) {\n    columns.push(...READY);\n  }\n  if (extraColumns.includes(RESOURCE_COLUMNS)) {\n    const resourceColumns: TableColumn<Pod>[] = [\n      {\n        title: 'CPU usage %',\n        render: (pod: Pod) => {\n          return <Cpu clusterName={cluster.name} pod={pod} />;\n        },\n        width: 'auto',\n      },\n      {\n        title: 'Memory usage %',\n        render: (pod: Pod) => {\n          return <Memory clusterName={cluster.name} pod={pod} />;\n        },\n        width: 'auto',\n      },\n    ];\n    columns.push(...resourceColumns);\n  }\n\n  const tableStyle = {\n    minWidth: '0',\n    width: '100%',\n  };\n\n  return (\n    <div style={tableStyle}>\n      <Table\n        options={{ paging: true, search: false, emptyRowsWhenPaging: false }}\n        // It was observed that in some instances the pod drawer closes when new data (like CPU usage) is available and the table reloads.\n        // Mapping the metadata UID to the tables ID fixes this problem.\n        data={\n          (pods as Pod[]).map((pod: Pod) => ({\n            ...pod,\n            id: pod?.metadata?.uid,\n          })) as any as Pod[]\n        }\n        columns={columns}\n      />\n    </div>\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsCO,MAAM,aAAA,GAA4B;AAOlC,MAAM,gBAAA,GAA+B;AAoB5C,MAAM,KAAA,GAA4B;AAAA,EAChC;AAAA,IACE,KAAA,EAAO,kBAAA;AAAA,IACP,KAAA,EAAO,QAAA;AAAA,IACP,MAAA,EAAQ,eAAA;AAAA,IACR,KAAA,EAAO;AAAA,GACT;AAAA,EACA;AAAA,IACE,KAAA,EAAO,gBAAA;AAAA,IACP,KAAA,EAAO,QAAA;AAAA,IACP,MAAA,EAAQ,aAAA;AAAA,IACR,IAAA,EAAM,SAAA;AAAA,IACN,KAAA,EAAO;AAAA;AAEX,CAAA;AAEA,MAAM,gBAAA,GAAmB,CAAC,EAAE,GAAA,EAAI,KAAoB;AAClD,EAAA,MAAM,SAAS,iBAAA,CAAkB;AAAA,IAC/B,IAAA,EAAM,KAAA;AAAA,IACN,UAAA,EAAY,IAAA;AAAA,IACZ,UAAU,GAAA,CAAI;AAAA,GACf,CAAA;AACD,EAAA,uBACE,GAAA;AAAA,IAAC,SAAA;AAAA,IAAA;AAAA,MACC,YAAA,EAAc;AAAA,QACZ,GAAA;AAAA,QACA,OAAA,EAAS,WAAW,cAAc,CAAA;AAAA,QAClC;AAAA;AACF;AAAA,GACF;AAEJ,CAAA;AAEA,MAAM,GAAA,GAAM,CAAC,EAAE,WAAA,EAAa,KAAI,KAAyC;AACvE,EAAA,MAAM,OAAA,GAAU,aAAA,CAAc,WAAA,EAAa,GAAG,CAAA;AAE9C,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,uBAAO,GAAA,CAAC,cAAW,QAAA,EAAA,SAAA,EAAO,CAAA;AAAA,EAC5B;AAEA,EAAA,uBAAO,GAAA,CAAA,QAAA,EAAA,EAAG,QAAA,EAAA,kBAAA,CAAmB,OAAO,CAAA,EAAE,CAAA;AACxC,CAAA;AAEA,MAAM,MAAA,GAAS,CAAC,EAAE,WAAA,EAAa,KAAI,KAAyC;AAC1E,EAAA,MAAM,OAAA,GAAU,aAAA,CAAc,WAAA,EAAa,GAAG,CAAA;AAE9C,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,uBAAO,GAAA,CAAC,cAAW,QAAA,EAAA,SAAA,EAAO,CAAA;AAAA,EAC5B;AAEA,EAAA,uBAAO,GAAA,CAAA,QAAA,EAAA,EAAG,QAAA,EAAA,qBAAA,CAAsB,OAAO,CAAA,EAAE,CAAA;AAC3C,CAAA;AAOO,MAAM,YAAY,CAAC,EAAE,MAAM,YAAA,GAAe,IAAG,KAAuB;AACzE,EAAA,MAAM,OAAA,GAAU,WAAW,cAAc,CAAA;AACzC,EAAA,MAAM,cAAA,GAAqC;AAAA,IACzC;AAAA,MACE,KAAA,EAAO,IAAA;AAAA,MACP,KAAA,EAAO,cAAA;AAAA,MACP,MAAA,EAAQ;AAAA,KACV;AAAA,IACA;AAAA,MACE,KAAA,EAAO,MAAA;AAAA,MACP,SAAA,EAAW,IAAA;AAAA,MACX,MAAA,EAAQ,CAAC,GAAA,KAAa;AACpB,QAAA,uBAAO,GAAA,CAAC,oBAAiB,GAAA,EAAU,CAAA;AAAA,MACrC;AAAA,KACF;AAAA,IACA;AAAA,MACE,KAAA,EAAO,OAAA;AAAA,MACP,MAAA,EAAQ,CAAC,GAAA,KAAa,GAAA,CAAI,QAAQ,KAAA,IAAS,SAAA;AAAA,MAC3C,KAAA,EAAO;AAAA,KACT;AAAA,IACA;AAAA,MACE,KAAA,EAAO,QAAA;AAAA,MACP,MAAA,EAAQ;AAAA;AACV,GACF;AACA,EAAA,MAAM,OAAA,GAA8B,CAAC,GAAG,cAAc,CAAA;AAEtD,EAAA,IAAI,YAAA,CAAa,QAAA,CAAS,aAAa,CAAA,EAAG;AACxC,IAAA,OAAA,CAAQ,IAAA,CAAK,GAAG,KAAK,CAAA;AAAA,EACvB;AACA,EAAA,IAAI,YAAA,CAAa,QAAA,CAAS,gBAAgB,CAAA,EAAG;AAC3C,IAAA,MAAM,eAAA,GAAsC;AAAA,MAC1C;AAAA,QACE,KAAA,EAAO,aAAA;AAAA,QACP,MAAA,EAAQ,CAAC,GAAA,KAAa;AACpB,UAAA,uBAAO,GAAA,CAAC,GAAA,EAAA,EAAI,WAAA,EAAa,OAAA,CAAQ,MAAM,GAAA,EAAU,CAAA;AAAA,QACnD,CAAA;AAAA,QACA,KAAA,EAAO;AAAA,OACT;AAAA,MACA;AAAA,QACE,KAAA,EAAO,gBAAA;AAAA,QACP,MAAA,EAAQ,CAAC,GAAA,KAAa;AACpB,UAAA,uBAAO,GAAA,CAAC,MAAA,EAAA,EAAO,WAAA,EAAa,OAAA,CAAQ,MAAM,GAAA,EAAU,CAAA;AAAA,QACtD,CAAA;AAAA,QACA,KAAA,EAAO;AAAA;AACT,KACF;AACA,IAAA,OAAA,CAAQ,IAAA,CAAK,GAAG,eAAe,CAAA;AAAA,EACjC;AAEA,EAAA,MAAM,UAAA,GAAa;AAAA,IACjB,QAAA,EAAU,GAAA;AAAA,IACV,KAAA,EAAO;AAAA,GACT;AAEA,EAAA,uBACE,GAAA,CAAC,KAAA,EAAA,EAAI,KAAA,EAAO,UAAA,EACV,QAAA,kBAAA,GAAA;AAAA,IAAC,KAAA;AAAA,IAAA;AAAA,MACC,SAAS,EAAE,MAAA,EAAQ,MAAM,MAAA,EAAQ,KAAA,EAAO,qBAAqB,KAAA,EAAM;AAAA,MAGnE,IAAA,EACG,IAAA,CAAe,GAAA,CAAI,CAAC,GAAA,MAAc;AAAA,QACjC,GAAG,GAAA;AAAA,QACH,EAAA,EAAI,KAAK,QAAA,EAAU;AAAA,OACrB,CAAE,CAAA;AAAA,MAEJ;AAAA;AAAA,GACF,EACF,CAAA;AAEJ;;;;"}