{"version":3,"file":"KubernetesStructuredMetadataTableDrawer.esm.js","sources":["../../../src/components/KubernetesDrawer/KubernetesStructuredMetadataTableDrawer.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode, ChangeEvent, useContext, useState } from 'react';\nimport Button from '@material-ui/core/Button';\nimport Typography from '@material-ui/core/Typography';\nimport IconButton from '@material-ui/core/IconButton';\nimport Drawer from '@material-ui/core/Drawer';\nimport Switch from '@material-ui/core/Switch';\nimport FormControlLabel from '@material-ui/core/FormControlLabel';\nimport Grid from '@material-ui/core/Grid';\nimport { makeStyles, createStyles, Theme } from '@material-ui/core/styles';\nimport Close from '@material-ui/icons/Close';\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew';\nimport type { V1ObjectMeta } from '@kubernetes/client-node';\nimport { withStyles } from '@material-ui/core/styles';\nimport {\n  LinkButton as BackstageButton,\n  StructuredMetadataTable,\n  WarningPanel,\n} from '@backstage/core-components';\nimport { ClusterContext } from '../../hooks';\nimport { ClusterAttributes } from '@backstage/plugin-kubernetes-common';\nimport { ManifestYaml } from './ManifestYaml';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { kubernetesClusterLinkFormatterApiRef } from '../../api';\nimport useAsync from 'react-use/esm/useAsync';\n\nconst useDrawerStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    paper: {\n      width: '50%',\n      justifyContent: 'space-between',\n      padding: theme.spacing(2.5),\n    },\n  }),\n);\n\nconst useDrawerContentStyles = makeStyles((_: Theme) =>\n  createStyles({\n    header: {\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'space-between',\n    },\n    errorMessage: {\n      marginTop: '1em',\n      marginBottom: '1em',\n    },\n    options: {\n      display: 'flex',\n      flexDirection: 'row',\n      justifyContent: 'space-between',\n    },\n    icon: {\n      fontSize: 20,\n    },\n    content: {\n      height: '80%',\n    },\n  }),\n);\n\nconst PodDrawerButton = withStyles({\n  root: {\n    padding: '6px 5px',\n  },\n  label: {\n    textTransform: 'none',\n  },\n})(Button);\n\n/**\n *\n *\n * @public\n */\nexport type LinkErrorPanelProps = {\n  cluster: ClusterAttributes;\n  errorMessage?: string;\n  children?: ReactNode;\n};\n\n/**\n *\n *\n * @public\n */\nexport const LinkErrorPanel = ({\n  cluster,\n  errorMessage,\n}: LinkErrorPanelProps) => (\n  <WarningPanel\n    title=\"There was a problem formatting the link to the Kubernetes dashboard\"\n    message={`Could not format the link to the dashboard of your cluster named '${\n      cluster.name\n    }'. Its dashboardApp property has been set to '${\n      cluster.dashboardApp || 'standard'\n    }.'`}\n  >\n    {errorMessage && (\n      <Typography variant=\"body2\">Errors: {errorMessage}</Typography>\n    )}\n  </WarningPanel>\n);\n\n/**\n *\n *\n * @public\n */\nexport interface KubernetesDrawerable {\n  metadata?: V1ObjectMeta;\n}\n\ninterface KubernetesStructuredMetadataTableDrawerContentProps<\n  T extends KubernetesDrawerable,\n> {\n  toggleDrawer: (e: ChangeEvent<{}>, isOpen: boolean) => void;\n  object: T;\n  renderObject: (obj: T) => object;\n  kind: string;\n}\n\nfunction replaceNullsWithUndefined(someObj: any) {\n  const replacer = (_: any, value: any) =>\n    String(value) === 'null' || String(value) === 'undefined'\n      ? undefined\n      : value;\n\n  return JSON.parse(JSON.stringify(someObj, replacer));\n}\n\nconst KubernetesStructuredMetadataTableDrawerContent = <\n  T extends KubernetesDrawerable,\n>({\n  toggleDrawer,\n  object,\n  renderObject,\n  kind,\n}: KubernetesStructuredMetadataTableDrawerContentProps<T>) => {\n  const [isYaml, setIsYaml] = useState<boolean>(false);\n\n  const formatter = useApi(kubernetesClusterLinkFormatterApiRef);\n  const classes = useDrawerContentStyles();\n  const cluster = useContext(ClusterContext);\n  const { value: clusterLink, error } = useAsync(\n    async () =>\n      formatter.formatClusterLink({\n        dashboardUrl: cluster.dashboardUrl,\n        dashboardApp: cluster.dashboardApp,\n        dashboardParameters: cluster.dashboardParameters,\n        object,\n        kind,\n      }),\n    [cluster, object, kind, formatter],\n  );\n\n  return (\n    <>\n      <div className={classes.header}>\n        <Grid container justifyContent=\"flex-start\" alignItems=\"flex-start\">\n          <Grid item xs={11}>\n            <Typography variant=\"h5\">\n              {object.metadata?.name ?? 'unknown name'}\n            </Typography>\n          </Grid>\n          <Grid item xs={1}>\n            <IconButton\n              key=\"dismiss\"\n              title=\"Close the drawer\"\n              onClick={e => toggleDrawer(e, false)}\n              color=\"inherit\"\n            >\n              <Close className={classes.icon} />\n            </IconButton>\n          </Grid>\n          <Grid item xs={11}>\n            <Typography color=\"textSecondary\" variant=\"body1\">\n              {kind}\n            </Typography>\n          </Grid>\n          <Grid item xs={11}>\n            <FormControlLabel\n              control={\n                <Switch\n                  checked={isYaml}\n                  onChange={event => {\n                    setIsYaml(event.target.checked);\n                  }}\n                  name=\"YAML\"\n                />\n              }\n              label=\"YAML\"\n            />\n          </Grid>\n        </Grid>\n      </div>\n      {error && (\n        <div className={classes.errorMessage}>\n          <LinkErrorPanel\n            cluster={cluster}\n            errorMessage={error.message || error.toString()}\n          />\n        </div>\n      )}\n      <div className={classes.options}>\n        <div>\n          {clusterLink && (\n            <BackstageButton\n              variant=\"outlined\"\n              color=\"primary\"\n              size=\"small\"\n              to={clusterLink}\n              endIcon={<OpenInNewIcon />}\n            >\n              Open Kubernetes Dashboard\n            </BackstageButton>\n          )}\n        </div>\n      </div>\n      <div className={classes.content}>\n        {isYaml && <ManifestYaml object={object} />}\n        {!isYaml && (\n          <StructuredMetadataTable\n            metadata={renderObject(replaceNullsWithUndefined(object))}\n            options={{ nestedValuesAsYaml: true }}\n          />\n        )}\n      </div>\n    </>\n  );\n};\n\n/**\n *\n * @public\n */\nexport interface KubernetesStructuredMetadataTableDrawerProps<\n  T extends KubernetesDrawerable,\n> {\n  object: T;\n  renderObject: (obj: T) => object;\n  buttonVariant?: 'h5' | 'subtitle2';\n  kind: string;\n  expanded?: boolean;\n  children?: ReactNode;\n}\n\n/**\n *\n * @public\n */\nexport const KubernetesStructuredMetadataTableDrawer = <\n  T extends KubernetesDrawerable,\n>({\n  object,\n  renderObject,\n  kind,\n  buttonVariant = 'subtitle2',\n  expanded = false,\n  children,\n}: KubernetesStructuredMetadataTableDrawerProps<T>) => {\n  const [isOpen, setIsOpen] = useState(expanded);\n  const classes = useDrawerStyles();\n\n  const toggleDrawer = (e: ChangeEvent<{}>, newValue: boolean) => {\n    e.stopPropagation();\n    setIsOpen(newValue);\n  };\n\n  return (\n    <>\n      <PodDrawerButton\n        onClick={e => toggleDrawer(e, true)}\n        onFocus={event => event.stopPropagation()}\n      >\n        {children === undefined ? (\n          <Typography variant={buttonVariant}>\n            {object.metadata?.name ?? 'unknown object'}\n          </Typography>\n        ) : (\n          children\n        )}\n      </PodDrawerButton>\n      <Drawer\n        classes={{\n          paper: classes.paper,\n        }}\n        anchor=\"right\"\n        open={isOpen}\n        onClose={(e: any) => toggleDrawer(e, false)}\n        onClick={event => event.stopPropagation()}\n      >\n        <KubernetesStructuredMetadataTableDrawerContent\n          kind={kind}\n          toggleDrawer={toggleDrawer}\n          object={object}\n          renderObject={renderObject}\n        />\n      </Drawer>\n    </>\n  );\n};\n"],"names":["Close","BackstageButton"],"mappings":"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"}