{"version":3,"file":"owner.esm.js","sources":["../../src/utils/owner.ts"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type {\n  V1ObjectMeta,\n  V2HorizontalPodAutoscaler,\n  V1Pod,\n  V1ReplicaSet,\n} from '@kubernetes/client-node';\n\ninterface CanOwn {\n  metadata?: V1ObjectMeta;\n}\n\ninterface CanBeOwned {\n  metadata?: V1ObjectMeta;\n}\n\nexport function getOwnedResources<R extends CanBeOwned>(\n  potentialOwner: CanOwn,\n  possiblyOwned: R[],\n): R[] {\n  return possiblyOwned.filter(\n    p =>\n      p.metadata?.ownerReferences?.some(\n        o => o.uid === potentialOwner.metadata?.uid,\n      ) ?? false,\n  );\n}\n\nexport const getOwnedPodsThroughReplicaSets = (\n  potentialOwner: CanOwn,\n  replicaSets: V1ReplicaSet[],\n  pods: V1Pod[],\n) => {\n  return getOwnedResources(\n    potentialOwner,\n    replicaSets.filter(rs => rs.status && rs.status.replicas > 0),\n  ).reduce((accum, rs) => {\n    return accum.concat(getOwnedResources(rs, pods));\n  }, [] as V1Pod[]);\n};\n\ninterface ResourceRef {\n  kind: string;\n  namespace?: string;\n  name?: string;\n}\n\nexport const getMatchingHpa = (\n  owner: ResourceRef,\n  hpas: V2HorizontalPodAutoscaler[],\n): V2HorizontalPodAutoscaler | undefined => {\n  return hpas.find(hpa => {\n    return (\n      (hpa.spec?.scaleTargetRef?.kind ?? '').toLocaleLowerCase('en-US') ===\n        owner.kind.toLocaleLowerCase('en-US') &&\n      (hpa.metadata?.namespace ?? '') ===\n        (owner.namespace ?? 'unknown-namespace') &&\n      (hpa.spec?.scaleTargetRef?.name ?? '') ===\n        (owner.name ?? 'unknown-deployment')\n    );\n  });\n};\n"],"names":[],"mappings":"AA+BO,SAAS,iBAAA,CACd,gBACA,aAAA,EACK;AACL,EAAA,OAAO,aAAA,CAAc,MAAA;AAAA,IACnB,CAAA,CAAA,KACE,CAAA,CAAE,QAAA,EAAU,eAAA,EAAiB,IAAA;AAAA,MAC3B,CAAA,CAAA,KAAK,CAAA,CAAE,GAAA,KAAQ,cAAA,CAAe,QAAA,EAAU;AAAA,KAC1C,IAAK;AAAA,GACT;AACF;AAEO,MAAM,8BAAA,GAAiC,CAC5C,cAAA,EACA,WAAA,EACA,IAAA,KACG;AACH,EAAA,OAAO,iBAAA;AAAA,IACL,cAAA;AAAA,IACA,WAAA,CAAY,OAAO,CAAA,EAAA,KAAM,EAAA,CAAG,UAAU,EAAA,CAAG,MAAA,CAAO,WAAW,CAAC;AAAA,GAC9D,CAAE,MAAA,CAAO,CAAC,KAAA,EAAO,EAAA,KAAO;AACtB,IAAA,OAAO,KAAA,CAAM,MAAA,CAAO,iBAAA,CAAkB,EAAA,EAAI,IAAI,CAAC,CAAA;AAAA,EACjD,CAAA,EAAG,EAAa,CAAA;AAClB;AAQO,MAAM,cAAA,GAAiB,CAC5B,KAAA,EACA,IAAA,KAC0C;AAC1C,EAAA,OAAO,IAAA,CAAK,KAAK,CAAA,GAAA,KAAO;AACtB,IAAA,OAAA,CACG,GAAA,CAAI,IAAA,EAAM,cAAA,EAAgB,IAAA,IAAQ,EAAA,EAAI,iBAAA,CAAkB,OAAO,CAAA,KAC9D,KAAA,CAAM,IAAA,CAAK,iBAAA,CAAkB,OAAO,CAAA,IAAA,CACrC,IAAI,QAAA,EAAU,SAAA,IAAa,EAAA,OACzB,KAAA,CAAM,SAAA,IAAa,mBAAA,CAAA,IAAA,CACrB,GAAA,CAAI,IAAA,EAAM,cAAA,EAAgB,IAAA,IAAQ,EAAA,OAChC,KAAA,CAAM,IAAA,IAAQ,oBAAA,CAAA;AAAA,EAErB,CAAC,CAAA;AACH;;;;"}