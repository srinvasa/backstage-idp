{"version":3,"file":"HeadlampClusterLinksFormatter.esm.js","sources":["../../../src/api/formatters/HeadlampClusterLinksFormatter.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ClusterLinksFormatter,\n  ClusterLinksFormatterOptions,\n} from '../../types';\n\n/** @public */\nexport class HeadlampClusterLinksFormatter implements ClusterLinksFormatter {\n  async formatClusterLink(options: ClusterLinksFormatterOptions): Promise<URL> {\n    const { dashboardUrl, dashboardParameters, object, kind } = options;\n\n    if (!dashboardUrl && !dashboardParameters?.internal) {\n      throw new Error(\n        'Dashboard URL is required or dashboardInternal must be true',\n      );\n    }\n\n    const clusterName =\n      (dashboardParameters?.clusterName as string) ?? 'default';\n    const path = this.getHeadlampPath(kind, object, clusterName);\n    if (!path) {\n      throw new Error(`Could not find path for kind: ${kind}`);\n    }\n\n    let baseUrl: URL;\n\n    if (dashboardParameters?.internal) {\n      baseUrl = new URL(window.location.origin);\n      baseUrl.pathname =\n        (dashboardParameters.headlampRoute as string) || '/headlamp';\n    } else {\n      if (!dashboardUrl?.href) {\n        throw new Error(\n          'Dashboard URL is required when not using internal dashboard',\n        );\n      }\n      baseUrl = new URL(dashboardUrl.href);\n    }\n\n    baseUrl.searchParams.set('to', path);\n    return baseUrl;\n  }\n\n  private readonly NAMESPACED_RESOURCES = new Set([\n    'pod',\n    'deployment',\n    'replicaset',\n    'statefulset',\n    'daemonset',\n    'job',\n    'cronjob',\n    'service',\n    'ingress',\n    'configmap',\n    'secret',\n    'serviceaccount',\n    'role',\n    'rolebinding',\n    'networkpolicy',\n    'horizontalpodautoscaler',\n    'poddisruptionbudget',\n    'persistentvolumeclaim',\n  ]);\n\n  private getHeadlampPath(\n    kind: string,\n    object: {\n      metadata?: {\n        name?: string;\n        namespace?: string;\n      };\n    },\n    clusterName: string,\n  ): string {\n    const lowercaseKind = kind.toLocaleLowerCase('en-US');\n    const { name } = object.metadata ?? {};\n    let { namespace } = object.metadata ?? {};\n\n    if (!name) {\n      throw new Error(`Resource name is required for kind: ${kind}`);\n    }\n\n    // Add namespace validation\n    if (this.NAMESPACED_RESOURCES.has(lowercaseKind) && !namespace) {\n      throw new Error(`Namespace is required for namespaced resource: ${kind}`);\n    }\n    if (!namespace) {\n      namespace = 'default';\n    }\n\n    const pathMap: Record<string, string> = {\n      namespace: `/c/${clusterName}/namespaces/${name}`,\n      node: `/c/${clusterName}/nodes/${name}`,\n      persistentvolume: `/c/${clusterName}/storage/persistentvolumes/${name}`,\n      persistentvolumeclaim: `/c/${clusterName}/storage/persistentvolumeclaims/${namespace}/${name}`,\n      pod: `/c/${clusterName}/pods/${namespace}/${name}`,\n      deployment: `/c/${clusterName}/deployments/${namespace}/${name}`,\n      replicaset: `/c/${clusterName}/replicasets/${namespace}/${name}`,\n      statefulset: `/c/${clusterName}/statefulsets/${namespace}/${name}`,\n      daemonset: `/c/${clusterName}/daemonsets/${namespace}/${name}`,\n      job: `/c/${clusterName}/jobs/${namespace}/${name}`,\n      cronjob: `/c/${clusterName}/cronjobs/${namespace}/${name}`,\n      service: `/c/${clusterName}/services/${namespace}/${name}`,\n      ingress: `/c/${clusterName}/ingresses/${namespace}/${name}`,\n      configmap: `/c/${clusterName}/configmaps/${namespace}/${name}`,\n      secret: `/c/${clusterName}/secrets/${namespace}/${name}`,\n      serviceaccount: `/c/${clusterName}/serviceaccounts/${namespace}/${name}`,\n      role: `/c/${clusterName}/roles/${namespace}/${name}`,\n      rolebinding: `/c/${clusterName}/rolebindings/${namespace}/${name}`,\n      clusterrole: `/c/${clusterName}/clusterroles/${name}`,\n      clusterrolebinding: `/c/${clusterName}/clusterrolebindings/${name}`,\n      storageclass: `/c/${clusterName}/storage/storageclasses/${name}`,\n      networkpolicy: `/c/${clusterName}/networkpolicies/${namespace}/${name}`,\n      horizontalpodautoscaler: `/c/${clusterName}/horizontalpodautoscalers/${namespace}/${name}`,\n      poddisruptionbudget: `/c/${clusterName}/poddisruptionbudgets/${namespace}/${name}`,\n      customresourcedefinition: `/c/${clusterName}/customresourcedefinitions/${name}`,\n    };\n\n    return pathMap[lowercaseKind] ?? '';\n  }\n}\n"],"names":[],"mappings":"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"}