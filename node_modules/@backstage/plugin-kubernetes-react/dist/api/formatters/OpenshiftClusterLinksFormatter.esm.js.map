{"version":3,"file":"OpenshiftClusterLinksFormatter.esm.js","sources":["../../../src/api/formatters/OpenshiftClusterLinksFormatter.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { ClusterLinksFormatterOptions } from '../../types';\n\nconst kindMappings: Record<string, string> = {\n  deployment: 'deployments',\n  ingress: 'ingresses',\n  service: 'services',\n  horizontalpodautoscaler: 'horizontalpodautoscalers',\n  persistentvolume: 'persistentvolumes',\n};\n\n/** @public */\nexport class OpenshiftClusterLinksFormatter {\n  async formatClusterLink(options: ClusterLinksFormatterOptions): Promise<URL> {\n    if (!options.dashboardUrl) {\n      throw new Error('OpenShift dashboard requires a dashboardUrl option');\n    }\n    const basePath = new URL(options.dashboardUrl.href);\n    const name = encodeURIComponent(options.object.metadata?.name ?? '');\n    const namespace = encodeURIComponent(\n      options.object.metadata?.namespace ?? '',\n    );\n    const validKind = kindMappings[options.kind.toLocaleLowerCase('en-US')];\n    if (!basePath.pathname.endsWith('/')) {\n      // a dashboard url with a path should end with a slash otherwise\n      // the new combined URL will replace the last segment with the appended path!\n      // https://foobar.com/abc/def + k8s/cluster/projects/test  --> https://foobar.com/abc/k8s/cluster/projects/test\n      // https://foobar.com/abc/def/ + k8s/cluster/projects/test --> https://foobar.com/abc/def/k8s/cluster/projects/test\n      basePath.pathname += '/';\n    }\n    let path = '';\n    if (namespace) {\n      if (name && validKind) {\n        path = `k8s/ns/${namespace}/${validKind}/${name}`;\n      } else {\n        path = `k8s/cluster/projects/${namespace}`;\n      }\n    } else if (validKind) {\n      path = `k8s/cluster/${validKind}`;\n      if (name) {\n        path += `/${name}`;\n      }\n    }\n    return new URL(path, basePath);\n  }\n}\n"],"names":[],"mappings":"AAiBA,MAAM,YAAA,GAAuC;AAAA,EAC3C,UAAA,EAAY,aAAA;AAAA,EACZ,OAAA,EAAS,WAAA;AAAA,EACT,OAAA,EAAS,UAAA;AAAA,EACT,uBAAA,EAAyB,0BAAA;AAAA,EACzB,gBAAA,EAAkB;AACpB,CAAA;AAGO,MAAM,8BAAA,CAA+B;AAAA,EAC1C,MAAM,kBAAkB,OAAA,EAAqD;AAC3E,IAAA,IAAI,CAAC,QAAQ,YAAA,EAAc;AACzB,MAAA,MAAM,IAAI,MAAM,oDAAoD,CAAA;AAAA,IACtE;AACA,IAAA,MAAM,QAAA,GAAW,IAAI,GAAA,CAAI,OAAA,CAAQ,aAAa,IAAI,CAAA;AAClD,IAAA,MAAM,OAAO,kBAAA,CAAmB,OAAA,CAAQ,MAAA,CAAO,QAAA,EAAU,QAAQ,EAAE,CAAA;AACnE,IAAA,MAAM,SAAA,GAAY,kBAAA;AAAA,MAChB,OAAA,CAAQ,MAAA,CAAO,QAAA,EAAU,SAAA,IAAa;AAAA,KACxC;AACA,IAAA,MAAM,YAAY,YAAA,CAAa,OAAA,CAAQ,IAAA,CAAK,iBAAA,CAAkB,OAAO,CAAC,CAAA;AACtE,IAAA,IAAI,CAAC,QAAA,CAAS,QAAA,CAAS,QAAA,CAAS,GAAG,CAAA,EAAG;AAKpC,MAAA,QAAA,CAAS,QAAA,IAAY,GAAA;AAAA,IACvB;AACA,IAAA,IAAI,IAAA,GAAO,EAAA;AACX,IAAA,IAAI,SAAA,EAAW;AACb,MAAA,IAAI,QAAQ,SAAA,EAAW;AACrB,QAAA,IAAA,GAAO,CAAA,OAAA,EAAU,SAAS,CAAA,CAAA,EAAI,SAAS,IAAI,IAAI,CAAA,CAAA;AAAA,MACjD,CAAA,MAAO;AACL,QAAA,IAAA,GAAO,wBAAwB,SAAS,CAAA,CAAA;AAAA,MAC1C;AAAA,IACF,WAAW,SAAA,EAAW;AACpB,MAAA,IAAA,GAAO,eAAe,SAAS,CAAA,CAAA;AAC/B,MAAA,IAAI,IAAA,EAAM;AACR,QAAA,IAAA,IAAQ,IAAI,IAAI,CAAA,CAAA;AAAA,MAClB;AAAA,IACF;AACA,IAAA,OAAO,IAAI,GAAA,CAAI,IAAA,EAAM,QAAQ,CAAA;AAAA,EAC/B;AACF;;;;"}