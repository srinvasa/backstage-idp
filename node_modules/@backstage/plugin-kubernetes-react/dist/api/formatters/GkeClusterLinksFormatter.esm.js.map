{"version":3,"file":"GkeClusterLinksFormatter.esm.js","sources":["../../../src/api/formatters/GkeClusterLinksFormatter.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  ClusterLinksFormatter,\n  ClusterLinksFormatterOptions,\n} from '../../types';\nimport { ProfileInfoApi } from '@backstage/core-plugin-api';\n\nconst kindMappings: Record<string, string> = {\n  deployment: 'deployment',\n  pod: 'pod',\n  ingress: 'ingress',\n  service: 'service',\n  horizontalpodautoscaler: 'deployment',\n};\n\n/** @public */\nexport class GkeClusterLinksFormatter implements ClusterLinksFormatter {\n  private readonly googleAuthApi: ProfileInfoApi | undefined;\n\n  constructor(googleAuthApi: ProfileInfoApi | undefined) {\n    this.googleAuthApi = googleAuthApi;\n  }\n  async formatClusterLink(options: ClusterLinksFormatterOptions): Promise<URL> {\n    if (!options.dashboardParameters) {\n      throw new Error('GKE dashboard requires a dashboardParameters option');\n    }\n    const args = options.dashboardParameters;\n    if (typeof args.projectId !== 'string') {\n      throw new Error(\n        'GKE dashboard requires a \"projectId\" of type string in the dashboardParameters option',\n      );\n    }\n    if (typeof args.region !== 'string') {\n      throw new Error(\n        'GKE dashboard requires a \"region\" of type string in the dashboardParameters option',\n      );\n    }\n    if (typeof args.clusterName !== 'string') {\n      throw new Error(\n        'GKE dashboard requires a \"clusterName\" of type string in the dashboardParameters option',\n      );\n    }\n    const basePath = new URL('https://console.cloud.google.com/');\n    const region = encodeURIComponent(args.region);\n    const clusterName = encodeURIComponent(args.clusterName);\n    const name = encodeURIComponent(options.object.metadata?.name ?? '');\n    const namespace = encodeURIComponent(\n      options.object.metadata?.namespace ?? '',\n    );\n    const validKind = kindMappings[options.kind.toLocaleLowerCase('en-US')];\n    let path: string;\n    if (namespace && name && validKind) {\n      const kindsWithDetails = ['ingress', 'pod'];\n      const landingPage = kindsWithDetails.includes(validKind)\n        ? 'details'\n        : 'overview';\n      path = `kubernetes/${validKind}/${region}/${clusterName}/${namespace}/${name}/${landingPage}`;\n    } else {\n      path = `kubernetes/clusters/details/${region}/${clusterName}/details`;\n    }\n    const result = new URL(path, basePath);\n    result.searchParams.set('project', args.projectId);\n    if (this.googleAuthApi) {\n      const profile = await this.googleAuthApi.getProfile({ optional: true });\n      if (profile?.email) {\n        result.searchParams.set('authuser', profile.email);\n      }\n    }\n    return result;\n  }\n}\n"],"names":[],"mappings":"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"}