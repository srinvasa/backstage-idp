{"version":3,"file":"OidcKubernetesAuthProvider.esm.js","sources":["../../src/kubernetes-auth-provider/OidcKubernetesAuthProvider.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { JsonObject } from '@backstage/types';\nimport { KubernetesRequestBody } from '@backstage/plugin-kubernetes-common';\nimport { OpenIdConnectApi } from '@backstage/core-plugin-api';\nimport { KubernetesAuthProvider } from './types';\n\n/** @public */\nexport class OidcKubernetesAuthProvider implements KubernetesAuthProvider {\n  providerName: string;\n  authProvider: OpenIdConnectApi;\n\n  constructor(providerName: string, authProvider: OpenIdConnectApi) {\n    this.providerName = providerName;\n    this.authProvider = authProvider;\n  }\n\n  async decorateRequestBodyForAuth(\n    requestBody: KubernetesRequestBody,\n  ): Promise<KubernetesRequestBody> {\n    const authToken: string = (await this.getCredentials()).token;\n    const auth = { ...(requestBody.auth as JsonObject) };\n    if (auth.oidc) {\n      (auth.oidc as JsonObject)[this.providerName] = authToken;\n    } else {\n      auth.oidc = { [this.providerName]: authToken };\n    }\n    requestBody.auth = auth;\n    return requestBody;\n  }\n\n  async getCredentials(): Promise<{ token: string }> {\n    return {\n      token: await this.authProvider.getIdToken(),\n    };\n  }\n}\n"],"names":[],"mappings":"AAsBO,MAAM,0BAAA,CAA6D;AAAA,EACxE,YAAA;AAAA,EACA,YAAA;AAAA,EAEA,WAAA,CAAY,cAAsB,YAAA,EAAgC;AAChE,IAAA,IAAA,CAAK,YAAA,GAAe,YAAA;AACpB,IAAA,IAAA,CAAK,YAAA,GAAe,YAAA;AAAA,EACtB;AAAA,EAEA,MAAM,2BACJ,WAAA,EACgC;AAChC,IAAA,MAAM,SAAA,GAAA,CAAqB,MAAM,IAAA,CAAK,cAAA,EAAe,EAAG,KAAA;AACxD,IAAA,MAAM,IAAA,GAAO,EAAE,GAAI,WAAA,CAAY,IAAA,EAAoB;AACnD,IAAA,IAAI,KAAK,IAAA,EAAM;AACb,MAAC,IAAA,CAAK,IAAA,CAAoB,IAAA,CAAK,YAAY,CAAA,GAAI,SAAA;AAAA,IACjD,CAAA,MAAO;AACL,MAAA,IAAA,CAAK,OAAO,EAAE,CAAC,IAAA,CAAK,YAAY,GAAG,SAAA,EAAU;AAAA,IAC/C;AACA,IAAA,WAAA,CAAY,IAAA,GAAO,IAAA;AACnB,IAAA,OAAO,WAAA;AAAA,EACT;AAAA,EAEA,MAAM,cAAA,GAA6C;AACjD,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,MAAM,IAAA,CAAK,YAAA,CAAa,UAAA;AAAW,KAC5C;AAAA,EACF;AACF;;;;"}