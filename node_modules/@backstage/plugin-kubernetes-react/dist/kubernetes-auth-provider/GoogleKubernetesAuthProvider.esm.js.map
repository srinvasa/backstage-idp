{"version":3,"file":"GoogleKubernetesAuthProvider.esm.js","sources":["../../src/kubernetes-auth-provider/GoogleKubernetesAuthProvider.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { KubernetesAuthProvider } from './types';\nimport { KubernetesRequestBody } from '@backstage/plugin-kubernetes-common';\nimport { OAuthApi } from '@backstage/core-plugin-api';\n\n/** @public */\nexport class GoogleKubernetesAuthProvider implements KubernetesAuthProvider {\n  authProvider: OAuthApi;\n\n  constructor(authProvider: OAuthApi) {\n    this.authProvider = authProvider;\n  }\n\n  async decorateRequestBodyForAuth(\n    requestBody: KubernetesRequestBody,\n  ): Promise<KubernetesRequestBody> {\n    const googleAuthToken: string = (await this.getCredentials()).token;\n    if ('auth' in requestBody) {\n      requestBody.auth!.google = googleAuthToken;\n    } else {\n      requestBody.auth = { google: googleAuthToken };\n    }\n    return requestBody;\n  }\n  async getCredentials(): Promise<{ token: string }> {\n    return {\n      token: await this.authProvider.getAccessToken(\n        'https://www.googleapis.com/auth/cloud-platform.read-only',\n      ),\n    };\n  }\n}\n"],"names":[],"mappings":"AAqBO,MAAM,4BAAA,CAA+D;AAAA,EAC1E,YAAA;AAAA,EAEA,YAAY,YAAA,EAAwB;AAClC,IAAA,IAAA,CAAK,YAAA,GAAe,YAAA;AAAA,EACtB;AAAA,EAEA,MAAM,2BACJ,WAAA,EACgC;AAChC,IAAA,MAAM,eAAA,GAAA,CAA2B,MAAM,IAAA,CAAK,cAAA,EAAe,EAAG,KAAA;AAC9D,IAAA,IAAI,UAAU,WAAA,EAAa;AACzB,MAAA,WAAA,CAAY,KAAM,MAAA,GAAS,eAAA;AAAA,IAC7B,CAAA,MAAO;AACL,MAAA,WAAA,CAAY,IAAA,GAAO,EAAE,MAAA,EAAQ,eAAA,EAAgB;AAAA,IAC/C;AACA,IAAA,OAAO,WAAA;AAAA,EACT;AAAA,EACA,MAAM,cAAA,GAA6C;AACjD,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,MAAM,IAAA,CAAK,YAAA,CAAa,cAAA;AAAA,QAC7B;AAAA;AACF,KACF;AAAA,EACF;AACF;;;;"}