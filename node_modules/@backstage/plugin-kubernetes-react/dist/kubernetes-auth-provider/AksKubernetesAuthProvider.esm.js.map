{"version":3,"file":"AksKubernetesAuthProvider.esm.js","sources":["../../src/kubernetes-auth-provider/AksKubernetesAuthProvider.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { OAuthApi } from '@backstage/core-plugin-api';\nimport { KubernetesRequestBody } from '@backstage/plugin-kubernetes-common';\nimport { KubernetesAuthProvider } from './types';\n\n/** @public */\nexport class AksKubernetesAuthProvider implements KubernetesAuthProvider {\n  private readonly microsoftAuthApi: OAuthApi;\n\n  constructor(microsoftAuthApi: OAuthApi) {\n    this.microsoftAuthApi = microsoftAuthApi;\n  }\n\n  async decorateRequestBodyForAuth(\n    requestBody: KubernetesRequestBody,\n  ): Promise<KubernetesRequestBody> {\n    return {\n      ...requestBody,\n      auth: { ...requestBody.auth, aks: (await this.getCredentials()).token },\n    };\n  }\n\n  async getCredentials(): Promise<{ token?: string }> {\n    return {\n      token: await this.microsoftAuthApi.getAccessToken(\n        '6dae42f8-4368-4678-94ff-3960e28e3630/user.read',\n      ),\n    };\n  }\n}\n"],"names":[],"mappings":"AAoBO,MAAM,yBAAA,CAA4D;AAAA,EACtD,gBAAA;AAAA,EAEjB,YAAY,gBAAA,EAA4B;AACtC,IAAA,IAAA,CAAK,gBAAA,GAAmB,gBAAA;AAAA,EAC1B;AAAA,EAEA,MAAM,2BACJ,WAAA,EACgC;AAChC,IAAA,OAAO;AAAA,MACL,GAAG,WAAA;AAAA,MACH,IAAA,EAAM,EAAE,GAAG,WAAA,CAAY,IAAA,EAAM,MAAM,MAAM,IAAA,CAAK,cAAA,EAAe,EAAG,KAAA;AAAM,KACxE;AAAA,EACF;AAAA,EAEA,MAAM,cAAA,GAA8C;AAClD,IAAA,OAAO;AAAA,MACL,KAAA,EAAO,MAAM,IAAA,CAAK,gBAAA,CAAiB,cAAA;AAAA,QACjC;AAAA;AACF,KACF;AAAA,EACF;AACF;;;;"}