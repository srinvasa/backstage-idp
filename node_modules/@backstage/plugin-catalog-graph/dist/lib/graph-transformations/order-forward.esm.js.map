{"version":3,"file":"order-forward.esm.js","sources":["../../../src/lib/graph-transformations/order-forward.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityEdge } from '../types';\nimport { GraphTransformer } from './types';\n\n/** Orders the edges direction so that the graph goes strictly forward */\nexport const orderForward: GraphTransformer = ({\n  rootEntityRefs,\n  nodes,\n  edges,\n}) => {\n  const entityEdges = new Map<string, EntityEdge[]>();\n  edges.forEach(edge => {\n    let fromEdges = entityEdges.get(edge.from);\n    if (!fromEdges) {\n      fromEdges = [];\n      entityEdges.set(edge.from, fromEdges);\n    }\n    fromEdges.push(edge);\n\n    let toEdges = entityEdges.get(edge.to);\n    if (!toEdges) {\n      toEdges = [];\n      entityEdges.set(edge.to, toEdges);\n    }\n    toEdges.push(edge);\n  });\n\n  const visitedNodes = new Set<string>();\n\n  for (const rootEntityRef of rootEntityRefs) {\n    let currentNodes: string[] = [rootEntityRef].filter(\n      node => !visitedNodes.has(node),\n    );\n\n    while (currentNodes.length > 0) {\n      for (const currentNode of currentNodes) {\n        visitedNodes.add(currentNode);\n      }\n\n      const nextNodes: string[] = [];\n\n      currentNodes.forEach(node => {\n        entityEdges.get(node)?.forEach(edge => {\n          if (edge.to === node && !visitedNodes.has(edge.from)) {\n            // Reverse direction\n            const { from, to } = edge;\n            edge.from = to;\n            edge.to = from;\n            edge.relations.reverse();\n          }\n\n          nextNodes.push(edge.from, edge.to);\n        });\n      });\n\n      currentNodes = Array.from(new Set(nextNodes)).filter(\n        node => !visitedNodes.has(node),\n      );\n    }\n  }\n\n  const nodeOrder = Array.from(visitedNodes);\n\n  nodes.sort((a, b) => {\n    const aOrder = nodeOrder.findIndex(node => node === a.id);\n    const bOrder = nodeOrder.findIndex(node => node === b.id);\n    return aOrder - bOrder;\n  });\n};\n"],"names":[],"mappings":"AAoBO,MAAM,eAAiC,CAAC;AAAA,EAC7C,cAAA;AAAA,EACA,KAAA;AAAA,EACA;AACF,CAAA,KAAM;AACJ,EAAA,MAAM,WAAA,uBAAkB,GAAA,EAA0B;AAClD,EAAA,KAAA,CAAM,QAAQ,CAAA,IAAA,KAAQ;AACpB,IAAA,IAAI,SAAA,GAAY,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,IAAI,CAAA;AACzC,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,SAAA,GAAY,EAAC;AACb,MAAA,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,IAAA,EAAM,SAAS,CAAA;AAAA,IACtC;AACA,IAAA,SAAA,CAAU,KAAK,IAAI,CAAA;AAEnB,IAAA,IAAI,OAAA,GAAU,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA;AACrC,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,OAAA,GAAU,EAAC;AACX,MAAA,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,OAAO,CAAA;AAAA,IAClC;AACA,IAAA,OAAA,CAAQ,KAAK,IAAI,CAAA;AAAA,EACnB,CAAC,CAAA;AAED,EAAA,MAAM,YAAA,uBAAmB,GAAA,EAAY;AAErC,EAAA,KAAA,MAAW,iBAAiB,cAAA,EAAgB;AAC1C,IAAA,IAAI,YAAA,GAAyB,CAAC,aAAa,CAAA,CAAE,MAAA;AAAA,MAC3C,CAAA,IAAA,KAAQ,CAAC,YAAA,CAAa,GAAA,CAAI,IAAI;AAAA,KAChC;AAEA,IAAA,OAAO,YAAA,CAAa,SAAS,CAAA,EAAG;AAC9B,MAAA,KAAA,MAAW,eAAe,YAAA,EAAc;AACtC,QAAA,YAAA,CAAa,IAAI,WAAW,CAAA;AAAA,MAC9B;AAEA,MAAA,MAAM,YAAsB,EAAC;AAE7B,MAAA,YAAA,CAAa,QAAQ,CAAA,IAAA,KAAQ;AAC3B,QAAA,WAAA,CAAY,GAAA,CAAI,IAAI,CAAA,EAAG,OAAA,CAAQ,CAAA,IAAA,KAAQ;AACrC,UAAA,IAAI,IAAA,CAAK,OAAO,IAAA,IAAQ,CAAC,aAAa,GAAA,CAAI,IAAA,CAAK,IAAI,CAAA,EAAG;AAEpD,YAAA,MAAM,EAAE,IAAA,EAAM,EAAA,EAAG,GAAI,IAAA;AACrB,YAAA,IAAA,CAAK,IAAA,GAAO,EAAA;AACZ,YAAA,IAAA,CAAK,EAAA,GAAK,IAAA;AACV,YAAA,IAAA,CAAK,UAAU,OAAA,EAAQ;AAAA,UACzB;AAEA,UAAA,SAAA,CAAU,IAAA,CAAK,IAAA,CAAK,IAAA,EAAM,IAAA,CAAK,EAAE,CAAA;AAAA,QACnC,CAAC,CAAA;AAAA,MACH,CAAC,CAAA;AAED,MAAA,YAAA,GAAe,MAAM,IAAA,CAAK,IAAI,GAAA,CAAI,SAAS,CAAC,CAAA,CAAE,MAAA;AAAA,QAC5C,CAAA,IAAA,KAAQ,CAAC,YAAA,CAAa,GAAA,CAAI,IAAI;AAAA,OAChC;AAAA,IACF;AAAA,EACF;AAEA,EAAA,MAAM,SAAA,GAAY,KAAA,CAAM,IAAA,CAAK,YAAY,CAAA;AAEzC,EAAA,KAAA,CAAM,IAAA,CAAK,CAAC,CAAA,EAAG,CAAA,KAAM;AACnB,IAAA,MAAM,SAAS,SAAA,CAAU,SAAA,CAAU,CAAA,IAAA,KAAQ,IAAA,KAAS,EAAE,EAAE,CAAA;AACxD,IAAA,MAAM,SAAS,SAAA,CAAU,SAAA,CAAU,CAAA,IAAA,KAAQ,IAAA,KAAS,EAAE,EAAE,CAAA;AACxD,IAAA,OAAO,MAAA,GAAS,MAAA;AAAA,EAClB,CAAC,CAAA;AACH;;;;"}