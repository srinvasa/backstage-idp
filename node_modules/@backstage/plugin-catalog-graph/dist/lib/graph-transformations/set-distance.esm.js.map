{"version":3,"file":"set-distance.esm.js","sources":["../../../src/lib/graph-transformations/set-distance.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityEdge } from '../types';\nimport { GraphTransformer } from './types';\n\n/** Set the distance of each edge to the distance from a root entity */\nexport const setDistances: GraphTransformer = ({\n  nodeDistances,\n  edges,\n  rootEntityRefs,\n}) => {\n  const edgeMap = new Map<string, EntityEdge[]>();\n  edges.forEach(edge => {\n    const fromEdges = edgeMap.get(edge.from) ?? [];\n    fromEdges.push(edge);\n    edgeMap.set(edge.from, fromEdges);\n\n    const toEdges = edgeMap.get(edge.to) ?? [];\n    toEdges.push(edge);\n    edgeMap.set(edge.to, toEdges);\n  });\n\n  rootEntityRefs.forEach(rootEntityRef => {\n    nodeDistances.set(rootEntityRef, 0);\n  });\n  const visitedNodes = new Set<string>(rootEntityRefs);\n  let currentNodes = rootEntityRefs;\n  let distance = 0;\n\n  while (currentNodes.length > 0) {\n    const thisDistance = ++distance;\n\n    const nextNodes: string[] = [];\n    currentNodes.forEach(node => {\n      edgeMap.get(node)?.forEach(edge => {\n        edge.distance ??= thisDistance;\n\n        const fromDistance = nodeDistances.get(edge.from) ?? thisDistance;\n        nodeDistances.set(edge.from, fromDistance);\n        nextNodes.push(edge.from);\n\n        const toDistance = nodeDistances.get(edge.to) ?? thisDistance;\n        nodeDistances.set(edge.to, toDistance);\n        nextNodes.push(edge.to);\n      });\n    });\n\n    for (const currentNode of currentNodes) {\n      visitedNodes.add(currentNode);\n    }\n\n    currentNodes = Array.from(new Set(nextNodes)).filter(\n      node => !visitedNodes.has(node),\n    );\n  }\n};\n"],"names":[],"mappings":"AAoBO,MAAM,eAAiC,CAAC;AAAA,EAC7C,aAAA;AAAA,EACA,KAAA;AAAA,EACA;AACF,CAAA,KAAM;AACJ,EAAA,MAAM,OAAA,uBAAc,GAAA,EAA0B;AAC9C,EAAA,KAAA,CAAM,QAAQ,CAAA,IAAA,KAAQ;AACpB,IAAA,MAAM,YAAY,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,IAAI,KAAK,EAAC;AAC7C,IAAA,SAAA,CAAU,KAAK,IAAI,CAAA;AACnB,IAAA,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,IAAA,EAAM,SAAS,CAAA;AAEhC,IAAA,MAAM,UAAU,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,EAAE,KAAK,EAAC;AACzC,IAAA,OAAA,CAAQ,KAAK,IAAI,CAAA;AACjB,IAAA,OAAA,CAAQ,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,OAAO,CAAA;AAAA,EAC9B,CAAC,CAAA;AAED,EAAA,cAAA,CAAe,QAAQ,CAAA,aAAA,KAAiB;AACtC,IAAA,aAAA,CAAc,GAAA,CAAI,eAAe,CAAC,CAAA;AAAA,EACpC,CAAC,CAAA;AACD,EAAA,MAAM,YAAA,GAAe,IAAI,GAAA,CAAY,cAAc,CAAA;AACnD,EAAA,IAAI,YAAA,GAAe,cAAA;AACnB,EAAA,IAAI,QAAA,GAAW,CAAA;AAEf,EAAA,OAAO,YAAA,CAAa,SAAS,CAAA,EAAG;AAC9B,IAAA,MAAM,eAAe,EAAE,QAAA;AAEvB,IAAA,MAAM,YAAsB,EAAC;AAC7B,IAAA,YAAA,CAAa,QAAQ,CAAA,IAAA,KAAQ;AAC3B,MAAA,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA,EAAG,OAAA,CAAQ,CAAA,IAAA,KAAQ;AACjC,QAAA,IAAA,CAAK,QAAA,KAAa,YAAA;AAElB,QAAA,MAAM,YAAA,GAAe,aAAA,CAAc,GAAA,CAAI,IAAA,CAAK,IAAI,CAAA,IAAK,YAAA;AACrD,QAAA,aAAA,CAAc,GAAA,CAAI,IAAA,CAAK,IAAA,EAAM,YAAY,CAAA;AACzC,QAAA,SAAA,CAAU,IAAA,CAAK,KAAK,IAAI,CAAA;AAExB,QAAA,MAAM,UAAA,GAAa,aAAA,CAAc,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA,IAAK,YAAA;AACjD,QAAA,aAAA,CAAc,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,UAAU,CAAA;AACrC,QAAA,SAAA,CAAU,IAAA,CAAK,KAAK,EAAE,CAAA;AAAA,MACxB,CAAC,CAAA;AAAA,IACH,CAAC,CAAA;AAED,IAAA,KAAA,MAAW,eAAe,YAAA,EAAc;AACtC,MAAA,YAAA,CAAa,IAAI,WAAW,CAAA;AAAA,IAC9B;AAEA,IAAA,YAAA,GAAe,MAAM,IAAA,CAAK,IAAI,GAAA,CAAI,SAAS,CAAC,CAAA,CAAE,MAAA;AAAA,MAC5C,CAAA,IAAA,KAAQ,CAAC,YAAA,CAAa,GAAA,CAAI,IAAI;AAAA,KAChC;AAAA,EACF;AACF;;;;"}