{"version":3,"file":"strip-distant-edges.esm.js","sources":["../../../src/lib/graph-transformations/strip-distant-edges.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityEdge } from '../types';\nimport { GraphTransformer } from './types';\n\n/**\n * Removes edges that are further away then other edges leading up to the root.\n */\nexport const stripDistantEdges: GraphTransformer = options => {\n  const entityEdges = new Map<string, EntityEdge[]>();\n  options.edges.forEach(edge => {\n    let fromEdges = entityEdges.get(edge.from);\n    if (!fromEdges) {\n      fromEdges = [];\n      entityEdges.set(edge.from, fromEdges);\n    }\n    fromEdges.push(edge);\n\n    let toEdges = entityEdges.get(edge.to);\n    if (!toEdges) {\n      toEdges = [];\n      entityEdges.set(edge.to, toEdges);\n    }\n    toEdges.push(edge);\n  });\n\n  // Remove edges that are further away than other edges leading up to the root\n  options.edges = options.edges.filter(edge => {\n    // Get all edges of the 'from' node except this (and similar) edge\n    const fromEdges = entityEdges\n      .get(edge.from)!\n      .filter(\n        fromEdge =>\n          !(fromEdge.from === edge.from && fromEdge.to === edge.to) &&\n          !(fromEdge.from === edge.to && fromEdge.to === edge.from),\n      );\n    // Get all edges of the 'from' node except this (and similar) edge\n    const toEdges = entityEdges\n      .get(edge.to)!\n      .filter(\n        toEdge =>\n          !(toEdge.from === edge.from && toEdge.to === edge.to) &&\n          !(toEdge.from === edge.to && toEdge.to === edge.from),\n      );\n\n    if (fromEdges.length === 0 || toEdges.length === 0) {\n      return true;\n    }\n\n    const shorterFrom = fromEdges.some(\n      fromEdge => (fromEdge.distance ?? 0) < (edge.distance ?? 0),\n    );\n    const shorterTo = toEdges.some(\n      toEdge => (toEdge.distance ?? 0) < (edge.distance ?? 0),\n    );\n\n    if (shorterFrom && shorterTo) {\n      // There are shorter edges from both 'from' and 'to' leading to the root,\n      // exclude this edge\n      return false;\n    }\n    return true;\n  });\n};\n"],"names":[],"mappings":"AAsBO,MAAM,oBAAsC,CAAA,OAAA,KAAW;AAC5D,EAAA,MAAM,WAAA,uBAAkB,GAAA,EAA0B;AAClD,EAAA,OAAA,CAAQ,KAAA,CAAM,QAAQ,CAAA,IAAA,KAAQ;AAC5B,IAAA,IAAI,SAAA,GAAY,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,IAAI,CAAA;AACzC,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,SAAA,GAAY,EAAC;AACb,MAAA,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,IAAA,EAAM,SAAS,CAAA;AAAA,IACtC;AACA,IAAA,SAAA,CAAU,KAAK,IAAI,CAAA;AAEnB,IAAA,IAAI,OAAA,GAAU,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA;AACrC,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,OAAA,GAAU,EAAC;AACX,MAAA,WAAA,CAAY,GAAA,CAAI,IAAA,CAAK,EAAA,EAAI,OAAO,CAAA;AAAA,IAClC;AACA,IAAA,OAAA,CAAQ,KAAK,IAAI,CAAA;AAAA,EACnB,CAAC,CAAA;AAGD,EAAA,OAAA,CAAQ,KAAA,GAAQ,OAAA,CAAQ,KAAA,CAAM,MAAA,CAAO,CAAA,IAAA,KAAQ;AAE3C,IAAA,MAAM,SAAA,GAAY,WAAA,CACf,GAAA,CAAI,IAAA,CAAK,IAAI,CAAA,CACb,MAAA;AAAA,MACC,cACE,EAAE,QAAA,CAAS,IAAA,KAAS,IAAA,CAAK,QAAQ,QAAA,CAAS,EAAA,KAAO,IAAA,CAAK,EAAA,CAAA,IACtD,EAAE,QAAA,CAAS,IAAA,KAAS,KAAK,EAAA,IAAM,QAAA,CAAS,OAAO,IAAA,CAAK,IAAA;AAAA,KACxD;AAEF,IAAA,MAAM,OAAA,GAAU,WAAA,CACb,GAAA,CAAI,IAAA,CAAK,EAAE,CAAA,CACX,MAAA;AAAA,MACC,YACE,EAAE,MAAA,CAAO,IAAA,KAAS,IAAA,CAAK,QAAQ,MAAA,CAAO,EAAA,KAAO,IAAA,CAAK,EAAA,CAAA,IAClD,EAAE,MAAA,CAAO,IAAA,KAAS,KAAK,EAAA,IAAM,MAAA,CAAO,OAAO,IAAA,CAAK,IAAA;AAAA,KACpD;AAEF,IAAA,IAAI,SAAA,CAAU,MAAA,KAAW,CAAA,IAAK,OAAA,CAAQ,WAAW,CAAA,EAAG;AAClD,MAAA,OAAO,IAAA;AAAA,IACT;AAEA,IAAA,MAAM,cAAc,SAAA,CAAU,IAAA;AAAA,MAC5B,CAAA,QAAA,KAAA,CAAa,QAAA,CAAS,QAAA,IAAY,CAAA,KAAM,KAAK,QAAA,IAAY,CAAA;AAAA,KAC3D;AACA,IAAA,MAAM,YAAY,OAAA,CAAQ,IAAA;AAAA,MACxB,CAAA,MAAA,KAAA,CAAW,MAAA,CAAO,QAAA,IAAY,CAAA,KAAM,KAAK,QAAA,IAAY,CAAA;AAAA,KACvD;AAEA,IAAA,IAAI,eAAe,SAAA,EAAW;AAG5B,MAAA,OAAO,KAAA;AAAA,IACT;AACA,IAAA,OAAO,IAAA;AAAA,EACT,CAAC,CAAA;AACH;;;;"}