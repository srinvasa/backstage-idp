{"version":3,"file":"merge-relations.esm.js","sources":["../../../src/lib/graph-transformations/merge-relations.ts"],"sourcesContent":["/*\n * Copyright 2025 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityEdge } from '../types';\nimport { GraphTransformer } from './types';\n\nfunction concatRelations(\n  a: readonly string[] | undefined,\n  b: readonly string[] | undefined,\n): string[] {\n  return Array.from(new Set<string>([...(a ?? []), ...(b ?? [])]));\n}\n\n/** Merge relations in multiple edges into one edge */\nexport const mergeRelations: GraphTransformer = options => {\n  const mergedEdges = new Map<string, EntityEdge>();\n\n  options.edges.forEach(edge => {\n    const keyForward = `${edge.from}-${edge.to}`;\n    const keyBackward = `${edge.to}-${edge.from}`;\n\n    const edgeForward = mergedEdges.get(keyForward);\n    const edgeBackward = mergedEdges.get(keyBackward);\n\n    if (edgeForward) {\n      edgeForward.relations = concatRelations(\n        edgeForward.relations,\n        edge.relations,\n      );\n    } else if (edgeBackward) {\n      edgeBackward.relations = concatRelations(\n        edgeBackward.relations,\n        edge.relations,\n      );\n    } else {\n      mergedEdges.set(keyForward, edge);\n    }\n  });\n\n  options.edges = Array.from(mergedEdges.values());\n};\n"],"names":[],"mappings":"AAmBA,SAAS,eAAA,CACP,GACA,CAAA,EACU;AACV,EAAA,OAAO,KAAA,CAAM,IAAA,iBAAK,IAAI,GAAA,CAAY,CAAC,GAAI,CAAA,IAAK,EAAC,EAAI,GAAI,CAAA,IAAK,EAAG,CAAC,CAAC,CAAA;AACjE;AAGO,MAAM,iBAAmC,CAAA,OAAA,KAAW;AACzD,EAAA,MAAM,WAAA,uBAAkB,GAAA,EAAwB;AAEhD,EAAA,OAAA,CAAQ,KAAA,CAAM,QAAQ,CAAA,IAAA,KAAQ;AAC5B,IAAA,MAAM,aAAa,CAAA,EAAG,IAAA,CAAK,IAAI,CAAA,CAAA,EAAI,KAAK,EAAE,CAAA,CAAA;AAC1C,IAAA,MAAM,cAAc,CAAA,EAAG,IAAA,CAAK,EAAE,CAAA,CAAA,EAAI,KAAK,IAAI,CAAA,CAAA;AAE3C,IAAA,MAAM,WAAA,GAAc,WAAA,CAAY,GAAA,CAAI,UAAU,CAAA;AAC9C,IAAA,MAAM,YAAA,GAAe,WAAA,CAAY,GAAA,CAAI,WAAW,CAAA;AAEhD,IAAA,IAAI,WAAA,EAAa;AACf,MAAA,WAAA,CAAY,SAAA,GAAY,eAAA;AAAA,QACtB,WAAA,CAAY,SAAA;AAAA,QACZ,IAAA,CAAK;AAAA,OACP;AAAA,IACF,WAAW,YAAA,EAAc;AACvB,MAAA,YAAA,CAAa,SAAA,GAAY,eAAA;AAAA,QACvB,YAAA,CAAa,SAAA;AAAA,QACb,IAAA,CAAK;AAAA,OACP;AAAA,IACF,CAAA,MAAO;AACL,MAAA,WAAA,CAAY,GAAA,CAAI,YAAY,IAAI,CAAA;AAAA,IAClC;AAAA,EACF,CAAC,CAAA;AAED,EAAA,OAAA,CAAQ,KAAA,GAAQ,KAAA,CAAM,IAAA,CAAK,WAAA,CAAY,QAAQ,CAAA;AACjD;;;;"}