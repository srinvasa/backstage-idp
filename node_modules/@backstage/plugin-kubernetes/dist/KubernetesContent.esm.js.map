{"version":3,"file":"KubernetesContent.esm.js","sources":["../src/KubernetesContent.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ReactNode } from 'react';\nimport Grid from '@material-ui/core/Grid';\nimport Typography from '@material-ui/core/Typography';\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  ErrorPanel,\n  ErrorReporting,\n  Cluster,\n  useKubernetesObjects,\n  DetectedErrorsContext,\n} from '@backstage/plugin-kubernetes-react';\nimport {\n  DetectedError,\n  detectErrors,\n} from '@backstage/plugin-kubernetes-common';\nimport { EmptyState, Progress } from '@backstage/core-components';\nimport { RequireKubernetesPermissions } from './RequireKubernetesPermissions';\n\ntype KubernetesContentProps = {\n  entity: Entity;\n  refreshIntervalMs?: number;\n  children?: ReactNode;\n};\n\nexport const KubernetesContent = ({\n  entity,\n  refreshIntervalMs,\n}: KubernetesContentProps) => {\n  const { kubernetesObjects, error } = useKubernetesObjects(\n    entity,\n    refreshIntervalMs,\n  );\n\n  const clusters = kubernetesObjects?.items.map(item => item.cluster) ?? [];\n\n  const clustersWithErrors =\n    kubernetesObjects?.items.filter(r => r.errors.length > 0) ?? [];\n\n  const detectedErrors =\n    kubernetesObjects !== undefined\n      ? detectErrors(kubernetesObjects)\n      : new Map<string, DetectedError[]>();\n\n  return (\n    <RequireKubernetesPermissions>\n      <DetectedErrorsContext.Provider\n        value={[...detectedErrors.values()].flat()}\n      >\n        {kubernetesObjects === undefined && error === undefined && <Progress />}\n\n        {/* errors retrieved from the kubernetes clusters */}\n        {clustersWithErrors.length > 0 && (\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <ErrorPanel\n                entityName={entity.metadata.name}\n                clustersWithErrors={clustersWithErrors}\n              />\n            </Grid>\n          </Grid>\n        )}\n\n        {/* other errors */}\n        {error !== undefined && (\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <ErrorPanel\n                entityName={entity.metadata.name}\n                errorMessage={error}\n              />\n            </Grid>\n          </Grid>\n        )}\n\n        {kubernetesObjects && (\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <ErrorReporting\n                detectedErrors={detectedErrors}\n                clusters={clusters}\n              />\n            </Grid>\n            <Grid item>\n              <Typography variant=\"h3\">Your Clusters</Typography>\n            </Grid>\n            <Grid item container>\n              {kubernetesObjects?.items.length <= 0 && (\n                <Grid\n                  container\n                  justifyContent=\"space-around\"\n                  direction=\"row\"\n                  alignItems=\"center\"\n                  spacing={2}\n                >\n                  <Grid item xs={8}>\n                    <EmptyState\n                      missing=\"data\"\n                      title=\"No Kubernetes resources\"\n                      description={`No resources on any known clusters for ${entity.metadata.name}`}\n                    />\n                  </Grid>\n                </Grid>\n              )}\n              {kubernetesObjects?.items.length > 0 &&\n                kubernetesObjects?.items.map((item, i) => {\n                  const podsWithErrors = new Set<string>(\n                    detectedErrors\n                      .get(item.cluster.name)\n                      ?.filter(de => de.sourceRef.kind === 'Pod')\n                      .map(de => de.sourceRef.name),\n                  );\n\n                  return (\n                    <Grid item key={i} xs={12}>\n                      <Cluster\n                        clusterObjects={item}\n                        podsWithErrors={podsWithErrors}\n                      />\n                    </Grid>\n                  );\n                })}\n            </Grid>\n          </Grid>\n        )}\n      </DetectedErrorsContext.Provider>\n    </RequireKubernetesPermissions>\n  );\n};\n"],"names":[],"mappings":"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"}