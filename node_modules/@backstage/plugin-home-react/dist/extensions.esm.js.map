{"version":3,"file":"extensions.esm.js","sources":["../src/extensions.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, Suspense } from 'react';\nimport IconButton from '@material-ui/core/IconButton';\nimport SettingsIcon from '@material-ui/icons/Settings';\nimport { InfoCard } from '@backstage/core-components';\nimport { SettingsModal } from './components';\nimport { createReactExtension, useApp } from '@backstage/core-plugin-api';\nimport { RJSFSchema, UiSchema } from '@rjsf/utils';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { homeReactTranslationRef } from './translation';\n\n/**\n * @public\n */\nexport type ComponentRenderer = {\n  Renderer?: (props: RendererProps) => JSX.Element;\n};\n\n/**\n * @public\n */\nexport type ComponentParts = {\n  Content: (props?: any) => JSX.Element;\n  Actions?: () => JSX.Element;\n  Settings?: () => JSX.Element;\n  ContextProvider?: (props: any) => JSX.Element;\n};\n\n/**\n * @public\n */\nexport type RendererProps = { title?: string } & ComponentParts;\n\n/**\n * @public\n */\nexport type CardExtensionProps<T> = ComponentRenderer & {\n  title?: string;\n} & T;\n\n/**\n * @public\n */\nexport type CardLayout = {\n  width?: { minColumns?: number; maxColumns?: number; defaultColumns?: number };\n  height?: { minRows?: number; maxRows?: number; defaultRows?: number };\n};\n\n/**\n * @public\n */\nexport type CardSettings = {\n  schema?: RJSFSchema;\n  uiSchema?: UiSchema;\n};\n\n/**\n * @public\n */\nexport type CardConfig = {\n  layout?: CardLayout;\n  settings?: CardSettings;\n};\n\n/**\n * An extension creator to create card based components for the homepage\n *\n * @public\n */\nexport function createCardExtension<T>(options: {\n  title?: string;\n  components: () => Promise<ComponentParts>;\n  name?: string;\n  description?: string;\n  layout?: CardLayout;\n  settings?: CardSettings;\n}) {\n  const { title, components, name, description, layout, settings } = options;\n  // If widget settings schema is defined, we don't want to show the Settings icon or dialog\n  const isCustomizable = settings?.schema !== undefined;\n\n  return createReactExtension({\n    name,\n    data: { title, description, 'home.widget.config': { layout, settings } },\n    component: {\n      lazy: () =>\n        components().then(componentParts => {\n          return (props: CardExtensionProps<T>) => {\n            return (\n              <CardExtension\n                {...props}\n                {...componentParts}\n                title={props.title || title}\n                isCustomizable={isCustomizable}\n              />\n            );\n          };\n        }),\n    },\n  });\n}\n\ntype CardExtensionComponentProps<T> = CardExtensionProps<T> &\n  ComponentParts & {\n    isCustomizable?: boolean;\n    overrideTitle?: string;\n  };\n\nfunction CardExtension<T>(props: CardExtensionComponentProps<T>) {\n  const {\n    Renderer,\n    Content,\n    Settings,\n    Actions,\n    ContextProvider,\n    isCustomizable,\n    title,\n    ...childProps\n  } = props;\n  const app = useApp();\n  const { Progress } = app.getComponents();\n  const [settingsOpen, setSettingsOpen] = useState(false);\n  const { t } = useTranslationRef(homeReactTranslationRef);\n\n  if (Renderer) {\n    return (\n      <Suspense fallback={<Progress />}>\n        <Renderer\n          {...(title && { title })}\n          {...{\n            Content,\n            ...(Actions ? { Actions } : {}),\n            ...(Settings && !isCustomizable ? { Settings } : {}),\n            ...(ContextProvider ? { ContextProvider } : {}),\n            ...childProps,\n          }}\n        />\n      </Suspense>\n    );\n  }\n\n  const cardProps = {\n    divider: !!title,\n    ...(title && { title }),\n    ...(Settings && !isCustomizable\n      ? {\n          action: (\n            <IconButton onClick={() => setSettingsOpen(true)}>\n              <SettingsIcon>\n                {t('cardExtension.settingsButtonTitle')}\n              </SettingsIcon>\n            </IconButton>\n          ),\n        }\n      : {}),\n    ...(Actions\n      ? {\n          actions: <Actions />,\n        }\n      : {}),\n  };\n\n  const innerContent = (\n    <InfoCard {...cardProps}>\n      {Settings && !isCustomizable && (\n        <SettingsModal\n          open={settingsOpen}\n          componentName={title}\n          close={() => setSettingsOpen(false)}\n        >\n          <Settings />\n        </SettingsModal>\n      )}\n      <Content {...childProps} />\n    </InfoCard>\n  );\n\n  return (\n    <Suspense fallback={<Progress />}>\n      {ContextProvider ? (\n        <ContextProvider {...childProps}>{innerContent}</ContextProvider>\n      ) : (\n        innerContent\n      )}\n    </Suspense>\n  );\n}\n"],"names":[],"mappings":"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"}