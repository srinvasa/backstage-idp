{"version":3,"file":"ExternalRouteRef.esm.js","sources":["../../src/routing/ExternalRouteRef.ts"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ExternalRouteRef,\n  routeRefType,\n  AnyParams,\n  ParamKeys,\n  OptionalParams,\n} from './types';\n\n/**\n * @internal\n */\nexport class ExternalRouteRefImpl<\n  Params extends AnyParams,\n  Optional extends boolean,\n> implements ExternalRouteRef<Params, Optional>\n{\n  // The marker is used for type checking while the symbol is used at runtime.\n  declare $$routeRefType: 'external';\n  readonly [routeRefType] = 'external';\n\n  private readonly id: string;\n  readonly params: ParamKeys<Params>;\n  readonly optional: Optional;\n  readonly defaultTarget: string | undefined;\n\n  constructor(\n    id: string,\n    params: ParamKeys<Params>,\n    optional: Optional,\n    defaultTarget: string | undefined,\n  ) {\n    this.id = id;\n    this.params = params;\n    this.optional = optional;\n    this.defaultTarget = defaultTarget;\n  }\n\n  toString() {\n    if (this.#nfsId) {\n      return `externalRouteRef{id=${this.#nfsId},legacyId=${this.id}}`;\n    }\n    return `routeRef{type=external,id=${this.id}}`;\n  }\n\n  getDefaultTarget() {\n    return this.defaultTarget;\n  }\n\n  // NFS implementation below\n  readonly $$type = '@backstage/ExternalRouteRef';\n  readonly version = 'v1';\n  readonly T = undefined as any;\n\n  #nfsId: string | undefined = undefined;\n\n  getParams(): string[] {\n    return this.params as string[];\n  }\n  getDescription(): string {\n    if (this.#nfsId) {\n      return this.#nfsId;\n    }\n    return this.id;\n  }\n  setId(newId: string) {\n    if (!newId) {\n      throw new Error(`ExternalRouteRef id must be a non-empty string`);\n    }\n    if (this.#nfsId && this.#nfsId !== newId) {\n      throw new Error(\n        `ExternalRouteRef was referenced twice as both '${\n          this.#nfsId\n        }' and '${newId}'`,\n      );\n    }\n    this.#nfsId = newId;\n  }\n}\n\n/**\n * Creates a route descriptor, to be later bound to a concrete route by the app. Used to implement cross-plugin route references.\n *\n * @remarks\n *\n * See {@link https://backstage.io/docs/plugins/composability#routing-system}.\n *\n * @param options - Description of the route reference to be created.\n * @public\n */\nexport function createExternalRouteRef<\n  Params extends { [param in ParamKey]: string },\n  Optional extends boolean = false,\n  ParamKey extends string = never,\n>(options: {\n  /**\n   * An identifier for this route, used to identify it in error messages\n   */\n  id: string;\n\n  /**\n   * The parameters that will be provided to the external route reference.\n   */\n  params?: ParamKey[];\n\n  /**\n   * Whether or not this route is optional, defaults to false.\n   *\n   * Optional external routes are not required to be bound in the app, and\n   * if they aren't, `useRouteRef` will return `undefined`.\n   */\n  optional?: Optional;\n\n  /**\n   * The route (typically in another plugin) that this should map to by default.\n   *\n   * The string is expected to be on the standard `<plugin id>.<route id>` form,\n   * for example `techdocs.docRoot`.\n   */\n  defaultTarget?: string;\n}): ExternalRouteRef<OptionalParams<Params>, Optional> {\n  return new ExternalRouteRefImpl(\n    options.id,\n    (options.params ?? []) as ParamKeys<OptionalParams<Params>>,\n    Boolean(options.optional) as Optional,\n    options?.defaultTarget,\n  ) as ExternalRouteRef<OptionalParams<Params>, Optional>;\n}\n"],"names":[],"mappings":";;AA2BO,MAAM,oBAAA,CAIb;AAAA,EAGE,CAAU,YAAY,IAAI,UAAA;AAAA,EAET,EAAA;AAAA,EACR,MAAA;AAAA,EACA,QAAA;AAAA,EACA,aAAA;AAAA,EAET,WAAA,CACE,EAAA,EACA,MAAA,EACA,QAAA,EACA,aAAA,EACA;AACA,IAAA,IAAA,CAAK,EAAA,GAAK,EAAA;AACV,IAAA,IAAA,CAAK,MAAA,GAAS,MAAA;AACd,IAAA,IAAA,CAAK,QAAA,GAAW,QAAA;AAChB,IAAA,IAAA,CAAK,aAAA,GAAgB,aAAA;AAAA,EACvB;AAAA,EAEA,QAAA,GAAW;AACT,IAAA,IAAI,KAAK,MAAA,EAAQ;AACf,MAAA,OAAO,CAAA,oBAAA,EAAuB,IAAA,CAAK,MAAM,CAAA,UAAA,EAAa,KAAK,EAAE,CAAA,CAAA,CAAA;AAAA,IAC/D;AACA,IAAA,OAAO,CAAA,0BAAA,EAA6B,KAAK,EAAE,CAAA,CAAA,CAAA;AAAA,EAC7C;AAAA,EAEA,gBAAA,GAAmB;AACjB,IAAA,OAAO,IAAA,CAAK,aAAA;AAAA,EACd;AAAA;AAAA,EAGS,MAAA,GAAS,6BAAA;AAAA,EACT,OAAA,GAAU,IAAA;AAAA,EACV,CAAA,GAAI,MAAA;AAAA,EAEb,MAAA,GAA6B,MAAA;AAAA,EAE7B,SAAA,GAAsB;AACpB,IAAA,OAAO,IAAA,CAAK,MAAA;AAAA,EACd;AAAA,EACA,cAAA,GAAyB;AACvB,IAAA,IAAI,KAAK,MAAA,EAAQ;AACf,MAAA,OAAO,IAAA,CAAK,MAAA;AAAA,IACd;AACA,IAAA,OAAO,IAAA,CAAK,EAAA;AAAA,EACd;AAAA,EACA,MAAM,KAAA,EAAe;AACnB,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,MAAM,CAAA,8CAAA,CAAgD,CAAA;AAAA,IAClE;AACA,IAAA,IAAI,IAAA,CAAK,MAAA,IAAU,IAAA,CAAK,MAAA,KAAW,KAAA,EAAO;AACxC,MAAA,MAAM,IAAI,KAAA;AAAA,QACR,CAAA,+CAAA,EACE,IAAA,CAAK,MACP,CAAA,OAAA,EAAU,KAAK,CAAA,CAAA;AAAA,OACjB;AAAA,IACF;AACA,IAAA,IAAA,CAAK,MAAA,GAAS,KAAA;AAAA,EAChB;AACF;AAYO,SAAS,uBAId,OAAA,EA0BqD;AACrD,EAAA,OAAO,IAAI,oBAAA;AAAA,IACT,OAAA,CAAQ,EAAA;AAAA,IACP,OAAA,CAAQ,UAAU,EAAC;AAAA,IACpB,OAAA,CAAQ,QAAQ,QAAQ,CAAA;AAAA,IACxB,OAAA,EAAS;AAAA,GACX;AACF;;;;"}