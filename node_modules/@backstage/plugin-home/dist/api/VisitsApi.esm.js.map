{"version":3,"file":"VisitsApi.esm.js","sources":["../../src/api/VisitsApi.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createApiRef } from '@backstage/core-plugin-api';\nimport { VisitInput } from './VisitsStorageApi';\n\n/**\n * @public\n * The operators that can be used in filter.\n */\nexport type Operators = '<' | '<=' | '==' | '!=' | '>' | '>=' | 'contains';\n\n/**\n * @public\n * Type guard for operators.\n */\nexport const isOperator = (s: string): s is Operators => {\n  return ['<', '<=', '==', '!=', '>', '>=', 'contains'].includes(s);\n};\n\n/**\n * @public\n * Model for a visit entity.\n */\nexport type Visit = {\n  /**\n   * The auto-generated visit identification.\n   */\n  id: string;\n  /**\n   * The visited entity, usually an entity id.\n   */\n  name: string;\n  /**\n   * The visited url pathname, usually the entity route.\n   */\n  pathname: string;\n  /**\n   * An individual view count.\n   */\n  hits: number;\n  /**\n   * Last date and time of visit. Format: unix epoch in ms.\n   */\n  timestamp: number;\n  /**\n   * Optional entity reference. See stringifyEntityRef from catalog-model.\n   */\n  entityRef?: string;\n};\n\n/**\n * @public\n * This data structure represents the parameters associated with search queries for visits.\n */\nexport type VisitsApiQueryParams = {\n  /**\n   * Limits the number of results returned. The default is 8.\n   */\n  limit?: number;\n  /**\n   * Allows ordering visits on entity properties.\n   * @example\n   * Sort ascending by the timestamp field.\n   * ```\n   * { orderBy: [{ field: 'timestamp', direction: 'asc' }] }\n   * ```\n   */\n  orderBy?: Array<{\n    field: keyof Visit;\n    direction: 'asc' | 'desc';\n  }>;\n  /**\n   * Allows filtering visits on entity properties.\n   * @example\n   * Most popular docs on the past 7 days\n   * ```\n   * {\n   *   orderBy: [{ field: 'hits', direction: 'desc' }],\n   *   filterBy: [\n   *     { field: 'timestamp', operator: '>=', value: <date> },\n   *     { field: 'entityRef', operator: 'contains', value: 'docs' }\n   *   ]\n   * }\n   * ```\n   */\n  filterBy?: Array<{\n    field: keyof Visit;\n    operator: Operators;\n    value: string | number;\n  }>;\n};\n\n/**\n * @public\n * This data structure represents the parameters associated with saving visits.\n */\nexport type VisitsApiSaveParams = {\n  visit: Omit<Visit, 'id' | 'hits' | 'timestamp'>;\n};\n\n/**\n * @public\n * Visits API public contract.\n */\nexport interface VisitsApi {\n  /**\n   * Persist a new visit.\n   * @param pageVisit - a new visit data\n   */\n  save(saveParams: VisitsApiSaveParams): Promise<Visit>;\n  /**\n   * Get user visits.\n   * @param queryParams - optional search query params.\n   */\n  list(queryParams?: VisitsApiQueryParams): Promise<Visit[]>;\n  /**\n   * Transform the pathname before it is considered for any other processing.\n   * @param pathname - the original pathname\n   */\n  transformPathname?(pathname: string): string;\n  /**\n   * Determine whether a visit should be saved.\n   * @param visit - page visit data\n   */\n  canSave?(visit: VisitInput): boolean | Promise<boolean>;\n  /**\n   * Add additional data to the visit before saving.\n   * @param visit - page visit data\n   */\n  enrichVisit?(\n    visit: VisitInput,\n  ): Promise<Record<string, any>> | Record<string, any>;\n}\n\n/** @public */\nexport const visitsApiRef = createApiRef<VisitsApi>({\n  id: 'homepage.visits',\n});\n"],"names":[],"mappings":";;AA6BO,MAAM,UAAA,GAAa,CAAC,CAAA,KAA8B;AACvD,EAAA,OAAO,CAAC,GAAA,EAAK,IAAA,EAAM,IAAA,EAAM,IAAA,EAAM,KAAK,IAAA,EAAM,UAAU,CAAA,CAAE,QAAA,CAAS,CAAC,CAAA;AAClE;AAsHO,MAAM,eAAe,YAAA,CAAwB;AAAA,EAClD,EAAA,EAAI;AACN,CAAC;;;;"}