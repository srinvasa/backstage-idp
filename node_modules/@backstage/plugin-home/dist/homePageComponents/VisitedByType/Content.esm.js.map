{"version":3,"file":"Content.esm.js","sources":["../../../src/homePageComponents/VisitedByType/Content.tsx"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect } from 'react';\nimport { createFilterByQueryParamFromConfig } from '../../api/config';\nimport { VisitedByType } from './VisitedByType';\nimport { Visit, visitsApiRef } from '../../api';\nimport { ContextValueOnly, useContext } from './Context';\nimport { configApiRef, useApi } from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/esm/useAsync';\n\n/** @public */\nexport type VisitedByTypeKind = 'recent' | 'top';\n\n/** @public */\nexport type VisitedByTypeProps = {\n  visits?: Array<Visit>;\n  numVisitsOpen?: number;\n  numVisitsTotal?: number;\n  loading?: boolean;\n  kind: VisitedByTypeKind;\n};\n\n/**\n * Display recently visited pages for the homepage\n * @public\n */\nexport const Content = ({\n  visits,\n  numVisitsOpen,\n  numVisitsTotal,\n  loading,\n  kind,\n}: VisitedByTypeProps) => {\n  const { setContext, setVisits, setLoading } = useContext();\n  // Allows behavior override from properties\n  useEffect(() => {\n    const context: Partial<ContextValueOnly> = {};\n    context.kind = kind;\n    if (visits) {\n      context.visits = visits;\n      context.loading = false;\n    } else if (loading) {\n      context.loading = loading;\n    }\n    if (numVisitsOpen) context.numVisitsOpen = numVisitsOpen;\n    if (numVisitsTotal) context.numVisitsTotal = numVisitsTotal;\n    setContext(state => ({ ...state, ...context }));\n  }, [setContext, kind, visits, loading, numVisitsOpen, numVisitsTotal]);\n\n  const config = useApi(configApiRef);\n  // Fetches data from visitsApi in case visits and loading are not provided\n  const visitsApi = useApi(visitsApiRef);\n  const { loading: reqLoading } = useAsync(async () => {\n    if (!visits && !loading && kind === 'recent') {\n      const filterBy = createFilterByQueryParamFromConfig(\n        config.getOptionalConfigArray('home.recentVisits.filterBy') ?? [],\n      );\n      return await visitsApi\n        .list({\n          limit: numVisitsTotal ?? 8,\n          orderBy: [{ field: 'timestamp', direction: 'desc' }],\n          ...(filterBy && { filterBy }),\n        })\n        .then(setVisits);\n    }\n    if (!visits && !loading && kind === 'top') {\n      const filterBy = createFilterByQueryParamFromConfig(\n        config.getOptionalConfigArray('home.topVisits.filterBy') ?? [],\n      );\n      return await visitsApi\n        .list({\n          limit: numVisitsTotal ?? 8,\n          orderBy: [{ field: 'hits', direction: 'desc' }],\n          ...(filterBy && { filterBy }),\n        })\n        .then(setVisits);\n    }\n    return undefined;\n  }, [visitsApi, visits, loading, setVisits]);\n  useEffect(() => {\n    if (!loading) {\n      setLoading(reqLoading);\n    }\n  }, [loading, setLoading, reqLoading]);\n\n  return <VisitedByType />;\n};\n"],"names":[],"mappings":";;;;;;;;;;AAwCO,MAAM,UAAU,CAAC;AAAA,EACtB,MAAA;AAAA,EACA,aAAA;AAAA,EACA,cAAA;AAAA,EACA,OAAA;AAAA,EACA;AACF,CAAA,KAA0B;AACxB,EAAA,MAAM,EAAE,UAAA,EAAY,SAAA,EAAW,UAAA,KAAe,UAAA,EAAW;AAEzD,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,MAAM,UAAqC,EAAC;AAC5C,IAAA,OAAA,CAAQ,IAAA,GAAO,IAAA;AACf,IAAA,IAAI,MAAA,EAAQ;AACV,MAAA,OAAA,CAAQ,MAAA,GAAS,MAAA;AACjB,MAAA,OAAA,CAAQ,OAAA,GAAU,KAAA;AAAA,IACpB,WAAW,OAAA,EAAS;AAClB,MAAA,OAAA,CAAQ,OAAA,GAAU,OAAA;AAAA,IACpB;AACA,IAAA,IAAI,aAAA,UAAuB,aAAA,GAAgB,aAAA;AAC3C,IAAA,IAAI,cAAA,UAAwB,cAAA,GAAiB,cAAA;AAC7C,IAAA,UAAA,CAAW,YAAU,EAAE,GAAG,KAAA,EAAO,GAAG,SAAQ,CAAE,CAAA;AAAA,EAChD,CAAA,EAAG,CAAC,UAAA,EAAY,IAAA,EAAM,QAAQ,OAAA,EAAS,aAAA,EAAe,cAAc,CAAC,CAAA;AAErE,EAAA,MAAM,MAAA,GAAS,OAAO,YAAY,CAAA;AAElC,EAAA,MAAM,SAAA,GAAY,OAAO,YAAY,CAAA;AACrC,EAAA,MAAM,EAAE,OAAA,EAAS,UAAA,EAAW,GAAI,SAAS,YAAY;AACnD,IAAA,IAAI,CAAC,MAAA,IAAU,CAAC,OAAA,IAAW,SAAS,QAAA,EAAU;AAC5C,MAAA,MAAM,QAAA,GAAW,kCAAA;AAAA,QACf,MAAA,CAAO,sBAAA,CAAuB,4BAA4B,CAAA,IAAK;AAAC,OAClE;AACA,MAAA,OAAO,MAAM,UACV,IAAA,CAAK;AAAA,QACJ,OAAO,cAAA,IAAkB,CAAA;AAAA,QACzB,SAAS,CAAC,EAAE,OAAO,WAAA,EAAa,SAAA,EAAW,QAAQ,CAAA;AAAA,QACnD,GAAI,QAAA,IAAY,EAAE,QAAA;AAAS,OAC5B,CAAA,CACA,IAAA,CAAK,SAAS,CAAA;AAAA,IACnB;AACA,IAAA,IAAI,CAAC,MAAA,IAAU,CAAC,OAAA,IAAW,SAAS,KAAA,EAAO;AACzC,MAAA,MAAM,QAAA,GAAW,kCAAA;AAAA,QACf,MAAA,CAAO,sBAAA,CAAuB,yBAAyB,CAAA,IAAK;AAAC,OAC/D;AACA,MAAA,OAAO,MAAM,UACV,IAAA,CAAK;AAAA,QACJ,OAAO,cAAA,IAAkB,CAAA;AAAA,QACzB,SAAS,CAAC,EAAE,OAAO,MAAA,EAAQ,SAAA,EAAW,QAAQ,CAAA;AAAA,QAC9C,GAAI,QAAA,IAAY,EAAE,QAAA;AAAS,OAC5B,CAAA,CACA,IAAA,CAAK,SAAS,CAAA;AAAA,IACnB;AACA,IAAA,OAAO,MAAA;AAAA,EACT,GAAG,CAAC,SAAA,EAAW,MAAA,EAAQ,OAAA,EAAS,SAAS,CAAC,CAAA;AAC1C,EAAA,SAAA,CAAU,MAAM;AACd,IAAA,IAAI,CAAC,OAAA,EAAS;AACZ,MAAA,UAAA,CAAW,UAAU,CAAA;AAAA,IACvB;AAAA,EACF,CAAA,EAAG,CAAC,OAAA,EAAS,UAAA,EAAY,UAAU,CAAC,CAAA;AAEpC,EAAA,2BAAQ,aAAA,EAAA,EAAc,CAAA;AACxB;;;;"}