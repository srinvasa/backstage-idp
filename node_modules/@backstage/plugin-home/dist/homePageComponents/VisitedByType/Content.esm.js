import { jsx } from 'react/jsx-runtime';
import { useEffect } from 'react';
import { createFilterByQueryParamFromConfig } from '../../api/config.esm.js';
import { VisitedByType } from './VisitedByType.esm.js';
import '@backstage/core-app-api';
import { visitsApiRef } from '../../api/VisitsApi.esm.js';
import { useContext } from './Context.esm.js';
import { useApi, configApiRef } from '@backstage/core-plugin-api';
import useAsync from 'react-use/esm/useAsync';

const Content = ({
  visits,
  numVisitsOpen,
  numVisitsTotal,
  loading,
  kind
}) => {
  const { setContext, setVisits, setLoading } = useContext();
  useEffect(() => {
    const context = {};
    context.kind = kind;
    if (visits) {
      context.visits = visits;
      context.loading = false;
    } else if (loading) {
      context.loading = loading;
    }
    if (numVisitsOpen) context.numVisitsOpen = numVisitsOpen;
    if (numVisitsTotal) context.numVisitsTotal = numVisitsTotal;
    setContext((state) => ({ ...state, ...context }));
  }, [setContext, kind, visits, loading, numVisitsOpen, numVisitsTotal]);
  const config = useApi(configApiRef);
  const visitsApi = useApi(visitsApiRef);
  const { loading: reqLoading } = useAsync(async () => {
    if (!visits && !loading && kind === "recent") {
      const filterBy = createFilterByQueryParamFromConfig(
        config.getOptionalConfigArray("home.recentVisits.filterBy") ?? []
      );
      return await visitsApi.list({
        limit: numVisitsTotal ?? 8,
        orderBy: [{ field: "timestamp", direction: "desc" }],
        ...filterBy && { filterBy }
      }).then(setVisits);
    }
    if (!visits && !loading && kind === "top") {
      const filterBy = createFilterByQueryParamFromConfig(
        config.getOptionalConfigArray("home.topVisits.filterBy") ?? []
      );
      return await visitsApi.list({
        limit: numVisitsTotal ?? 8,
        orderBy: [{ field: "hits", direction: "desc" }],
        ...filterBy && { filterBy }
      }).then(setVisits);
    }
    return void 0;
  }, [visitsApi, visits, loading, setVisits]);
  useEffect(() => {
    if (!loading) {
      setLoading(reqLoading);
    }
  }, [loading, setLoading, reqLoading]);
  return /* @__PURE__ */ jsx(VisitedByType, {});
};

export { Content };
//# sourceMappingURL=Content.esm.js.map
