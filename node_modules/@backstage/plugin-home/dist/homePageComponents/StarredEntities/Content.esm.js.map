{"version":3,"file":"Content.esm.js","sources":["../../../src/homePageComponents/StarredEntities/Content.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  catalogApiRef,\n  useStarredEntities,\n} from '@backstage/plugin-catalog-react';\nimport { Entity, stringifyEntityRef } from '@backstage/catalog-model';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { Progress, ResponseErrorPanel } from '@backstage/core-components';\nimport List from '@material-ui/core/List';\nimport Typography from '@material-ui/core/Typography';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport { ReactNode, useState } from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport { StarredEntityListItem } from '../../components/StarredEntityListItem/StarredEntityListItem';\nimport { makeStyles } from '@material-ui/core/styles';\nimport { useTranslationRef } from '@backstage/frontend-plugin-api';\nimport { homeTranslationRef } from '../../translation';\n\nconst useStyles = makeStyles(theme => ({\n  tabs: {\n    marginBottom: theme.spacing(1),\n  },\n  list: {\n    paddingTop: 0,\n    paddingBottom: 0,\n  },\n}));\n\n/**\n * Props for the StarredEntities component\n *\n * @public\n */\nexport type StarredEntitiesProps = {\n  noStarredEntitiesMessage?: ReactNode | undefined;\n  groupByKind?: boolean;\n};\n\n/**\n * A component to display a list of starred entities for the user.\n *\n * @public\n */\nexport const Content = ({\n  noStarredEntitiesMessage,\n  groupByKind,\n}: StarredEntitiesProps) => {\n  const classes = useStyles();\n  const catalogApi = useApi(catalogApiRef);\n  const { starredEntities, toggleStarredEntity } = useStarredEntities();\n  const [activeTab, setActiveTab] = useState(0);\n  const { t } = useTranslationRef(homeTranslationRef);\n\n  // Grab starred entities from catalog to ensure they still exist and also retrieve display titles\n  const entities = useAsync(async () => {\n    if (!starredEntities.size) {\n      return [];\n    }\n\n    return (\n      await catalogApi.getEntitiesByRefs({\n        entityRefs: [...starredEntities],\n        fields: [\n          'kind',\n          'metadata.namespace',\n          'metadata.name',\n          'spec.type',\n          'metadata.title',\n          'spec.profile.displayName',\n        ],\n      })\n    ).items.filter((e): e is Entity => !!e);\n  }, [catalogApi, starredEntities]);\n\n  if (starredEntities.size === 0)\n    return (\n      <Typography variant=\"body1\">\n        {noStarredEntitiesMessage ||\n          t('starredEntities.noStarredEntitiesMessage')}\n      </Typography>\n    );\n\n  if (entities.loading) {\n    return <Progress />;\n  }\n\n  const groupedEntities: { [kind: string]: Entity[] } = {};\n  entities.value?.forEach(entity => {\n    const kind = entity.kind;\n    if (!groupedEntities[kind]) {\n      groupedEntities[kind] = [];\n    }\n    groupedEntities[kind].push(entity);\n  });\n\n  const groupByKindEntries = Object.entries(groupedEntities);\n\n  return entities.error ? (\n    <ResponseErrorPanel error={entities.error} />\n  ) : (\n    <div>\n      {!groupByKind && (\n        <List className={classes.list}>\n          {entities.value\n            ?.sort((a, b) =>\n              (a.metadata.title ?? a.metadata.name).localeCompare(\n                b.metadata.title ?? b.metadata.name,\n              ),\n            )\n            .map(entity => (\n              <StarredEntityListItem\n                key={stringifyEntityRef(entity)}\n                entity={entity}\n                onToggleStarredEntity={toggleStarredEntity}\n                showKind\n              />\n            ))}\n        </List>\n      )}\n\n      {groupByKind && (\n        <Tabs\n          className={classes.tabs}\n          value={activeTab}\n          onChange={(_, newValue) => setActiveTab(newValue)}\n          variant=\"scrollable\"\n          scrollButtons=\"auto\"\n          aria-label=\"entity-tabs\"\n        >\n          {groupByKindEntries.map(([kind]) => (\n            <Tab key={kind} label={kind} />\n          ))}\n        </Tabs>\n      )}\n\n      {groupByKind &&\n        groupByKindEntries.map(([kind, entitiesByKind], index) => (\n          <div key={kind} hidden={groupByKind && activeTab !== index}>\n            <List className={classes.list}>\n              {entitiesByKind\n                ?.sort((a, b) =>\n                  (a.metadata.title ?? a.metadata.name).localeCompare(\n                    b.metadata.title ?? b.metadata.name,\n                  ),\n                )\n                .map(entity => (\n                  <StarredEntityListItem\n                    key={stringifyEntityRef(entity)}\n                    entity={entity}\n                    onToggleStarredEntity={toggleStarredEntity}\n                    showKind={false}\n                  />\n                ))}\n            </List>\n          </div>\n        ))}\n    </div>\n  );\n};\n"],"names":[],"mappings":"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"}