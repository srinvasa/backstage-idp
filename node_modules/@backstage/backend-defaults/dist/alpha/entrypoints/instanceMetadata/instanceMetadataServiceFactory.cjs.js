'use strict';

var backendPluginApi = require('@backstage/backend-plugin-api');
var alpha = require('@backstage/backend-plugin-api/alpha');

const instanceMetadataServiceFactory = backendPluginApi.createServiceFactory({
  service: alpha.instanceMetadataServiceRef,
  deps: {
    instanceMetadata: backendPluginApi.coreServices.rootInstanceMetadata
  },
  factory: async ({ instanceMetadata }) => {
    const plugins = await instanceMetadata.getInstalledPlugins();
    const features = [];
    for (const plugin of plugins) {
      features.push({
        type: "plugin",
        pluginId: plugin.pluginId
      });
      for (const module of plugin.modules) {
        features.push({
          type: "module",
          pluginId: plugin.pluginId,
          moduleId: module.moduleId
        });
      }
    }
    const service = {
      getInstalledFeatures: () => features
    };
    return service;
  }
});

exports.instanceMetadataServiceFactory = instanceMetadataServiceFactory;
//# sourceMappingURL=instanceMetadataServiceFactory.cjs.js.map
