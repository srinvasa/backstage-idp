{"version":3,"file":"ExpandableNavigation.esm.js","sources":["../../src/ExpandableNavigation/ExpandableNavigation.tsx"],"sourcesContent":["/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useEffect, useState } from 'react';\nimport { useLocalStorageValue } from '@react-hookz/web';\nimport { Button, withStyles } from '@material-ui/core';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\n\nimport { useShadowRootElements } from '@backstage/plugin-techdocs-react';\n\nconst NESTED_LIST_TOGGLE = '.md-nav__item--nested .md-toggle';\n\nconst EXPANDABLE_NAVIGATION_LOCAL_STORAGE =\n  '@backstage/techdocs-addons/nav-expanded';\n\nconst StyledButton = withStyles({\n  root: {\n    position: 'absolute',\n    left: '13.7rem', // Sidebar inner width (15.1em) minus the different margins/paddings\n    top: '19px',\n    zIndex: 2,\n    padding: 0,\n    minWidth: 0,\n  },\n})(Button);\n\nconst CollapsedIcon = withStyles({\n  root: {\n    height: '20px',\n    width: '20px',\n  },\n})(ChevronRightIcon);\n\nconst ExpandedIcon = withStyles({\n  root: {\n    height: '20px',\n    width: '20px',\n  },\n})(ExpandMoreIcon);\n\ntype expandableNavigationLocalStorage = {\n  expandAllNestedNavs: boolean;\n};\n\n/**\n * Show expand/collapse navigation button next to site name in main\n * navigation menu if documentation site has nested navigation.\n */\nexport const ExpandableNavigationAddon = () => {\n  const defaultValue = { expandAllNestedNavs: false };\n  const { value: expanded, set: setExpanded } =\n    useLocalStorageValue<expandableNavigationLocalStorage>(\n      EXPANDABLE_NAVIGATION_LOCAL_STORAGE,\n      { defaultValue },\n    );\n  const [hasNavSubLevels, setHasNavSubLevels] = useState<boolean>(false);\n\n  const [...checkboxToggles] = useShadowRootElements<HTMLInputElement>([\n    NESTED_LIST_TOGGLE,\n  ]);\n\n  // Define handleKeyPass as a named function\n  function handleKeyPass(\n    event: React.KeyboardEvent<HTMLElement>,\n    toggleAction: () => void,\n  ) {\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      toggleAction();\n    }\n  }\n\n  useEffect(() => {\n    if (!checkboxToggles?.length) return;\n    setHasNavSubLevels(true);\n  }, [checkboxToggles]);\n\n  useEffect(() => {\n    if (!checkboxToggles?.length) return;\n    function shouldToggle(item: HTMLInputElement) {\n      return expanded?.expandAllNestedNavs !== item.checked;\n    }\n    for (const item of checkboxToggles) {\n      if (shouldToggle(item)) {\n        item.click();\n      }\n    }\n  }, [expanded, checkboxToggles]);\n\n  const handleState = () => {\n    setExpanded(prevState => ({\n      expandAllNestedNavs: !prevState?.expandAllNestedNavs,\n    }));\n  };\n\n  function handleButtonKeyDown(event: React.KeyboardEvent<HTMLElement>) {\n    handleKeyPass(event, handleState);\n  }\n\n  return (\n    <>\n      {hasNavSubLevels ? (\n        <StyledButton\n          size=\"small\"\n          onClick={handleState}\n          onKeyDown={handleButtonKeyDown}\n          tabIndex={0} // Ensuring keyboard focus\n          aria-expanded={expanded?.expandAllNestedNavs} // Accessibility\n          aria-label={\n            expanded?.expandAllNestedNavs ? 'collapse-nav' : 'expand-nav'\n          }\n        >\n          {expanded?.expandAllNestedNavs ? <ExpandedIcon /> : <CollapsedIcon />}\n        </StyledButton>\n      ) : null}\n    </>\n  );\n};\n"],"names":[],"mappings":"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"}