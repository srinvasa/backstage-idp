{"version":3,"file":"index.esm.js","sources":["../src/api/ArtifactoryPluginBackendClient.ts","../src/api/types.ts","../src/routes.ts","../src/plugin.ts"],"sourcesContent":["import { Entity } from '@backstage/catalog-model';\nimport { ArtifactoryPluginApi } from './types';\nimport { DiscoveryApi } from '@backstage/core-plugin-api';\nimport { Artifact } from './types';\n\nexport class ArtifactoryPluginBackendClient implements ArtifactoryPluginApi {\n  private readonly discoveryApi: DiscoveryApi;\n  constructor(options: {\n    discoveryApi: DiscoveryApi;\n  }) {\n    this.discoveryApi = options.discoveryApi;\n\n  }\n  private async handleResponse(response: Response): Promise<any> {\n    if (!response.ok) {\n      throw new Error();\n    }\n    const data = await response.json();\n    if (!data.artifacts) {\n      return data;\n    }\n    return data.artifacts as Promise<Artifact[]>;\n  }\n\n  async getHealth(): Promise<{ status: string; }> {\n    const url = `${await this.discoveryApi.getBaseUrl('artifactory')}/health`;\n    const response = await fetch(url, {\n      method: 'GET',\n    });\n    return await this.handleResponse(response);\n  }\n  async getArtifacts(entity: Entity): Promise<Artifact[]> {\n    const url = `${await this.discoveryApi.getBaseUrl('artifactory')}/artifacts`;\n    const response = await fetch(url, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        \"puka\": \"puka\"\n      },\n      body: `{\"entityRef\": \"${entity.kind}:${entity.metadata.namespace}/${entity.metadata.name}\" }`,\n    });\n    return await this.handleResponse(response);\n  }\n}","import { Entity } from '@backstage/catalog-model';\nimport { createApiRef } from '@backstage/core-plugin-api';\n\nexport interface ArtifactoryPluginApi {\n  getHealth(): Promise<{ status: string; }>;\n  getArtifacts(entity: Entity): Promise<Artifact[]>;\n}\n\nexport const ArtifactoryPluginApiRef = createApiRef<ArtifactoryPluginApi>({\n  id: 'plugin.artifactoryplugin.service',\n});\n\nexport type Artifact = {\n  name: string;\n  path: string;\n  repo: string;\n  size: number;\n  created: string;\n  modified: string;\n  updated: string;\n  createdBy: string;\n  modifiedBy: string;\n  updatedBy: string;\n  sha1: string;\n  md5: string;\n}","import { createRouteRef } from '@backstage/core-plugin-api';\n\nexport const rootRouteRef = createRouteRef({\n  id: 'stagecentral-artifactory',\n});\n","\nimport { \n  createApiFactory,\n  createPlugin,\n  createRoutableExtension,\n  discoveryApiRef,\n} from '@backstage/core-plugin-api';\nimport { ArtifactoryPluginBackendClient } from './api/ArtifactoryPluginBackendClient';\nimport { ArtifactoryPluginApiRef } from './api';\n\nimport { rootRouteRef } from './routes';\n\nexport const ArtifactoryPlugin = createPlugin({\n  id: 'stagecentral-artifactory',\n  apis: [\n    createApiFactory({\n      api: ArtifactoryPluginApiRef,\n      deps: {\n        discoveryApi: discoveryApiRef,\n      },\n      factory: ({ discoveryApi}) =>\n        new ArtifactoryPluginBackendClient({ discoveryApi }),\n    }),\n  ],\n  routes: {\n    root: rootRouteRef,\n  },\n});\n\nexport const EntityArtifactoryContent = ArtifactoryPlugin.provide(\n  createRoutableExtension({\n    name: 'EntityArtifactoryContent',\n    component: () =>\n      import('./components/ArtifactoryComponent').then(m => m.ArtifactoryComponent),\n    mountPoint: rootRouteRef,\n  }),\n);\n"],"names":[],"mappings":";;AAKO,MAAM,8BAA+D,CAAA;AAAA,EAE1E,YAAY,OAET,EAAA;AACD,IAAA,IAAA,CAAK,eAAe,OAAQ,CAAA,YAAA,CAAA;AAAA,GAE9B;AAAA,EACA,MAAc,eAAe,QAAkC,EAAA;AAC7D,IAAI,IAAA,CAAC,SAAS,EAAI,EAAA;AAChB,MAAA,MAAM,IAAI,KAAM,EAAA,CAAA;AAAA,KAClB;AACA,IAAM,MAAA,IAAA,GAAO,MAAM,QAAA,CAAS,IAAK,EAAA,CAAA;AACjC,IAAI,IAAA,CAAC,KAAK,SAAW,EAAA;AACnB,MAAO,OAAA,IAAA,CAAA;AAAA,KACT;AACA,IAAA,OAAO,IAAK,CAAA,SAAA,CAAA;AAAA,GACd;AAAA,EAEA,MAAM,SAA0C,GAAA;AAC9C,IAAA,MAAM,MAAM,CAAG,EAAA,MAAM,IAAK,CAAA,YAAA,CAAa,WAAW,aAAa,CAAA,CAAA,OAAA,CAAA,CAAA;AAC/D,IAAM,MAAA,QAAA,GAAW,MAAM,KAAA,CAAM,GAAK,EAAA;AAAA,MAChC,MAAQ,EAAA,KAAA;AAAA,KACT,CAAA,CAAA;AACD,IAAO,OAAA,MAAM,IAAK,CAAA,cAAA,CAAe,QAAQ,CAAA,CAAA;AAAA,GAC3C;AAAA,EACA,MAAM,aAAa,MAAqC,EAAA;AACtD,IAAA,MAAM,MAAM,CAAG,EAAA,MAAM,IAAK,CAAA,YAAA,CAAa,WAAW,aAAa,CAAA,CAAA,UAAA,CAAA,CAAA;AAC/D,IAAM,MAAA,QAAA,GAAW,MAAM,KAAA,CAAM,GAAK,EAAA;AAAA,MAChC,MAAQ,EAAA,MAAA;AAAA,MACR,OAAS,EAAA;AAAA,QACP,cAAgB,EAAA,kBAAA;AAAA,QAChB,MAAQ,EAAA,MAAA;AAAA,OACV;AAAA,MACA,IAAA,EAAM,kBAAkB,MAAO,CAAA,IAAA,CAAA,CAAA,EAAQ,OAAO,QAAS,CAAA,SAAA,CAAA,CAAA,EAAa,OAAO,QAAS,CAAA,IAAA,CAAA,GAAA,CAAA;AAAA,KACrF,CAAA,CAAA;AACD,IAAO,OAAA,MAAM,IAAK,CAAA,cAAA,CAAe,QAAQ,CAAA,CAAA;AAAA,GAC3C;AACF;;ACnCO,MAAM,0BAA0B,YAAmC,CAAA;AAAA,EACxE,EAAI,EAAA,kCAAA;AACN,CAAC;;ACRM,MAAM,eAAe,cAAe,CAAA;AAAA,EACzC,EAAI,EAAA,0BAAA;AACN,CAAC,CAAA;;ACQM,MAAM,oBAAoB,YAAa,CAAA;AAAA,EAC5C,EAAI,EAAA,0BAAA;AAAA,EACJ,IAAM,EAAA;AAAA,IACJ,gBAAiB,CAAA;AAAA,MACf,GAAK,EAAA,uBAAA;AAAA,MACL,IAAM,EAAA;AAAA,QACJ,YAAc,EAAA,eAAA;AAAA,OAChB;AAAA,MACA,OAAA,EAAS,CAAC,EAAE,YAAA,OACV,IAAI,8BAAA,CAA+B,EAAE,YAAA,EAAc,CAAA;AAAA,KACtD,CAAA;AAAA,GACH;AAAA,EACA,MAAQ,EAAA;AAAA,IACN,IAAM,EAAA,YAAA;AAAA,GACR;AACF,CAAC,EAAA;AAEM,MAAM,2BAA2B,iBAAkB,CAAA,OAAA;AAAA,EACxD,uBAAwB,CAAA;AAAA,IACtB,IAAM,EAAA,0BAAA;AAAA,IACN,WAAW,MACT,OAAO,+BAAqC,IAAK,CAAA,CAAA,CAAA,KAAK,EAAE,oBAAoB,CAAA;AAAA,IAC9E,UAAY,EAAA,YAAA;AAAA,GACb,CAAA;AACH;;;;"}