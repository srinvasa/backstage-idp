(self.webpackChunkapp=self.webpackChunkapp||[]).push([["8096"],{56420:function(e,t,r){"use strict";r.d(t,{Y:()=>T});var n=r(31085),i=r(95208),a=r(18139),o=r(54195),l=r(77125),s=r(64947),p=r(93453),c=r(29365),d=r(68804),u=r(5951),h=r(26343),m=r(28233),g=r(55197),x=r(58837),j=r(72501),y=r(5893),f=r(14041);r(45250);var b=r(70209),A=r(92483),v=r(75202),w=r(89475),L=r(10265);let R=(0,x.A)({popoverList:{minWidth:260,maxWidth:400},menuItem:{whiteSpace:"normal"}},{name:"BackstageSupportButton"}),P=({icon:e})=>{let t=(0,i.n)(),r=e?t.getSystemIcon(e)??A.NT:A.NT;return(0,n.jsx)(r,{})},k=({link:e})=>(0,n.jsx)(v.N_,{to:e.url,children:e.title??e.url}),S=({item:e})=>(0,n.jsxs)(h.A,{button:!1,children:[(0,n.jsx)(d.A,{children:(0,n.jsx)(P,{icon:e.icon})}),(0,n.jsx)(u.A,{primary:e.title,secondary:e.links?.reduce((e,t,r)=>[...e,r>0&&(0,n.jsx)("br",{},r),(0,n.jsx)(k,{link:t},t.url)],[])})]});function T(e){let{t}=(0,L.i)(w.O),{title:r,items:i,children:d}=e,{items:u}=(0,b.l)(),[x,v]=(0,f.useState)(!1),[P,k]=(0,f.useState)(null),T=R(),C=(0,a.gf)(o.U).getOptionalConfig("app.support"),I=(0,y.A)(e=>e.breakpoints.down("sm")),q=e=>{k(e.currentTarget),v(!0)},z=()=>{v(!1)};return C?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.A,{display:"flex",ml:1,children:I?(0,n.jsx)(c.A,{color:"primary",size:"small",onClick:q,"data-testid":"support-button","aria-label":"Support",children:(0,n.jsx)(A.NT,{})}):(0,n.jsx)(s.A,{"data-testid":"support-button","aria-label":"Support",color:"primary",onClick:q,startIcon:(0,n.jsx)(A.NT,{}),children:t("supportButton.title")})}),(0,n.jsxs)(g.Ay,{"data-testid":"support-button-popover",open:x,anchorEl:P,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},onClose:z,children:[(0,n.jsxs)(m.A,{className:T.popoverList,autoFocusItem:!!P,children:[r&&(0,n.jsx)(h.A,{button:!1,alignItems:"flex-start",className:T.menuItem,children:(0,n.jsx)(j.A,{variant:"subtitle1",children:r})}),f.Children.map(d,(e,t)=>(0,n.jsx)(h.A,{button:!1,alignItems:"flex-start",className:T.menuItem,children:e},`child-${t}`)),(i??u).map((e,t)=>(0,n.jsx)(S,{item:e},`item-${t}`))]}),(0,n.jsx)(p.A,{children:(0,n.jsx)(s.A,{color:"primary",onClick:z,"aria-label":"Close",children:t("supportButton.close")})})]})]}):null}},20259:function(e,t,r){"use strict";r.d(t,{ImportPage:()=>eW});var n=r(31085),i=r(18690),a=r(82326),o=r(79182),l=r(16454),s=r(17138),p=r(56420),c=r(18139),d=r(54195),u=r(10265),h=r(42899),m=r(54917),g=r(5893);let x=(0,r(48870).h)({id:"catalog-import",messages:{buttons:{back:"Back"},defaultImportPage:{headerTitle:"Register an existing component",contentHeaderTitle:"Start tracking your component in {{appTitle}}",supportTitle:"Start tracking your component in {{appTitle}} by adding it to the software catalog."},importInfoCard:{title:"Register an existing component",deepLinkTitle:"Learn more about the Software Catalog",linkDescription:"Enter the URL to your source code repository to add it to {{appTitle}}.",fileLinkTitle:"Link to an existing entity file",examplePrefix:"Example: ",fileLinkDescription:"The wizard analyzes the file, previews the entities, and adds them to the {{appTitle}} catalog.",githubIntegration:{title:"Link to a repository",label:"GitHub only"},exampleDescription:"The wizard discovers all {{catalogFilename}} files in the repository, previews the entities, and adds them to the {{appTitle}} catalog.",preparePullRequestDescription:"If no entities are found, the wizard will prepare a Pull Request that adds an example {{catalogFilename}} and prepares the {{appTitle}} catalog to load all entities as soon as the Pull Request is merged."},importStepper:{singleLocation:{title:"Select Locations",description:"Discovered Locations: 1"},multipleLocations:{title:"Select Locations",description:"Discovered Locations: {{length, number}}"},noLocation:{title:"Create Pull Request",createPr:{detailsTitle:"Pull Request Details",titleLabel:"Pull Request Title",titlePlaceholder:"Add Backstage catalog entity descriptor files",bodyLabel:"Pull Request Body",bodyPlaceholder:"A describing text with Markdown support",configurationTitle:"Entity Configuration",componentNameLabel:"Name of the created component",componentNamePlaceholder:"my-component",ownerLoadingText:"Loading groupsâ€¦",ownerHelperText:"Select an owner from the list or enter a reference to a Group or a User",ownerErrorHelperText:"required value",ownerLabel:"Entity Owner",ownerPlaceholder:"my-group",codeownersHelperText:"WARNING: This may fail if no CODEOWNERS file is found at the target location."}},analyze:{title:"Select URL"},prepare:{title:"Import Actions",description:"Optional"},review:{title:"Review"},finish:{title:"Finish"}},stepFinishImportLocation:{backButtonText:"Register another",repository:{title:"The following Pull Request has been opened: ",description:"Your entities will be imported as soon as the Pull Request is merged."},locations:{new:"The following entities have been added to the catalog:",existing:"A refresh was triggered for the following locations:",viewButtonText:"View Component",backButtonText:"Register another"}},stepInitAnalyzeUrl:{error:{repository:"Couldn't generate entities for your repository",locations:"There are no entities at this location",default:"Received unknown analysis result of type {{type}}. Please contact the support team.",url:"Must start with http:// or https://."},urlHelperText:"Enter the full path to your entity file to start tracking your component",nextButtonText:"Analyze"},stepPrepareCreatePullRequest:{description:"You entered a link to a {{integrationType}} repository but a {{catalogFilename}} could not be found. Use this form to open a Pull Request that creates one.",previewPr:{title:"Preview Pull Request",subheader:"Create a new Pull Request"},previewCatalogInfo:{title:"Preview Entities"},nextButtonText:"Create PR"},stepPrepareSelectLocations:{locations:{description:"Select one or more locations that are present in your git repository:",selectAll:"Select All"},existingLocations:{description:"These locations already exist in the catalog:"},nextButtonText:"Review"},stepReviewLocation:{prepareResult:{title:"The following Pull Request has been opened: ",description:"You can already import the location and {{appTitle}} will fetch the entities as soon as the Pull Request is merged."},catalog:{exists:"The following locations already exist in the catalog:",new:"The following entities will be added to the catalog:"},refresh:"Refresh",import:"Import"}}});var j=r(21332),y=r(94390),f=r(72501),b=r(5336),A=r(64402);r(52536);var v=r(3969);function w(){let e=(0,c.gf)(d.U);return(0,v.J7)(e)}let L=e=>{let{exampleLocationUrl:t="https://github.com/backstage/backstage/blob/master/catalog-info.yaml",exampleRepositoryUrl:r="https://github.com/backstage/backstage"}=e,{t:i}=(0,u.i)(x),a=(0,c.gf)(d.U),o=a.getOptionalString("app.title")||"Backstage",l=(0,c.gf)(b.g),s=a.has("integrations.github"),p=w();return(0,n.jsxs)(j.n,{title:i("importInfoCard.title"),titleTypographyProps:{component:"h3"},deepLink:{title:i("importInfoCard.deepLinkTitle"),link:"https://backstage.io/docs/features/software-catalog/"},children:[(0,n.jsx)(f.A,{variant:"body2",paragraph:!0,children:i("importInfoCard.linkDescription",{appTitle:o})}),(0,n.jsx)(f.A,{component:"h4",variant:"h6",children:i("importInfoCard.fileLinkTitle")}),(0,n.jsxs)(f.A,{variant:"subtitle2",color:"textSecondary",paragraph:!0,children:[i("importInfoCard.examplePrefix"),(0,n.jsx)("code",{children:t})]}),(0,n.jsx)(f.A,{variant:"body2",paragraph:!0,children:i("importInfoCard.fileLinkDescription",{appTitle:o})}),s&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.A,{component:"h4",variant:"h6",children:[i("importInfoCard.githubIntegration.title"),(0,n.jsx)(y.A,{label:i("importInfoCard.githubIntegration.label"),variant:"outlined",size:"small",style:{marginLeft:8,marginBottom:0}})]}),(0,n.jsxs)(f.A,{variant:"subtitle2",color:"textSecondary",paragraph:!0,children:[i("importInfoCard.examplePrefix"),(0,n.jsx)("code",{children:r})]}),(0,n.jsx)(f.A,{variant:"body2",paragraph:!0,children:i("importInfoCard.exampleDescription",{catalogFilename:(0,n.jsx)("code",{children:p}),appTitle:o})}),l.preparePullRequest&&(0,n.jsx)(f.A,{variant:"body2",paragraph:!0,children:i("importInfoCard.preparePullRequestDescription",{catalogFilename:(0,n.jsx)("code",{children:p}),appTitle:o})})]})]})};var R=r(21619),P=r(41045),k=r(78733),S=r(58837),T=r(14041);function C(e){return{activeFlow:"unknown",activeState:"analyze",analysisUrl:e,previousStates:[]}}function I(e,t){switch(t.type){case"onAnalysis":{if("analyze"!==e.activeState)return e;let{activeState:r,previousStates:n}=e,[i,a,o,l]=t.args;return{...e,analysisUrl:a,activeFlow:i,analyzeResult:o,prepareResult:l?.prepareResult,activeState:l?.prepareResult===void 0?"prepare":"review",previousStates:n.concat(r)}}case"onPrepare":{if("prepare"!==e.activeState)return e;let{activeState:r,previousStates:n}=e,[i,a]=t.args;return{...e,prepareResult:i,activeState:"review",previousStates:a?.notRepeatable?[]:n.concat(r)}}case"onReview":{if("review"!==e.activeState)return e;let{activeState:r,previousStates:n}=e,[i]=t.args;return{...e,reviewResult:i,activeState:"finish",previousStates:n.concat(r)}}case"onGoBack":{let{activeState:t,previousStates:r}=e;return{...e,activeState:r.length>0?r[r.length-1]:t,previousStates:r.slice(0,r.length-1)}}case"onReset":return{...C(t.initialUrl),prepareResult:e.prepareResult};default:throw Error()}}var q=r(77125),z=r(98552),F=r(86901),N=r(51253),U=r(37877),B=r(16249),E=r(87318),O=r(64947),D=r(78467);let G=(0,S.A)(e=>({wrapper:{marginTop:e.spacing(1),marginRight:e.spacing(1),position:"relative"},buttonProgress:{position:"absolute",top:"50%",left:"50%",marginTop:-12,marginLeft:-12},button:{marginTop:e.spacing(1),marginRight:e.spacing(1)}})),H=e=>{let{loading:t,...r}=e,i=G();return(0,n.jsxs)("div",{className:i.wrapper,children:[(0,n.jsx)(O.A,{color:"primary",variant:"contained",...r,disabled:e.disabled||e.loading}),e.loading&&(0,n.jsx)(D.A,{size:"1.5rem",className:i.buttonProgress}),e.loading]})},W=e=>{let{t}=(0,u.i)(x),r=G();return(0,n.jsx)(O.A,{variant:"outlined",className:r.button,...e,children:e.children||t("buttons.back")})},Y=e=>{let t=G();return(0,n.jsx)(E.z,{color:"primary",variant:"contained",className:t.button,...e,children:e.children})};var V=r(55488),$=r(75202),_=r(72814),M=r(20987),J=r(52755),K=r(19953),Q=r.n(K),X=r(78560),Z=r(91072),ee=r(37281),et=r(45809),er=r(69621),en=r(29365),ei=r(58007),ea=r(8109),eo=r(68804),el=r(65569),es=r(5951),ep=r(23164),ec=r(6924);let ed=(0,S.A)(e=>({nested:{paddingLeft:e.spacing(4)}})),eu=e=>{let{locations:t,collapsed:r=!1,locationListItemIcon:i,onItemClick:a,firstListItem:o,withLinks:l=!1}=e,s=ed(),p=(0,c.gf)(Z.n),[d,u]=(0,T.useState)([]);return(0,n.jsxs)(ei.A,{children:[o,t.map(e=>(0,n.jsxs)(T.Fragment,{children:[(0,n.jsxs)(ea.A,{dense:!0,button:!!a,onClick:()=>a?.(e.target),children:[(0,n.jsx)(eo.A,{children:i(e.target)}),(0,n.jsx)(es.A,{primary:e.target,secondary:`Entities: ${e.entities.length}`}),r&&(0,n.jsx)(el.A,{children:(0,n.jsx)(en.A,{edge:"end",onClick:()=>{var t;return t=e.target,void u(e=>e.includes(t)?e.filter(e=>e!==t):e.concat(t))},children:d.includes(e.target)?(0,n.jsx)(ep.default,{}):(0,n.jsx)(ec.default,{})})})]}),(0,n.jsx)(er.A,{in:!r||d.includes(e.target),timeout:"auto",unmountOnExit:!0,children:(0,n.jsx)(ei.A,{component:"div",disablePadding:!0,dense:!0,children:e.entities.sort((e,t)=>p.forEntity((0,X.U2)(e)).snapshot.entityRef.localeCompare(p.forEntity((0,X.U2)(t)).snapshot.entityRef)).map(e=>(0,n.jsx)(ea.A,{className:s.nested,...l?{component:ee.z,entityRef:e,button:l}:{},children:(0,n.jsx)(es.A,{primary:(0,n.jsx)(et.d,{entityRef:e})})},(0,X.U2)(e)))})})]},e.target))]})},eh=({prepareResult:e,onReset:t})=>{let{t:r}=(0,u.i)(x),i=(0,_.S)(M.s);if("repository"===e.type)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.A,{paragraph:!0,children:[r("stepFinishImportLocation.repository.title"),(0,n.jsx)($.N_,{to:e.pullRequest.url,target:"_blank",rel:"noreferrer",children:e.pullRequest.url})]}),(0,n.jsx)(f.A,{paragraph:!0,children:r("stepFinishImportLocation.repository.description")}),(0,n.jsx)(h.A,{container:!0,spacing:0,children:(0,n.jsx)(W,{onClick:t,children:r("stepFinishImportLocation.backButtonText")})})]});let[a,o]=Q()(e.locations,e=>e.exists),l=(e=>{for(let t of e)for(let e of t.entities)if(["component","api","resource"].includes(e.kind.toLocaleLowerCase("en-US")))return{kind:e.kind.toLocaleLowerCase("en-US"),namespace:e.namespace?.toLocaleLowerCase("en-US")??V.oQ,name:e.name};return null})(o);return(0,n.jsxs)(n.Fragment,{children:[o.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{children:r("stepFinishImportLocation.locations.new")}),(0,n.jsx)(eu,{locations:o,locationListItemIcon:()=>(0,n.jsx)(J.default,{}),withLinks:!0})]}),a.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{children:r("stepFinishImportLocation.locations.existing")}),(0,n.jsx)(eu,{locations:a,locationListItemIcon:()=>(0,n.jsx)(J.default,{}),withLinks:!0})]}),(0,n.jsxs)(h.A,{container:!0,spacing:0,children:[l&&(0,n.jsx)(Y,{to:i(l),children:r("stepFinishImportLocation.locations.viewButtonText")}),(0,n.jsx)(W,{onClick:t,children:r("stepFinishImportLocation.backButtonText")})]})]})};var em=r(24453),eg=r(80824);let ex=e=>{let{t}=(0,u.i)(x),{onAnalysis:r,analysisUrl:i="",disablePullRequest:a=!1,exampleLocationUrl:o="https://github.com/backstage/backstage/blob/master/catalog-info.yaml"}=e,l=(0,c.gf)(em.m),s=(0,c.gf)(b.g),{register:p,handleSubmit:d,formState:{errors:m},watch:g}=(0,eg.mN)({mode:"onTouched",defaultValues:{url:i}}),[j,y]=(0,T.useState)(!1),[f,A]=(0,T.useState)(void 0),w=(0,T.useCallback)(async({url:e})=>{y(!0);try{let n=await s.analyzeUrl(e);switch(n.type){case"repository":!a&&n.generatedEntities.length>0?r("no-location",e,n):(A(t("stepInitAnalyzeUrl.error.repository")),y(!1));break;case"locations":1===n.locations.length?r("single-location",e,n,{prepareResult:n}):n.locations.length>1?r("multiple-locations",e,n):(A(t("stepInitAnalyzeUrl.error.locations")),y(!1));break;default:{let e=t("stepInitAnalyzeUrl.error.default",{type:n.type});A(e),y(!1),l.post(Error(e))}}}catch(e){A(e?.body?.error?.message??e.message),y(!1)}},[s,a,l,r,t]);return(0,n.jsxs)("form",{onSubmit:d(w),children:[(0,n.jsx)(B.A,{...(0,v.eO)(p("url",{required:!0,validate:{httpsValidator:e=>"string"==typeof e&&null!==e.match(/^http[s]?:\/\//)||t("stepInitAnalyzeUrl.error.url")}})),fullWidth:!0,id:"url",label:"URL",placeholder:o,helperText:t("stepInitAnalyzeUrl.urlHelperText"),margin:"normal",variant:"outlined",error:!!m.url,required:!0}),m.url&&(0,n.jsx)(N.A,{error:!0,children:m.url.message}),f&&(0,n.jsx)(N.A,{error:!0,children:f}),(0,n.jsx)(h.A,{container:!0,spacing:0,children:(0,n.jsx)(H,{disabled:!!m.url||!g("url"),loading:j,type:"submit",children:t("stepInitAnalyzeUrl.nextButtonText")})})]})};var ej=r(98312);let ey=e=>{let{name:t,options:r,required:i,errors:a,rules:o,loading:l=!1,loadingText:s,helperText:p,errorHelperText:c,textFieldProps:d={}}=e;return(0,n.jsx)(eg.xI,{name:t,rules:o,render:({field:{onChange:e}})=>(0,n.jsx)(ej.Ay,{loading:l,loadingText:s,options:r||[],autoSelect:!0,freeSolo:!0,onChange:(t,r)=>e(r),renderInput:e=>(0,n.jsx)(B.A,{...e,helperText:a?.[t]&&c||p,error:!!a?.[t],margin:"normal",variant:"outlined",required:i,InputProps:{...e.InputProps,endAdornment:(0,n.jsxs)(T.Fragment,{children:[l?(0,n.jsx)(D.A,{color:"inherit",size:"1em"}):null,e.InputProps.endAdornment]})},...d})})})};var ef=r(45250),eb=r(67457),eA=r(30043),ev=r(53318),ew=r(73466);let eL=e=>{let{defaultValues:t,onSubmit:r,render:i}=e,a=(0,eg.mN)({mode:"onTouched",defaultValues:t}),{handleSubmit:o,watch:l,control:s,register:p,formState:c,setValue:d}=a;return(0,n.jsx)(eg.Op,{...a,children:(0,n.jsx)("form",{onSubmit:o(r),children:i({values:l(),formState:c,register:p,control:s,setValue:d})})})};var eR=r(40703),eP=r(48653),ek=r(45685),eS=r(62112);let eT=e=>{let{repositoryUrl:t,entities:r,classes:i}=e,a=w();return(0,n.jsxs)(eR.A,{variant:"outlined",className:i?.card,children:[(0,n.jsx)(ek.A,{title:(0,n.jsx)("code",{children:`${(0,ef.trimEnd)(t,"/")}/${a}`})}),(0,n.jsx)(eP.A,{className:i?.cardContent,children:(0,n.jsx)(eS.z,{text:r.map(e=>A.Ay.stringify(e)).join("---\n").trim(),language:"yaml"})})]})};var eC=r(28364);let eI=e=>{let{title:t,description:r,classes:i}=e,{t:a}=(0,u.i)(x);return(0,n.jsxs)(eR.A,{variant:"outlined",className:i?.card,children:[(0,n.jsx)(ek.A,{title:t,subheader:a("stepPrepareCreatePullRequest.previewPr.subheader")}),(0,n.jsx)(eP.A,{className:i?.cardContent,children:(0,n.jsx)(eC.h,{content:r})})]})},eq=(0,S.A)(e=>({previewCard:{marginTop:e.spacing(1)},previewCardContent:{paddingTop:0}}));function ez(e,t,r){return e.map(e=>({...e,apiVersion:e.apiVersion,kind:e.kind,metadata:{...e.metadata,name:t},spec:{...e.spec,...r?{owner:r}:{}}}))}let eF=e=>{let{analyzeResult:t,onPrepare:r,onGoBack:i,renderFormFields:a}=e,{t:o}=(0,u.i)(x),l=eq(),s=(0,c.gf)(eA.v),p=(0,c.gf)(b.g),d=(0,c.gf)(em.m),[m,g]=(0,T.useState)(!1),[j,y]=(0,T.useState)(),v=w(),{loading:L,value:R,error:P}=(0,ew.A)(()=>p.preparePullRequest(),[p.preparePullRequest]);(0,T.useEffect)(()=>{P&&d.post(P)},[P,d]);let{loading:k,value:S}=(0,ew.A)(async()=>(await s.getEntities({filter:{kind:"group"}})).items.map(e=>(0,ev.S)(e,{defaultKind:"group"})).sort()),C=(0,T.useCallback)(async e=>{g(!0);try{let n=await p.submitPullRequest({repositoryUrl:t.url,title:e.title,body:e.body,fileContent:ez(t.generatedEntities,e.componentName,e.owner).map(e=>A.Ay.stringify(e)).join("---\n")});r({type:"repository",url:t.url,integrationType:t.integrationType,pullRequest:{url:n.link},locations:[{target:n.location,entities:ez(t.generatedEntities,e.componentName,e.owner).map(e=>({kind:e.kind,namespace:e.metadata.namespace,name:e.metadata.name}))}]},{notRepeatable:!0})}catch(e){(0,eb.t)(e),y(e.message),g(!1)}},[t.generatedEntities,t.integrationType,t.url,p,r]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{children:o("stepPrepareCreatePullRequest.description",{integrationType:t.integrationType,catalogFilename:(0,n.jsx)("code",{children:v})})}),!L&&(0,n.jsx)(eL,{onSubmit:C,defaultValues:{title:R?.title??"",body:R?.body??"",owner:t.generatedEntities[0]?.spec?.owner||"",componentName:t.generatedEntities[0]?.metadata?.name||"",useCodeowners:!1},render:({values:e,formState:r,register:s,setValue:p})=>(0,n.jsxs)(n.Fragment,{children:[a({values:e,formState:r,register:s,setValue:p,groups:S??[],groupsLoading:k}),(0,n.jsx)(q.A,{marginTop:2,children:(0,n.jsx)(f.A,{variant:"h6",children:o("stepPrepareCreatePullRequest.previewPr.title")})}),(0,n.jsx)(eI,{title:e.title,description:e.body,classes:{card:l.previewCard,cardContent:l.previewCardContent}}),(0,n.jsx)(q.A,{marginTop:2,marginBottom:1,children:(0,n.jsx)(f.A,{variant:"h6",children:o("stepPrepareCreatePullRequest.previewCatalogInfo.title")})}),(0,n.jsx)(eT,{entities:ez(t.generatedEntities,e.componentName,e.owner),repositoryUrl:t.url,classes:{card:l.previewCard,cardContent:l.previewCardContent}}),j&&(0,n.jsx)(N.A,{error:!0,children:j}),(0,n.jsxs)(h.A,{container:!0,spacing:0,children:[i&&(0,n.jsx)(W,{onClick:i,disabled:m}),(0,n.jsx)(H,{type:"submit",disabled:!!(r.errors.title||r.errors.body||r.errors.owner),loading:m,children:o("stepPrepareCreatePullRequest.nextButtonText")})]})]})})]})},eN=({analyzeResult:e,prepareResult:t,onPrepare:r,onGoBack:i})=>{let{t:a}=(0,u.i)(x),[o,l]=(0,T.useState)(t?.locations.map(e=>e.target)||[]),[s,p]=Q()(e?.locations,e=>e.exists),c=(0,T.useCallback)(async()=>{r({type:"locations",locations:p.filter(e=>o.includes(e.target))})},[p,r,o]);return(0,n.jsxs)(n.Fragment,{children:[p.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{children:a("stepPrepareSelectLocations.locations.description")}),(0,n.jsx)(eu,{firstListItem:(0,n.jsxs)(ea.A,{dense:!0,button:!0,onClick:()=>{l(e=>e.length<p.length?p.map(e=>e.target):[])},children:[(0,n.jsx)(eo.A,{children:(0,n.jsx)(z.A,{edge:"start",checked:o.length===p.length,indeterminate:o.length>0&&o.length<p.length,tabIndex:-1,disableRipple:!0})}),(0,n.jsx)(es.A,{primary:a("stepPrepareSelectLocations.locations.selectAll")})]}),onItemClick:e=>{l(t=>t.includes(e)?t.filter(t=>t!==e):t.concat(e))},locations:p,locationListItemIcon:e=>(0,n.jsx)(z.A,{edge:"start",checked:o.includes(e),tabIndex:-1,disableRipple:!0}),collapsed:!0})]}),s.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.A,{children:a("stepPrepareSelectLocations.existingLocations.description")}),(0,n.jsx)(eu,{locations:s,locationListItemIcon:()=>(0,n.jsx)(J.default,{}),withLinks:!0,collapsed:!0})]}),(0,n.jsxs)(h.A,{container:!0,spacing:0,children:[i&&(0,n.jsx)(W,{onClick:i}),(0,n.jsx)(H,{disabled:0===o.length,onClick:c,children:a("stepPrepareSelectLocations.nextButtonText")})]})]})};var eU=r(52262);let eB=({prepareResult:e,onReview:t,onGoBack:r})=>{let{t:i}=(0,u.i)(x),a=(0,c.gf)(eA.v),o=(0,c.gf)(d.U),l=(0,eU.s)(),s=o.getOptionalString("app.title")||"Backstage",[p,m]=(0,T.useState)(!1),[g,j]=(0,T.useState)(),y=!!("locations"===e.type&&e.locations.some(e=>e.exists)),b=(0,T.useCallback)(async()=>{m(!0),l.captureEvent("click","import entity");try{let r=[];"locations"===e.type&&(r=await Promise.all(e.locations.filter(e=>e.exists).map(async e=>{let t=(0,X.U2)(e.entities[0]??e);return await a.refreshEntity(t),{target:e.target}})));let n=await Promise.all(e.locations.filter(e=>!e.exists).map(async e=>{let t=await a.addLocation({type:"url",target:e.target});return{target:t.location.target,entities:t.entities}}));t({...e,refreshed:r,locations:n})}catch(r){(0,eb.t)(r),"repository"===e.type&&r.message.startsWith("Location was added but has no entities specified yet")?t({...e,locations:e.locations.map(e=>({target:e.target,entities:[]}))}):(j(r.message),m(!1))}},[e,t,a,l]);return(0,n.jsxs)(n.Fragment,{children:["repository"===e.type&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(f.A,{paragraph:!0,children:[i("stepReviewLocation.prepareResult.title"),(0,n.jsx)($.N_,{to:e.pullRequest.url,target:"_blank",rel:"noopener noreferrer",children:e.pullRequest.url})]}),(0,n.jsx)(f.A,{paragraph:!0,children:i("stepReviewLocation.prepareResult.description",{appTitle:s})})]}),(0,n.jsx)(f.A,{children:i(y?"stepReviewLocation.catalog.exists":"stepReviewLocation.catalog.new")}),(0,n.jsx)(eu,{locations:e.locations,locationListItemIcon:()=>(0,n.jsx)(J.default,{})}),g&&(0,n.jsx)(N.A,{error:!0,children:g}),(0,n.jsxs)(h.A,{container:!0,spacing:0,children:[r&&(0,n.jsx)(W,{onClick:r,disabled:p}),(0,n.jsx)(H,{disabled:p,loading:p,onClick:()=>b(),children:i(y?"stepReviewLocation.refresh":"stepReviewLocation.import")})]})]})};function eE(e,t,r){switch(e){case"single-location":return{...t,prepare:()=>({stepLabel:(0,n.jsx)(U.A,{optional:(0,n.jsx)(f.A,{variant:"caption",children:r("importStepper.singleLocation.description")}),children:r("importStepper.singleLocation.title")}),content:(0,n.jsx)(n.Fragment,{})})};case"multiple-locations":return{...t,prepare:(e,i)=>"locations"!==e.analyzeResult.type?t.prepare(e,i):{stepLabel:(0,n.jsx)(U.A,{optional:(0,n.jsx)(f.A,{variant:"caption",children:r("importStepper.multipleLocations.description",{length:e.analyzeResult.locations.length})}),children:r("importStepper.multipleLocations.title")}),content:(0,n.jsx)(eN,{analyzeResult:e.analyzeResult,prepareResult:e.prepareResult,onPrepare:e.onPrepare,onGoBack:e.onGoBack})}};case"no-location":return{...t,prepare:(e,i)=>"repository"!==e.analyzeResult.type?t.prepare(e,i):{stepLabel:(0,n.jsx)(U.A,{children:r("importStepper.noLocation.title")}),content:(0,n.jsx)(eF,{analyzeResult:e.analyzeResult,onPrepare:e.onPrepare,onGoBack:e.onGoBack,renderFormFields:({values:e,setValue:t,formState:i,groupsLoading:a,groups:o,register:l})=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(q.A,{marginTop:2,children:(0,n.jsx)(f.A,{variant:"h6",children:r("importStepper.noLocation.createPr.detailsTitle")})}),(0,n.jsx)(B.A,{...(0,v.eO)(l("title",{required:!0})),label:r("importStepper.noLocation.createPr.titleLabel"),placeholder:r("importStepper.noLocation.createPr.titlePlaceholder"),margin:"normal",variant:"outlined",fullWidth:!0,error:!!i.errors.title,required:!0}),(0,n.jsx)(B.A,{...(0,v.eO)(l("body",{required:!0})),label:r("importStepper.noLocation.createPr.bodyLabel"),placeholder:r("importStepper.noLocation.createPr.bodyPlaceholder"),margin:"normal",variant:"outlined",fullWidth:!0,error:!!i.errors.body,multiline:!0,required:!0}),(0,n.jsx)(q.A,{marginTop:2,children:(0,n.jsx)(f.A,{variant:"h6",children:r("importStepper.noLocation.createPr.configurationTitle")})}),(0,n.jsx)(B.A,{...(0,v.eO)(l("componentName",{required:!0})),label:r("importStepper.noLocation.createPr.componentNameLabel"),placeholder:r("importStepper.noLocation.createPr.componentNamePlaceholder"),margin:"normal",variant:"outlined",fullWidth:!0,error:!!i.errors.componentName,required:!0}),!e.useCodeowners&&(0,n.jsx)(ey,{name:"owner",errors:i.errors,options:o||[],loading:a,loadingText:r("importStepper.noLocation.createPr.ownerLoadingText"),helperText:r("importStepper.noLocation.createPr.ownerHelperText"),errorHelperText:r("importStepper.noLocation.createPr.ownerErrorHelperText"),textFieldProps:{label:r("importStepper.noLocation.createPr.ownerLabel"),placeholder:r("importStepper.noLocation.createPr.ownerPlaceholder")},rules:{required:!0},required:!0}),(0,n.jsx)(F.A,{control:(0,n.jsx)(z.A,{...(0,v.eO)(l("useCodeowners")),onChange:(e,r)=>{r&&t("owner","")}}),label:(0,n.jsxs)(n.Fragment,{children:["Use ",(0,n.jsx)("em",{children:"CODEOWNERS"})," file as Entity Owner"]})}),(0,n.jsx)(N.A,{children:r("importStepper.noLocation.createPr.codeownersHelperText")})]})})}};default:return t}}let eO={analyze:(e,{apis:t,t:r})=>({stepLabel:(0,n.jsx)(U.A,{children:r("importStepper.analyze.title")}),content:(0,n.jsx)(ex,{analysisUrl:e.analysisUrl,onAnalysis:e.onAnalysis,disablePullRequest:!t.catalogImportApi.preparePullRequest},"analyze")}),prepare:(e,{t})=>({stepLabel:(0,n.jsx)(U.A,{optional:(0,n.jsx)(f.A,{variant:"caption",children:t("importStepper.prepare.description")}),children:t("importStepper.prepare.title")}),content:(0,n.jsx)(W,{onClick:e.onGoBack})}),review:(e,{t})=>({stepLabel:(0,n.jsx)(U.A,{children:t("importStepper.review.title")}),content:(0,n.jsx)(eB,{prepareResult:e.prepareResult,onReview:e.onReview,onGoBack:e.onGoBack})}),finish:(e,{t})=>({stepLabel:(0,n.jsx)(U.A,{children:t("importStepper.finish.title")}),content:(0,n.jsx)(eh,{prepareResult:e.prepareResult,onReset:e.onReset})})},eD=(0,S.A)(()=>({stepperRoot:{padding:0}})),eG=e=>{let{t}=(0,u.i)(x),{initialUrl:r,generateStepper:i=eE,variant:a}=e,o=(0,c.gf)(b.g),l=eD(),s=(e=>{let[t,r]=(0,T.useReducer)(I,e?.initialUrl,C),{activeFlow:n,activeState:i,analysisUrl:a,previousStates:o}=t;return{activeFlow:n,activeState:i,activeStepNumber:["analyze","prepare","review","finish"].indexOf(i),analysisUrl:a,analyzeResult:t.analyzeResult,prepareResult:t.prepareResult,reviewResult:t.reviewResult,onAnalysis:(e,t,n,i)=>r({type:"onAnalysis",args:[e,t,n,i]}),onPrepare:(e,t)=>r({type:"onPrepare",args:[e,t]}),onReview:e=>r({type:"onReview",args:[e]}),onGoBack:o.length>0?()=>r({type:"onGoBack"}):void 0,onReset:()=>r({type:"onReset",initialUrl:e?.initialUrl})}})({initialUrl:r}),p=(0,T.useMemo)(()=>i(s.activeFlow,eO,t),[i,s.activeFlow,t]),d=e=>(0,n.jsxs)(R.A,{children:[e.stepLabel,(0,n.jsx)(P.A,{children:e.content})]});return(0,n.jsx)(j.n,{variant:a,children:(0,n.jsxs)(k.A,{classes:{root:l.stepperRoot},activeStep:s.activeStepNumber,orientation:"vertical",children:[d(p.analyze(s,{apis:{catalogImportApi:o},t})),d(p.prepare(s,{apis:{catalogImportApi:o},t})),d(p.review(s,{apis:{catalogImportApi:o},t})),d(p.finish(s,{apis:{catalogImportApi:o},t}))]})})},eH=()=>{let{t:e}=(0,u.i)(x),t=(0,m.A)(),r=(0,c.gf)(d.U),i=(0,g.A)(t.breakpoints.down("sm")),j=r.getOptionalString("app.title")||"Backstage",y=[(0,n.jsx)(h.A,{item:!0,xs:12,md:4,lg:6,xl:8,children:(0,n.jsx)(L,{})},0),(0,n.jsx)(h.A,{item:!0,xs:12,md:8,lg:6,xl:4,children:(0,n.jsx)(eG,{})},1)];return(0,n.jsxs)(a.Y,{themeId:"home",children:[(0,n.jsx)(o.Y,{title:e("defaultImportPage.headerTitle")}),(0,n.jsxs)(l.U,{children:[(0,n.jsx)(s.d,{title:e("defaultImportPage.contentHeaderTitle",{appTitle:j}),children:(0,n.jsx)(p.Y,{children:e("defaultImportPage.supportTitle",{appTitle:j})})}),(0,n.jsx)(h.A,{container:!0,spacing:2,children:i?y:y.reverse()})]})]})},eW=()=>(0,i.P1)()||(0,n.jsx)(eH,{})},23164:function(e,t,r){"use strict";var n=r(4293),i=r(78920);t.default=void 0;var a=i(r(14041));t.default=(0,n(r(74044)).default)(a.createElement("path",{d:"M12 8l-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess")},19953:function(e,t,r){e.exports=r(72195)(function(e,t,r){e[+!r].push(t)},function(){return[[],[]]})}}]);
//# sourceMappingURL=8096.3c0746b3.chunk.js.map