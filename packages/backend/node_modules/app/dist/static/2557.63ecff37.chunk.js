"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([["2557"],{1666:function(e,t,r){r.d(t,{L:()=>B});var a=r(31085),o=r(78560),i=r(39371),n=r(47090),s=r(18139),l=r(24453),f=r(78467),d=r(58837),c=r(54917),p=r(53373),g=r.n(p),m=r(14041);let u=(0,r(22249).default)(e=>({text:{fill:e.palette.textContrast},secondary:{fill:e.palette.textSubtle}}),{name:"PluginCatalogGraphCustomLabel"});function h({edge:{relations:e}}){let t=u();return(0,a.jsx)("text",{className:t.text,textAnchor:"middle",children:e.map((e,r)=>(0,a.jsxs)("tspan",{className:g()(r%2!=0&&t.secondary),children:[r>0&&(0,a.jsx)("tspan",{children:" / "}),e]},e))})}var y=r(27849),x=r(10437);function w({icon:e,...t}){let r=e??x.A;return(0,a.jsx)(r,{...t})}var b=r(55488);let R=(0,d.A)(e=>({node:{fill:e.palette.grey[300],stroke:e.palette.grey[300],"&.primary":{fill:e.palette.primary.light,stroke:e.palette.primary.light},"&.secondary":{fill:e.palette.secondary.light,stroke:e.palette.secondary.light}},text:{fill:e.palette.getContrastText(e.palette.grey[300]),"&.primary":{fill:e.palette.primary.contrastText},"&.secondary":{fill:e.palette.secondary.contrastText},"&.focused":{fontWeight:"bold"}},clickable:{cursor:"pointer"}}),{name:"PluginCatalogGraphCustomNode"});function k({node:{id:e,entity:t,color:r="default",focused:o,onClick:i}}){let n=R(),[s,l]=(0,m.useState)(0),[f,d]=(0,m.useState)(0),c=(0,m.useRef)(null),p=(0,y.f)(t,{defaultNamespace:b.oQ});(0,m.useLayoutEffect)(()=>{if(c.current){let{height:e,width:t}=c.current.getBBox();e=Math.round(e),t=Math.round(t),(e!==f||t!==s)&&(l(t),d(e))}},[s,f]);let u=!!p.Icon,h=u?f+10:0,x=f+20,k=p.primaryTitle??e;return(0,a.jsxs)("g",{onClick:i,className:g()(i&&n.clickable),children:[(0,a.jsx)("rect",{className:g()(n.node,"primary"===r&&"primary","secondary"===r&&"secondary"),width:h+s+20,height:x,rx:10}),u&&(0,a.jsx)(w,{icon:p.Icon,y:10,x:10,width:f,height:f,className:g()(n.text,o&&"focused","primary"===r&&"primary","secondary"===r&&"secondary")}),(0,a.jsx)("text",{ref:c,className:g()(n.text,o&&"focused","primary"===r&&"primary","secondary"===r&&"secondary"),y:x/2,x:h+(s+20)/2,textAnchor:"middle",alignmentBaseline:"middle",children:k}),(0,a.jsx)("title",{children:p.entityRef})]})}var E=r(49904),v=r(48240),S=r(30043),A=r(87290),C=r(45250),j=r(13619);function L(e,t){return Array.from(new Set([...e??[],...t??[]]))}let M={"reduce-edges":e=>{e.edges=e.edges.reduce((e,t)=>{let r=e.findIndex(e=>e.from===t.from&&e.to===t.to);return r>=0?(e[r]={...e[r],relations:Array.from(new Set([...e[r].relations,...t.relations]))},e):[...e,t]},[])},"set-distances":({nodeDistances:e,edges:t,rootEntityRefs:r})=>{let a=new Map;t.forEach(e=>{let t=a.get(e.from)??[];t.push(e),a.set(e.from,t);let r=a.get(e.to)??[];r.push(e),a.set(e.to,r)}),r.forEach(t=>{e.set(t,0)});let o=new Set(r),i=r,n=0;for(;i.length>0;){let t=++n,r=[];for(let n of(i.forEach(o=>{a.get(o)?.forEach(a=>{a.distance??=t;let o=e.get(a.from)??t;e.set(a.from,o),r.push(a.from);let i=e.get(a.to)??t;e.set(a.to,i),r.push(a.to)})}),i))o.add(n);i=Array.from(new Set(r)).filter(e=>!o.has(e))}},"order-forward":({rootEntityRefs:e,nodes:t,edges:r})=>{let a=new Map;r.forEach(e=>{let t=a.get(e.from);t||(t=[],a.set(e.from,t)),t.push(e);let r=a.get(e.to);r||(r=[],a.set(e.to,r)),r.push(e)});let o=new Set;for(let t of e){let e=[t].filter(e=>!o.has(e));for(;e.length>0;){for(let t of e)o.add(t);let t=[];e.forEach(e=>{a.get(e)?.forEach(r=>{if(r.to===e&&!o.has(r.from)){let{from:e,to:t}=r;r.from=t,r.to=e,r.relations.reverse()}t.push(r.from,r.to)})}),e=Array.from(new Set(t)).filter(e=>!o.has(e))}}let i=Array.from(o);t.sort((e,t)=>i.findIndex(t=>t===e.id)-i.findIndex(e=>e===t.id))},"strip-distant-edges":e=>{let t=new Map;e.edges.forEach(e=>{let r=t.get(e.from);r||(r=[],t.set(e.from,r)),r.push(e);let a=t.get(e.to);a||(a=[],t.set(e.to,a)),a.push(e)}),e.edges=e.edges.filter(e=>{let r=t.get(e.from).filter(t=>(t.from!==e.from||t.to!==e.to)&&(t.from!==e.to||t.to!==e.from)),a=t.get(e.to).filter(t=>(t.from!==e.from||t.to!==e.to)&&(t.from!==e.to||t.to!==e.from));if(0===r.length||0===a.length)return!0;let o=r.some(t=>(t.distance??0)<(e.distance??0)),i=a.some(t=>(t.distance??0)<(e.distance??0));return!o||!i})},"merge-relations":e=>{let t=new Map;e.edges.forEach(e=>{let r=`${e.from}-${e.to}`,a=`${e.to}-${e.from}`,o=t.get(r),i=t.get(a);o?o.relations=L(o.relations,e.relations):i?i.relations=L(i.relations,e.relations):t.set(r,e)}),e.edges=Array.from(t.values())},"remove-backward-edges":e=>{let{edges:t}=e,r=new Map;t.forEach(e=>{let t=r.get(e.from)??[];t.push(e),r.set(e.from,t)}),t.forEach(e=>{e.relations.length>1&&(e.relations=e.relations.slice(0,1))})}},T=(0,d.A)(e=>({progress:{position:"absolute",left:"50%",top:"50%",marginLeft:"-20px",marginTop:"-20px"},container:{position:"relative",width:"100%",display:"flex",flexDirection:"column"},graph:{width:"100%",flex:1,"& path[marker-end]":{transition:"filter 0.1s ease-in-out"},"& path[marker-end]:hover":{filter:`drop-shadow(2px 2px 4px ${e.palette.primary.dark});`},"& g[data-testid=label]":{transition:"transform 0s"}}}),{name:"PluginCatalogGraphEntityRelationsGraph"}),B=e=>{let{rootEntityNames:t,maxDepth:r=2,unidirectional:d=!0,mergeRelations:p=!0,kinds:u,relations:y,entityFilter:x,direction:w=E.O.LEFT_RIGHT,onNodeClick:R,relationPairs:L,className:B,zoom:N="enabled",renderNode:P,renderLabel:G,renderEdge:I,curve:D,showArrowHeads:F,allowFullscreen:$}=e,O=(0,c.A)(),U=T(),z=(0,m.useMemo)(()=>(Array.isArray(t)?t:[t]).map(e=>(0,o.U2)(e)),[t]),q=(0,s.gf)(l.m),{loading:W,error:X,nodes:H,edges:K}=function({rootEntityRefs:e,maxDepth:t=1/0,unidirectional:r=!0,mergeRelations:a=!0,kinds:i,relations:n,entityFilter:l,onNodeClick:f,relationPairs:d}){let[c,p]=(0,m.useState)({}),{entities:g,loading:u,error:h}=function({rootEntityRefs:e,filter:{maxDepth:t=1/0,relations:r,kinds:a,entityFilter:i}={}}){let{entities:n,loading:l,error:f,requestEntities:d}=function(){let e=(0,s.gf)(S.v),t=(0,m.useRef)({requestedEntities:new Set,outstandingEntities:new Map,cachedEntities:new Map}),[r,a]=(0,m.useState)({}),i=(0,m.useCallback)(()=>{let{cachedEntities:e,requestedEntities:r}=t.current,o={};r.forEach(t=>{let r=e.get(t);r&&(o[t]=r)}),a(o)},[t,a]),[n,l]=(0,A.A)(async()=>{let{requestedEntities:r,cachedEntities:a}=t.current,n=Array.from(r).filter(e=>!a.has(e));if(0===n.length)return void i();let{items:s}=await e.getEntitiesByRefs({entityRefs:n});s.forEach(e=>{if(e){let t=(0,o.U2)(e);a.set(t,e)}}),i()},[t,i]),{loading:f,error:d}=n;return{entities:r,loading:f,error:d,requestEntities:(0,m.useCallback)(e=>{let r=new Set(e),{requestedEntities:a}=t.current;(r.size!==a.size||Array.from(r).some(e=>!a.has(e)))&&(t.current.requestedEntities=r,l(),i())},[t,l,i])}}(),{includeRelation:c}=(0,j.j)({relations:r});return(0,m.useEffect)(()=>{let r=new Set([...e]),o=new Set,s=[...e],l=0;for(;s.length>0&&(!isFinite(t)||l<t);){let e=s;for(s=[];e.length>0;){let t=e.shift(),l=n[t];if(o.add(t),l&&l.relations){if(i&&!i(l))continue;for(let e of l.relations)c(e.type)&&(!a||a.some(t=>e.targetRef.startsWith(`${t.toLocaleLowerCase("en-US")}:`)))&&!o.has(e.targetRef)&&(s.push(e.targetRef),r.add(e.targetRef))}}++l}d([...r])},[n,e,t,c,a,i,d]),{entities:(0,m.useMemo)(()=>l?{}:i?(0,C.pickBy)(n,(e,t)=>i(e)):n,[l,n,i]),loading:l,error:f}}({rootEntityRefs:e,filter:{maxDepth:t,kinds:i,relations:n,entityFilter:l}}),{relationPairs:y,includeRelation:x}=(0,j.j)({relations:n,relationPairs:d});return(0,v.A)(()=>{if(!g||0===Object.keys(g).length)return void p({});let o=Object.entries(g).map(([t,r])=>{let a=e.includes(t),o={id:t,entity:r,focused:a,color:a?"secondary":"primary",kind:r.kind,name:r.metadata.name,namespace:r.metadata.namespace||b.oQ,title:r.metadata.title,spec:r.spec};return f&&(o.onClick=e=>f(o,e)),o}),n=function({rootEntityRefs:e,entities:t,includeRelation:r,kinds:a,mergeRelations:o,relationPairs:i,unidirectional:n}){let s=[],l=new Set,f=[...e],d=(e,t,r)=>s.some(a=>e===a.from&&t===a.to&&a.relations.some(e=>e[0]===r[0]&&e[1]===r[1]));for(;f.length>0;){let e=f.pop(),c=t[e];l.add(e),c&&c?.relations?.forEach(c=>{if(t[c.targetRef]&&r(c.type)&&(!a||a.some(e=>c.targetRef.startsWith(`${e.toLocaleLowerCase("en-US")}:`)))){if(o){let t=i.find(([e,t])=>e===c.type||t===c.type)??[c.type],[r]=t,a=r===c.type?e:c.targetRef,o=r===c.type?c.targetRef:e;n&&d(a,o,t)||s.push({from:a,to:o,relations:t,label:"visible"})}else n&&d(e,c.targetRef,[c.type])||s.push({from:e,to:c.targetRef,relations:[c.type],label:"visible"});if(l.has(c.targetRef)||(f.push(c.targetRef),l.add(c.targetRef)),n){let t=s.findIndex(t=>e===t.from&&c.targetRef===t.to&&!t.relations.includes(c.type));if(t>=0)if(o){let e=i.find(([e,t])=>e===c.type||t===c.type)??[c.type];s[t].relations=[...s[t].relations,...e]}else s[t].relations=[...s[t].relations,c.type]}}})}return s}({rootEntityRefs:e,entities:g,includeRelation:x,kinds:i,mergeRelations:a,relationPairs:y,unidirectional:r}),s={nodeDistances:new Map,edges:n,nodes:o,rootEntityRefs:e,unidirectional:r,maxDepth:t},l=e=>{"function"==typeof e?e(s):M[e](s)};l("reduce-edges"),l("set-distances"),r&&l("strip-distant-edges"),(a||r)&&l("merge-relations"),r&&!a&&(l("order-forward"),l("remove-backward-edges")),p({nodes:s.nodes,edges:s.edges})},100,[t,g,e,i,x,r,a,f,y]),{loading:u,error:h,...c}}({rootEntityRefs:z,maxDepth:r,unidirectional:d,mergeRelations:p,kinds:u,relations:y,entityFilter:x,onNodeClick:R,relationPairs:L});return(0,m.useEffect)(()=>{X&&q.post(X)},[q,X]),(0,a.jsxs)("div",{className:g()(U.container,B),children:[W&&(0,a.jsx)(f.A,{className:U.progress}),H&&K&&(0,a.jsx)(i.w,{nodes:H,edges:K,renderNode:P||k,renderLabel:G||h,renderEdge:I,direction:w,className:U.graph,fit:"contain",paddingX:O.spacing(4),paddingY:O.spacing(4),labelPosition:n.D.LabelPosition.RIGHT,labelOffset:O.spacing(1),zoom:N,curve:D,showArrowHeads:F,allowFullscreen:$})]})}},13619:function(e,t,r){r.d(t,{j:()=>n});var a=r(14041),o=r(18139),i=r(81041);function n(e={}){let{knownRelations:t,knownRelationPairs:r,defaultRelations:s}=(0,o.gf)(i.D),l=e.relations??t,f=e.relationPairs??r,d=e.relations??s,c=(0,a.useCallback)(e=>d.includes(e),[d]);return(0,a.useMemo)(()=>({relations:l,relationPairs:f,defaultRelations:s,relationsToInclude:d,includeRelation:c}),[l,f,s,d,c])}},22221:function(e,t,r){r.d(t,{C:()=>a});let a=(0,r(48870).h)({id:"catalog-graph",messages:{catalogGraphCard:{title:"Relations",deepLinkTitle:"View graph"},catalogGraphPage:{title:"Catalog Graph",filterToggleButtonTitle:"Filters",supportButtonDescription:"Start tracking your component in by adding it to the software catalog.",simplifiedSwitchLabel:"Simplified",mergeRelationsSwitchLabel:"Merge relations",zoomOutDescription:"Use pinch &amp; zoom to move around the diagram. Click to change active node, shift click to navigate to entity.",curveFilter:{title:"Curve",curveMonotoneX:"Monotone X",curveStepBefore:"Step Before"},directionFilter:{title:"Direction",leftToRight:"Left to right",rightToLeft:"Right to left",topToBottom:"Top to bottom",bottomToTop:"Bottom to top"},maxDepthFilter:{title:"Max depth",inputPlaceholder:"âˆž Infinite",clearButtonAriaLabel:"clear max depth"},selectedKindsFilter:{title:"Kinds"},selectedRelationsFilter:{title:"Relations"}}}})}}]);
//# sourceMappingURL=2557.63ecff37.chunk.js.map